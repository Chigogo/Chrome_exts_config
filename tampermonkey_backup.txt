{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"解决百度云大文件下载限制","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["http://pan.baidu.com/*","https://pan.baidu.com/*","http://yun.baidu.com/*","https://yun.baidu.com/*","https://eyun.baidu.com/*"],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1480554644284,"data":{}},"enabled":true,"position":1,"file_url":"https://greasyfork.org/scripts/17800-%E8%A7%A3%E5%86%B3%E7%99%BE%E5%BA%A6%E4%BA%91%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E9%99%90%E5%88%B6/code/%E8%A7%A3%E5%86%B3%E7%99%BE%E5%BA%A6%E4%BA%91%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E9%99%90%E5%88%B6.user.js","uuid":"3d782ff5-aa8f-4f01-a1e1-cf349ceefd4e","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICDop6PlhrPnmb7luqbkupHlpKfmlofku7bkuIvovb3pmZDliLYKLy8gQG5hbWVzcGFjZSAgICB1bmRlZmluZWQKLy8gQHZlcnNpb24gICAgICAwLjAuNgovLyBAZGVzY3JpcHRpb24gIOS4gOihjOS7o+egge+8jOino+WGs+eZvuW6puS6keWkp+aWh+S7tuS4i+i9vemZkOWItgovLyBAYXV0aG9yICAgICAgIGZ1bmlhbnd1eGluCi8vIEBtYXRjaCAgICAgICAgaHR0cDovL3Bhbi5iYWlkdS5jb20vKgovLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8vcGFuLmJhaWR1LmNvbS8qCi8vIEBtYXRjaCAgICAgICAgaHR0cDovL3l1bi5iYWlkdS5jb20vKgovLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8veXVuLmJhaWR1LmNvbS8qCi8vIEBtYXRjaCAgICAgICAgaHR0cHM6Ly9leXVuLmJhaWR1LmNvbS8qCi8vIEBydW4tYXQgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQGdyYW50ICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQovKiBqc2hpbnQgLVcwOTcgKi8KJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KE9iamVjdC5nZXRQcm90b3R5cGVPZihuYXZpZ2F0b3IpLCdwbGF0Zm9ybScse2dldDpmdW5jdGlvbigpe3JldHVybiAnc2JfYmFpZHUnO319KQoKCihmdW5jdGlvbigpewp2YXIgaHJlZj1sb2NhdGlvbi5ocmVmOwovaHR0cDovLnRlc3QoaHJlZik/bG9jYXRpb24uaHJlZj0naHR0cHMnK2hyZWYuc2xpY2UoNCk6MDsKfSgpKTsKCgogICAg"},{"name":"Google: Bypass Result Page Redirect","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["/^https?://(?:encrypted|www)\\.google\\.[^/]+/(?:$|[#?]|search|webhp|imgres)/"],"orig_matches":["https://news.google.com/*","https://cse.google.com/cse/*"],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1480555257633,"data":{}},"enabled":true,"position":2,"file_url":"https://greasyfork.org/scripts/14150-google-%E7%BB%95%E8%BF%87%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E7%BD%91%E9%A1%B5%E9%93%BE%E6%8E%A5%E9%87%8D%E5%AE%9A%E5%90%91/code/Google%EF%BC%9A%E7%BB%95%E8%BF%87%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E7%BD%91%E9%A1%B5%E9%93%BE%E6%8E%A5%E9%87%8D%E5%AE%9A%E5%90%91.user.js","uuid":"a31952f9-536b-4c35-ac7c-4c6bfe2ed3e7","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWVzcGFjZSAgIFZBX2kKLy8gQHZlcnNpb24gICAgIDUuMC4yLjIwMTYwNTAzCi8vIEBncmFudCAgICAgICBub25lCi8vIEBpbmNsdWRlICAgICAvXmh0dHBzPzovLyg/OmVuY3J5cHRlZHx3d3cpXC5nb29nbGVcLlteL10rLyg/OiR8WyM/XXxzZWFyY2h8d2ViaHB8aW1ncmVzKS8KLy8gQG1hdGNoICAgICAgIGh0dHBzOi8vbmV3cy5nb29nbGUuY29tLyoKLy8gQG1hdGNoICAgICAgIGh0dHBzOi8vY3NlLmdvb2dsZS5jb20vY3NlLyoKLy8gQHJ1bi1hdCAgICAgIGRvY3VtZW50LXN0YXJ0Ci8vIEBuYW1lICAgICAgICBHb29nbGU6IEJ5cGFzcyBSZXN1bHQgUGFnZSBSZWRpcmVjdAovLyBAbmFtZTp6aC1DTiAgR29vZ2xl77ya57uV6L+H5pCc57Si57uT5p6c572R6aG16ZO+5o6l6YeN5a6a5ZCRCi8vIEBuYW1lOnpoLVRXICBHb29nbGXvvJrnuZ7pgY7mkJzlsIvntZDmnpzntrLpoIHpj4jmjqXph43lrprlkJEKLy8gQGRlc2NyaXB0aW9uIEF2b2lkIEdvb2dsZSByZWRpcmVjdCBmb3Igc2VhcmNoIHJlc3VsdCBwYWdlcy4KLy8gQGRlc2NyaXB0aW9uOnpoLUNOIOS7pCBHb29nbGUg55u05o6l6ZO+5o6l6Iez5pCc57Si57uT5p6c572R6aG177yM5peg6aG76YeN5a6a5ZCR44CCCi8vIEBkZXNjcmlwdGlvbjp6aC1UVyDku6QgR29vZ2xlIOebtOaOpemPiOaOpeiHs+aQnOWwi+e1kOaenOe2sumgge+8jOeEoemgiOmHjeWumuWQkeOAggovLyA9PS9Vc2VyU2NyaXB0PT0KCnZhciBkZWJ1ZyA9IGZhbHNlOwp2YXIgY291bnQgPSAwOwoKLy8gd2ViIHBhZ2VzOiB1cmw/dXJsPQovLyBjdXN0b20gc2VhcmNoIGVuZ2luZTogdXJsP3E9CnZhciByZSA9IC9cYnVybFw/Lio/XGIoPzp1cmx8cSk9KGh0dHBzP1xiW14mI10rKS9pOwp2YXIgcmVzdG9yZSA9IGZ1bmN0aW9uIChsaW5rLCB1cmwpIHsKICB1cmwgPSB1cmwgfHwgbGluay5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSB8fCAnJzsKICB2YXIgbWF0Y2hlcyA9IHVybC5tYXRjaChyZSk7CiAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCBtYXRjaGVzID8gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoZXNbMV0pIDogdXJsKTsKfTsKCnZhciBmYWtlTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKdmFyIG5vcm1hbGl6ZVVybCA9IGZ1bmN0aW9uICh1cmwpIHsKICBmYWtlTGluay5ocmVmID0gdXJsOwogIHJldHVybiBmYWtlTGluay5ocmVmOwp9OwoKdmFyIHNldHRlciA9IGZ1bmN0aW9uICh2KSB7CiAgdiA9IFN0cmluZyh2KTsgIC8vIGluIGNhc2UgYW4gb2JqZWN0IGlzIHBhc3NlZCBieSBjbGV2ZXIgR29vZ2xlCiAgZGVidWcgJiYgY29uc29sZS5sb2coJ3NldCcsIHRoaXMuX3hfaWQsIHRoaXMuZ2V0QXR0cmlidXRlKCdocmVmJyksIHYpOwogIHJlc3RvcmUodGhpcywgdik7Cn07CnZhciBnZXR0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgZGVidWcgJiYgY29uc29sZS5sb2coJ2dldCcsIHRoaXMuX3hfaWQsIHRoaXMuZ2V0QXR0cmlidXRlKCdocmVmJykpOwogIHJldHVybiBub3JtYWxpemVVcmwodGhpcy5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSk7Cn07CnZhciBibG9ja2VyID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgcmVzdG9yZSh0aGlzKTsKICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnYmxvY2snLCB0aGlzLl94X2lkLCB0aGlzLmdldEF0dHJpYnV0ZSgnaHJlZicpKTsKfTsKCnZhciBoYW5kbGVyID0gZnVuY3Rpb24gKGEpIHsKICBpZiAoYS5feF9pZCkgewogICAgcmV0dXJuOwogIH0KICBhLl94X2lkID0gZGVidWcgPyArK2NvdW50IDogdHJ1ZTsKICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7CiAgICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnZGVmaW5lIHByb3BlcnR5JywgYS5feF9pZCk7CiAgICByZXN0b3JlKGEpOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsICdocmVmJywge2dldDogZ2V0dGVyLCBzZXQ6IHNldHRlcn0pOwogIH0gZWxzZSBpZiAoYS5fX2RlZmluZVNldHRlcl9fKSB7CiAgICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnZGVmaW5lIGdldHRlcicsIGEuX3hfaWQpOwogICAgcmVzdG9yZShhKTsKICAgIGEuX19kZWZpbmVTZXR0ZXJfXygnaHJlZicsIHNldHRlcik7CiAgICBhLl9fZGVmaW5lR2V0dGVyX18oJ2hyZWYnLCBnZXR0ZXIpOwogIH0gZWxzZSB7CiAgICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnZGVmaW5lIGxpc3RlbmVyJywgYS5feF9pZCk7CiAgICByZXN0b3JlKGEpOwogICAgYS5vbm1vdXNlZW50ZXIgPSBhLm9ubW91c2Vtb3ZlID0gYS5vbm1vdXNldXAgPSBhLm9ubW91c2Vkb3duID0KICAgICAgYS5vbmRiY2xpY2sgPSBhLm9uY2xpY2sgPSBhLm9uY29udGV4dG1lbnUgPSBibG9ja2VyOwogIH0KfTsKCnZhciB1cGRhdGUgPSBmdW5jdGlvbiAoKSB7CiAgW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhW2hyZWZdJykpLmZvckVhY2goaGFuZGxlcik7Cn07Cgp2YXIgdGlkID0gbnVsbDsKdmFyIHByZXYgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwp2YXIgY2hlY2sgPSBmdW5jdGlvbiAobXV0YXRpb24pIHsKICByZXR1cm4gbXV0YXRpb24uYWRkZWROb2Rlcy5sZW5ndGggPiAwOwp9Owp2YXIgY2hlY2tOZXdOb2RlcyA9IGZ1bmN0aW9uIChtdXRhdGlvbnMpIHsKICBtdXRhdGlvbnMuZm9yRWFjaCAmJiBtdXRhdGlvbnMuZm9yRWFjaChjaGVja0F0dHJpYnV0ZSk7CiAgdmFyIG5leHQgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwogIGlmIChuZXh0IC0gcHJldiA+IDEwMDApIHsgIC8vIERvbid0IGxldCBtZSB3YWl0IHRvbyBsb25nLgogICAgcHJldiA9IG5leHQ7CiAgICBjbGVhclRpbWVvdXQodGlkKTsKICAgIHVwZGF0ZSgpOyAgLy8gVGhyb3R0bGUgaXMgd2hhdD8KICB9IGVsc2UgaWYgKCFtdXRhdGlvbnMuc29tZSB8fCBtdXRhdGlvbnMuc29tZShjaGVjaykpIHsKICAgIGNsZWFyVGltZW91dCh0aWQpOwogICAgdGlkID0gc2V0VGltZW91dCh1cGRhdGUsIDIwMCk7CiAgfQp9Owp2YXIgY2hlY2tBdHRyaWJ1dGUgPSBmdW5jdGlvbiAobXV0YXRpb24pIHsKICB2YXIgdGFyZ2V0ID0gbXV0YXRpb24udGFyZ2V0OwogIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdBJyAmJgogICAgICAobXV0YXRpb24uYXR0cmlidXRlTmFtZSB8fCBtdXRhdGlvbi5hdHRyTmFtZSkgPT09ICdocmVmJyAmJgogICAgICByZS50ZXN0KHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSkpIHsKICAgIGRlYnVnICYmIGNvbnNvbGUubG9nKCdyZXN0b3JlIGF0dHJpYnV0ZScsIHRhcmdldC5feF9pZCwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpKTsKICAgIHJlc3RvcmUodGFyZ2V0KTsKICB9Cn07Cgp2YXIgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyOwoKaWYgKE11dGF0aW9uT2JzZXJ2ZXIpIHsKICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnTXV0YXRpb25PYnNlcnZlcjogdHJ1ZScpOwogIG5ldyBNdXRhdGlvbk9ic2VydmVyKGNoZWNrTmV3Tm9kZXMpLm9ic2VydmUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCB7CiAgICBjaGlsZExpc3Q6IHRydWUsCiAgICBhdHRyaWJ1dGVzOiB0cnVlLAogICAgYXR0cmlidXRlRmlsdGVyOiBbJ2hyZWYnXSwKICAgIHN1YnRyZWU6IHRydWUKICB9KTsKfSBlbHNlIHsKICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnTXV0YXRpb25FdmVudDogdHJ1ZScpOwogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUF0dHJNb2RpZmllZCcsIGNoZWNrQXR0cmlidXRlLCBmYWxzZSk7CiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgY2hlY2tOZXdOb2RlcywgZmFsc2UpOwp9"},{"name":"百度云插件+APIKey","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["/https?\\:\\/\\/(pan|yun)\\.baidu\\.com.*/"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":["googleapis.com"],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1480555634437,"data":{}},"enabled":true,"position":3,"file_url":"https://greasyfork.org/scripts/496-%E7%99%BE%E5%BA%A6%E4%BA%91%E6%8F%92%E4%BB%B6-apikey/code/%E7%99%BE%E5%BA%A6%E4%BA%91%E6%8F%92%E4%BB%B6+APIKey.user.js","uuid":"6690c28b-8506-4bc5-8611-76c164755bf7","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAg55m+5bqm5LqR5o+S5Lu2K0FQSUtleQovLyBAbmFtZXNwYWNlICAKLy8gQHZlcnNpb24gICAgNS4wLjIuMQovLyBAZGVzY3JpcHRpb24gIOWcqOeZvuW6puS6kee9keebmOeahOmhtemdoua3u+WKoOS4gOS4quaQnOe0ouahhu+8jOiwg+eUqOaQnOe0okFQSeaQnOe0ouaJgOacieWFrOW8gOWIhuS6q+aWh+S7ti8vIFRvIGFkZCBhIHNlYXJjaCBmcmFtZSB0aGF0IGNhbGxzIHNvbWUgYXBpIGZvciBzZWFyY2hpbmcgc29tZSBwdWJsaWMgc2hhcmVkIGZpbGVzIGluIEJhaWR1WXVuIGNsb3VkIG5ldGRpc2suIAovLyBAZGVzY3JpcHRpb24gIEZvciBtb3JlIGltZm9ybWF0aW9uLHBsZWFzZSBlbWFpbCBtZSBhdCB3YW5naHNpbmNoZUBob3RtYWlsLmNvbS4gCi8vIEBpbmNsdWRlICAgICAgIC9odHRwcz9cOlwvXC8ocGFufHl1bilcLmJhaWR1XC5jb20uKi8KLy8gQGdyYW50ICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBydW4tYXQgZG9jdW1lbnQtZW5kCi8vIEBjb3B5cmlnaHQgIDIwMTQsMDQsMjAgX19CeSBXYW5nIEhzaW4tY2hlICAgCi8vID09L1VzZXJTY3JpcHQ9PQoKLyp0aGFua3MgdG8gdGhlIHR1dG9yaWFsIG9mIG12YyAgYXQgCmh0dHBzOi8vYWxleGF0bmV0LmNvbS9hcnRpY2xlcy9tb2RlbC12aWV3LWNvbnRyb2xsZXItbXZjLWphdmFzY3JpcHQqLwoKCi8vRXZlbnQgaXMgYSBzaW1wbGUgY2xhc3MgZm9yIGltcGxlbWVudGluZyB0aGUgT2JzZXJ2ZXIgcGF0dGVybjoKZnVuY3Rpb24gRXZlbnQoc2VuZGVyKSB7CiAgICB0aGlzLl9zZW5kZXIgPSBzZW5kZXI7CiAgICB0aGlzLl9saXN0ZW5lcnMgPSBbXTsKfQoKRXZlbnQucHJvdG90eXBlID0gewogICAgYXR0YWNoIDogZnVuY3Rpb24gKGxpc3RlbmVyKSB7Ly9wdXNoIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBpbnRvIF9saXN0ZW5lcnNbXTsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgICB9LAogICAgbm90aWZ5IDogZnVuY3Rpb24gKGFyZ3MpIHsvL3BvcCBhbGwgdGhlIGNhbGxiYWNrIGZ1bmN0aW9ucyBhbmQgZXhlY3V0ZSB0aGUgZnVuY3Rpb25zIHdpdGggc2FtZSBhcmdzPwogICAgICAgIHZhciBpbmRleDsKCiAgICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5fbGlzdGVuZXJzLmxlbmd0aDsgaW5kZXggKz0gMSkgewogICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNbaW5kZXhdKHRoaXMuX3NlbmRlciwgYXJncyk7Ly9hdXRvIHBhc3Mgc2VuZGVyIGFuZCBhcmdzIGludG8gY2FsbGJhY2sgZnVuY3Rpb24sIHNvIHRoZSBkZWZhdWx0IGZvcm0gb2YgY2FsbGJhY2sgZnVuY3Rpb24gaXMgZnVuY3Rpb24oc2VuZGVyLGFyZ3Mpe30KICAgICAgICB9CiAgICB9Cn07CgovL0phdmFzY3JpcHQtdGVtcGxhdGUtZW5naW5lLWluLWp1c3QtMjAtbGluZQovL2J5IGJ5IEtyYXNpbWlyIGh0dHA6Ly9rcmFzaW1pcnRzb25ldi5jb20vYmxvZy9hcnRpY2xlL0phdmFzY3JpcHQtdGVtcGxhdGUtZW5naW5lLWluLWp1c3QtMjAtbGluZQp2YXIgVGVtcGxhdGVFbmdpbmUgPSBmdW5jdGlvbihodG1sLCBvcHRpb25zKSB7CiAgICB2YXIgcmUgPSAvPCUoW14lPl0rKT8lPi9nLCByZUV4cCA9IC8oXiggKT8oaWZ8Zm9yfGVsc2V8c3dpdGNofGNhc2V8YnJlYWt8e3x9KSkoLiopPy9nLCBjb2RlID0gJ3ZhciByPVtdO1xuJywgY3Vyc29yID0gMCwgbWF0Y2g7CiAgICB2YXIgYWRkID0gZnVuY3Rpb24obGluZSwganMpIHsKICAgICAgICBqcz8gKGNvZGUgKz0gbGluZS5tYXRjaChyZUV4cCkgPyBsaW5lICsgJ1xuJyA6ICdyLnB1c2goJyArIGxpbmUgKyAnKTtcbicpIDoKICAgICAgICAgICAgKGNvZGUgKz0gbGluZSAhPSAnJyA/ICdyLnB1c2goIicgKyBsaW5lLnJlcGxhY2UoLyIvZywgJ1xcIicpICsgJyIpO1xuJyA6ICcnKTsKICAgICAgICByZXR1cm4gYWRkOwogICAgfTsKICAgIHdoaWxlKG1hdGNoID0gcmUuZXhlYyhodG1sKSkgewogICAgICAgIGFkZChodG1sLnNsaWNlKGN1cnNvciwgbWF0Y2guaW5kZXgpKShtYXRjaFsxXSwgdHJ1ZSk7CiAgICAgICAgY3Vyc29yID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7CiAgICB9CiAgICBhZGQoaHRtbC5zdWJzdHIoY3Vyc29yLCBodG1sLmxlbmd0aCAtIGN1cnNvcikpOwogICAgY29kZSArPSAncmV0dXJuIHIuam9pbigiIik7JzsKICAgIHJldHVybiBuZXcgRnVuY3Rpb24oY29kZS5yZXBsYWNlKC9bXHJcdFxuXS9nLCAnJykpLmFwcGx5KG9wdGlvbnMpOwp9OwoKLyoqCiAqIFRoZSBNb2RlbC4gTW9kZWwgc3RvcmVzIGl0ZW1zIGFuZCBub3RpZmllcwogKiBvYnNlcnZlcnMgYWJvdXQgY2hhbmdlcy4KICovCgogdmFyIEJhc2VNb2RlbD1mdW5jdGlvbihlbmdpbmVMc3QpewogICAgdGhpcy5rZXl3b3JkPSIiOwogICAgdGhpcy5lbmdpbmU9ImRlZmF1bHQiOwogICAgdGhpcy5lbmdpbmVMc3Q9ZW5naW5lTHN0OwogICAgdGhpcy5qc29uT2JqPXsgCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiB7IAogICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRSZXN1bHRDb3VudDogMCwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdENvdW50OiAwIH0sIAogICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdCiAgICAgICAgICAgICAgICB9OwogICAgdGhpcy5jdXJyPTE7CiAgICB0aGlzLnRvdGFsUGFnZT0xOwogICAgdGhpcy51cmxzPXtkZWZhdWx0OidodHRwOi8vJyx9OwogICAgdGhpcy5zdGF0ZT1mYWxzZTsKICAgIHRoaXMuY29udGVudFVwZGF0ZWQ9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy5yZXF1ZXN0RXZlbnQ9bmV3IEV2ZW50KHRoaXMpOwogfTsKIEJhc2VNb2RlbC5wcm90b3R5cGU9ewogICAgc2V0RW5naW5lOmZ1bmN0aW9uKGVuZ2luZSl7CiAgICAJdmFyIHRlbXBPYmogPSB7fTsKICAgICAgICB0aGlzLmVuZ2luZT1lbmdpbmU7CiAgICAgICAgdGVtcE9ialsnZW5naW5lJ10gPSBlbmdpbmU7CiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCd3eHpZdW5wYW5TZWFyY2hlcicsSlNPTi5zdHJpbmdpZnkodGVtcE9iaikpOwogICAgICAgIHRlbXBPYmogPSBudWxsOwogICAgfSwKICAgIHVwZGF0ZUN1cnI6ZnVuY3Rpb24oY3Vycil7CiAgICAgICAgdGhpcy5jdXJyPWN1cnI7CiAgICB9LAogICAgdXBkYXRlS2V5d29yZDpmdW5jdGlvbihrZXl3b3JkKXsKICAgICAgICB0aGlzLmtleXdvcmQ9a2V5d29yZDsKICAgIH0sCiAgICByZXF1ZXN0OmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5yZXF1ZXN0RXZlbnQubm90aWZ5KCk7CiAgICAgICAgdmFyIF90aGlzPXRoaXM7CiAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICAgICAgICAgIG1ldGhvZDogIkdFVCIsCiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdGhpcy5jb21waWxlVXJsW190aGlzLmVuZ2luZV0oX3RoaXMpLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAiLCAvLyBJZiBub3Qgc3BlY2lmaWVkLCBuYXZpZ2F0b3IudXNlckFnZW50IHdpbGwgYmUgdXNlZC4KICAgICAgICAgICAgICAgICAgICAgICAgIkFjY2VwdCI6ICJ0ZXh0L3htbCIgLy8gSWYgbm90IHNwZWNpZmllZCwgYnJvd3NlciBkZWZhdWx0cyB3aWxsIGJlIHVzZWQuCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmpzb25PYmo9X3RoaXMudG9Kc29uW190aGlzLmVuZ2luZV0ocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG90YWxQYWdlPShwYXJzZUludChfdGhpcy5qc29uT2JqLmN1cnNvci5yZXN1bHRDb3VudCktcGFyc2VJbnQoX3RoaXMuanNvbk9iai5jdXJzb3IucmVzdWx0Q291bnQpJTEwKS8xMCsxOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdGF0ZT10cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3NlbGY9X3RoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRlbnRVcGRhdGVkLm5vdGlmeShfc2VsZi5zdGF0ZSk7ICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25lcnJvcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmpzb25PYmo9eyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZFJlc3VsdENvdW50OiAwLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Q291bnQ6IDAgfSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnRvdGFsUGFnZT0xOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdGF0ZT1mYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9zZWxmPV90aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZW50VXBkYXRlZC5ub3RpZnkoX3NlbGYuc3RhdGUpOyAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICB9LAogICAgZGVzdG9yeTpmdW5jdGlvbigpewogICAgICAgIHRoaXMuanNvbk9iaj17fTsKICAgICAgICB0aGlzLnRvdGFsUGFnZT0wOwogICAgICAgIHRoaXMuc3RhdGU9ZmFsc2U7IAogICAgICAgIHRoaXMuY3Vycj0wOwogICAgICAgIHRoaXMua2V5d29yZD0iIjsKICAgIH0sCiAgICB0b0pzb246ewogICAgICAgIGRlZmF1bHQ6ZnVuY3Rpb24odGV4dCl7CiAgICAgICAgICAgIHZhciBqc29uT2JqID0geyAKICAgICAgICAgICAgICAgICAgICBjdXJzb3I6IHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGVzdGltYXRlZFJlc3VsdENvdW50OiAwLCAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Q291bnQ6IDAgfSwgCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW10KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4ganNvbk9iajsKICAgICAgICB9LAogICAgfSwKICAgIGNvbXBpbGVVcmw6ewogICAgICAgIGRlZmF1bHQ6ZnVuY3Rpb24oX3RoaXMpewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnVybCArIF90aGlzLmtleXdvcmQgKyAnK3NpdGUlM0FwYW4uYmFpZHUuY29tJyArICcmZmlyc3Q9JyArIF90aGlzLmN1cnI7CiAgICAgICAgICAgIH0sICAgICAgICAKICAgIH0sCiB9OwoKIHZhciBWaWV3ZXI9ZnVuY3Rpb24obW9kZWwsVUllbGVtZW50cyl7CiAgICB0aGlzLm1vZGVsPW1vZGVsOwogICAgdGhpcy5VST1VSWVsZW1lbnRzOwogICAgdGhpcy5zZWFyY2hDbGljaz1uZXcgRXZlbnQodGhpcyk7CiAgICB0aGlzLmNsb3NlQ2xpY2s9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy5uZXh0Q2xpY2s9bmV3IEV2ZW50KHRoaXMpOwogICAgdGhpcy5wcmVDbGljaz1uZXcgRXZlbnQodGhpcyk7CiAgICB0aGlzLnRvUGFnZUNsaWNrPW5ldyBFdmVudCh0aGlzKTsKICAgIHRoaXMuZW5naW5lT3B0Q2hhbmdlPW5ldyBFdmVudCh0aGlzKTsKICAgIHZhciBib2R5Tm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTsKICAgIHZhciBfc2VsZj10aGlzOwogICAgdGhpcy5VSS5zZWFyY2hCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgLyogQWN0IG9uIHRoZSBldmVudCAqLwogICAgICAgIHZhciBjdXJyPTE7CiAgICAgICAgdmFyIGtleXdvcmQ9X3NlbGYuVUkuaW5wdXRFbGUudmFsdWU7CiAgICAgICAgaWYoa2V5d29yZC5yZXBsYWNlKC9ccyovLCcnKSE9PScnKXsKICAgICAgICAgICAgX3NlbGYuc2VhcmNoQ2xpY2subm90aWZ5KHtjdXJyOmN1cnIsa2V5d29yZDprZXl3b3JkfSk7CiAgICAgICAgfQogICAgfSk7CiAgICB0aGlzLlVJLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jdGlvbihldmVudCkgewogICAgICAgIC8qIEFjdCBvbiB0aGUgZXZlbnQgKi8KICAgICAgICBfc2VsZi5jbG9zZUNsaWNrLm5vdGlmeSgpOwogICAgfSk7CiAgICAvLyB0aGlzLlVJLmlucHV0RWxlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJyxmdW5jdGlvbihldmVudCkgewogICAgLy8gICAgICAgICB2YXIgY2xpY2tFdmVudCA9IG5ldyBNb3VzZUV2ZW50KCJjbGljayIpOyAgICAgICAgICAgIAogICAgLy8gICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT0gMTMpIHsKICAgIC8vICAgICAgICAgICAgIF9zZWxmLlVJLnNlYXJjaEJ0bi5kaXNwYXRjaEV2ZW50KGNsaWNrRXZlbnQpOwogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICAgIGNsaWNrRXZlbnQgPSBudWxsOwogICAgLy8gICAgIH0pOwogICAgYm9keU5vZGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKF9zZWxmLlVJLmVuZ2luZUJ0bkNsYXNzTmFtZSkgIT09IC0xICkgewogICAgICAgICAgICBfc2VsZi5lbmdpbmVPcHRDaGFuZ2Uubm90aWZ5KGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZW5naW5lJykpOyAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKF9zZWxmLlVJLnRvUGFnZUJ0bkNsYXNzTmFtZSkgIT09IC0xICkgewogICAgICAgICAgICBfc2VsZi50b1BhZ2VDbGljay5ub3RpZnkocGFyc2VJbnQoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1wYWdlJyksMTApKTsKICAgICAgICB9CiAgICB9KTsKICAgICAgICAgICAgICAgICAgCiB9OwogVmlld2VyLnByb3RvdHlwZT17CiAgICByZWZsZXNoRW5naW5lTHN0OmZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIHRlbXBsYXRlPSc8JWZvcih2YXIgaSBpbiB0aGlzKXslPicrCiAgICAgICAgICAgICAgICAgICAgJzxsaSBub2RlLXR5cGU9ImNsaWNrLWVsZSIgZGF0YS1lbmdpbmU9IjwldGhpc1tpXSU+IiBjbGFzcz0ibGkgd3h6LW1lbnUtb3B0aW9uIj4nKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2J5IDwldGhpc1tpXSU+JysKICAgICAgICAgICAgICAgICAgICAnPC9saT4nKwogICAgICAgICAgICAgICAgICAgICc8JX0lPic7CiAgICAgICAgdmFyIGh0bWw9VGVtcGxhdGVFbmdpbmUodGVtcGxhdGUsdGhpcy5tb2RlbC5lbmdpbmVMc3QpOwogICAgICAgIHRoaXMuVUkuZW5naW5lTHN0LmlubmVySFRNTCA9IGh0bWw7CiAgICB9LAogICAgdXBkYXRlRW5naW5lOmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5VSS5tZW51LnRleHRDb250ZW50ID0gdGhpcy5tb2RlbC5lbmdpbmU7CiAgICB9LAogICAgc2hvdzpmdW5jdGlvbigpewogICAgICAgIHRoaXMuVUkubXlEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgdGhpcy5VSS5iZ05vZGUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgdGhpcy5VSS5teURpdi5zdHlsZS50b3AgPSAnNTAlJzsKICAgICAgICB0aGlzLlVJLm15RGl2LnN0eWxlLm1hcmdpblRvcCA9ICh0aGlzLlVJLm15RGl2LmNsaWVudEhlaWdodCAvIDIgKiAtMSkgKyAncHgnOyAgICAKICAgIH0sCiAgICByZWZsZXNoOmZ1bmN0aW9uKHN1Y2Nlc3MpewogICAgICAgIHZhciB0ZW1wbGF0ZT0iPHAgYWxpZ249J3JpZ2h0Jz4tLS0tIGJ5IDwldGhpcy5lbmdpbmUlPi5jb20gU2VhcmNoIDwvcD48cCB3aGl0ZS1zcGFjZT0nbm9ybWFsJyBjbGFzcz0ndGVtcCcgPmtleXdvcmQgaXMgICAgJzwldGhpcy5rZXl3b3JkJT4nICAgIGZvdW5kICAnPCV0aGlzLmpzb25PYmouY3Vyc29yLnJlc3VsdENvdW50JT4nICBSZXN1bHRzPC9wPjxwPi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tPHA+IjsKICAgICAgICAKICAgICAgICB0ZW1wbGF0ZSs9JzwlZm9yKHZhciBpIGluIHRoaXMuanNvbk9iai5yZXN1bHRzKXslPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+PHAgY2xhc3M9Im15VGl0bGUiPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgaHJlZj0iPCV0aGlzLmpzb25PYmoucmVzdWx0c1tpXS51bmVzY2FwZWRVcmwlPiJ0YXJnZXQ9Il9ibGFuayI+PCV0aGlzLmpzb25PYmoucmVzdWx0c1tpXS50aXRsZU5vRm9ybWF0dGluZyU+PC9hPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAnPC9wPicrCiAgICAgICAgICAgICAgICAgICAgICAgICAnPHAgY2xhc3M9Im15U25pcHBldCI+PCV0aGlzLmpzb25PYmoucmVzdWx0c1tpXS5jb250ZW50Tm9Gb3JtYXR0aW5nJT48L3A+JysKICAgICAgICAgICAgICAgICc8JX0lPic7CiAgICAgICAgdGVtcGxhdGUrPSc8cD48cD4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tPHAgY2xhc3M9InRlbXAiIG1hcmdpbi1sZWZ0PSIyMHB4Ij4iIDwldGhpcy5qc29uT2JqLnJlc3VsdHMubGVuZ3RoJT4gIiAgaXRlbXMgaGF2ZSBiZWVuIGxvYWQgPC9wPic7CiAgICAgICAgdmFyIGh0bWw7CiAgICAgICAgaWYoc3VjY2Vzcz09PWZhbHNlKXsKICAgICAgICAgICAgaHRtbD0nPGRpdiBjbGFzcz0ibG9hZGluZy10aXBzIiBhbGlnbj0iY2VudGVyIj7lh7rplJnkuoYuLi4uLi48L2Rpdj4nOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBpZih0aGlzLm1vZGVsLmpzb25PYmoucmVzdWx0cy5sZW5ndGg9PT0wKXsKICAgICAgICAgICAgICAgIGh0bWw9JzxkaXYgY2xhc3M9ImxvYWRpbmctdGlwcyIgYWxpZ249ImNlbnRlciI+5peg5pCc57Si57uT5p6cLi4u5o2i5Liq5YWz6ZSu6K+N6YeN5paw6K+V6K+V77yfPC9kaXY+JzsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBodG1sPVRlbXBsYXRlRW5naW5lKHRlbXBsYXRlLHRoaXMubW9kZWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLlVJLm15Q29udGVudC5pbm5lckhUTUwgPSBodG1sOwogICAgfSwKICAgIGNsb3NlOmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy5VSS5teURpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHRoaXMuVUkuYmdOb2RlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgdGhpcy5VSS5pbnB1dEVsZS52YWx1ZSA9ICcnOwogICAgfSwKICAgIGxvYWRpbmc6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLlVJLm15Q29udGVudC5pbm5lckhUTUwgPSAnPGltZyAgd2lkdGg9IjYwMHB4IiBzcmM9ImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEpnSnVBY1FRQVArS0FDRk1kbHg4bTVlcnY4VFAyakJZZjlQYjVFMXdrYWEzeUxYRDBUOWtpSW1ndG11SXBIcVVyZkR6OXYvLy93QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQ0gvQzA1RlZGTkRRVkJGTWk0d0F3RUFBQUFoK1FRRk1nQVFBQ3dBQUFBQUpnSnVBUUFGLytBamptUnBubWlxcm16cnZuQXN6M1J0MzNpdTczenYvOENnY0Vnc0dvL0lwSExKYkRxZjBLaDBTcTFhcjlpc2RzdnRlci9nc0hoTUxwdlA2TFI2elc2NzMvQzRmRTZ2MisvNHZIN1A3L3YvZ0lHQ2c0U0Zob2VJaVlxTGpJMk9qNUNSa3BPVWxaYVhtSm1hbTV5ZG5wK2dvYUtqcEtXbXA2aXBxcXVzcmE2dnNMR3lzN1MxdHJlNHVicTd2TDIrdjhEQndzUEV4Y2JIeU1uS3k4ek56cy9RMGRMVDFOWFcxOWpaMnR2YzNkN2Y0T0hpNCtUbDV1Zm82ZXJyN08zdTcvRHg4dlAwOWZiMytQbjYrL3o5L3Y4QUF3b2NTTENnd1lNSUV5cGN5TENodzRjUUkwcWNTTEdpeFlzWU0ycmN5TEdqeDQ4Z1E0b2NTYktreVpNb1UvK3FYTW15cGN1WE1HUEtuRW16cHMyYk9IUHEzTW16cDgrZlFJTUtIVXEwcU5HalNKTXFYY3EwcWRPblVLTktuVXExcXRXcldMTnEzY3ExcTlldllNT0tIVXUyck5temFOT3FYY3UycmR1M2NPUEtuVXUzcnQyN2VQUHEzY3UzcjkrL2dBTUxIa3k0c09IRGlCTXJYc3k0c2VQSGtDTkxua3k1c3VYTG1ETnIzc3k1cytmUG9FT0xIazI2dE9uVHFGT3JYczI2dGV2WHNHUExuazI3dHUzYnVIUHIzczI3dCsvZndJTUxIMDY4dUhFckJnZ1FDS1A4T0JJQkFRU3dHRkFnZ1BVQURBeWtPQkNnQUlvQjE2OGZHR0FDdXZRUjBBTm9SeC9kQkFJRjRSVWtjRTdFL0FydTRhMFhXRzdDd0hVRUo0Q1huM1VIbEdBZmV3RVV5TjcvZVNNME1LQjFBTklYeElIZldaZmRBdzRnVUoxM0ppeHdIWU1rQ0tnY0FRaWt0d0FKRkQ2UVhnRGtpWkNpZ0FLc3A2RjFFazdZWGdyVmdmZ0FBZGExU0VKMStBVklJd2tNRE9uaWpVZnF0K0NQU0lxQWdIWHoxZWhEaWlYd0dFQ1VKSENuWXdMV0dWRGRpU1VJV0lKL1Z5N0pYblhZSGNtZ2xWaU9zSjZVVXpZWnBwRWgwdmxBa1FWNnFJQUpZcGJRbzVscWVoakFjaFQyQ1djUlZOWVpnSkNMa3ZBbm1XMCtZT2dJZjZxSlludlY3VmtvbmZuNWVHZ09pWTR3cWFoMENvaUFjdFUxTUdlampySUlxSXJ0UGNuaXBxdyswT21uTzRRcUFwZGxsc0NkZ2lMZ04rQ3FZMEw1Nm9IcHdiZW1zU0tNV0NtdU9PZ3FRbzVWUGt2bS80TVJpakNxZzdXbVNHRjRJQUpwd3JQUTJnRGRBU09PcUdpTUdGTFhIUW1DK3BxZ29pTW13QzJZbGdJcVlKTXdycGRBZXA0TzRDa0JBcE9Bd0FEWmxndnJnNTZ1R0Y0QmJWYkhRQW15dnJsdmZzRG1xL0VEOE1uSjdZQUZ2R2tsZjVMU0tTMmNEb2ZucWFRZFcvam1BN3dtTElKMStGNU00TXF3Z3BpaWxUbys4RjU4SzQ5TWFyZHlLdnhDY2lSNzBaelJURGZ0OU5OUVJ5MzExRlJYYmZYVldHZXQ5ZFpjZCszMTEyQ0hMWFl6QUpSdDl0bG1xNEQyMm1XcnpUYmFicitkZGdweW54MTMzWGZMbmZmYm1OVTlOd3ArdDAxMzRIdXpYZmphaDhNOXVOK0oyMzFaNEFDNFBiamtnRWMrZWVXVW55QTQ1cHgzYnNMbW1sc2Vldi9maEY4K3V1bWZpMzc2NnF5WEFIcnFxTVB1dWV5dFR3WjU1clRYUHNMcnJxdmVPKzYveDA0Qzc4UDdYanp3eHo5ZSt1ekpNNys3OGMzbkxuMzAweitQdlBYQ1kyL1o3ZG1MUUx6MjFZTWZ2UFBlUXk4KzllT0hYMzcza0hGUC9nUGZyLzgrL09iVGY3Mzg3OGR2Ly96eDYrK1krN3JEWHdEM2w3LzZFVkI5QjB5Zit2VFhQd1ArYjNtaFk5emk4RFpCdlZXUWJ4YzBYQVlSdDBIRmJRK0NxWk5nNVVRWVFRcU8wSVFsdE9BSlZaaENESTd0aFRDTW9ReG5TTU1hMnZDR09NeWhEbmZJd3g3NjhJZEFES0lRaDBqRUlocnhpRWhNb2hLWHlNUW1PdkdKVUl5aUZLZEl4U3BhOFlwWXpLSVd0OGpGTG5yeGkyQU1veGpIU01hV01wcnhqR2hNb3hyWHlNWTJ1dkdOY0l5akhPZEl4enJhOFk1NHpLTWU5OGpIUHZyeGo0QU1wQ0FIU2NoQ0d2S1FpRXlrSWhmSnlFWTY4cEdRaktRa0owbkpTbHJ5a3BqTXBDWTN5Y2xPZXZLVG9BeWxLRWRKeWxLYThwU29US1VxVjhuS1ZycnlsYkNNcFN4blNjdGEydktXdU15bExuZkp5MTc2OHBmQURLWXdoMG5NWWhyem1NaE1waktYeWN4bU92T1phQWdCQUNINUJBVXlBQkFBTE5nQXhnQUpBQWNBQUFVS0lDQ09aR21lYUtxaUlRQWgrUVFGTWdBUUFDenZBTVlBQ1FBSEFBQUZDaUFnam1ScG5taXFvaUVBSWZrRUJUSUFFQUFzQmdIR0FBa0FCd0FBQlFvZ0lJNWthWjVvcXFJaEFDSDVCQVV5QUJBQUxCMEJ4Z0FKQUFjQUFBVUtJQ0NPWkdtZWFLcWlJUUFoK1FRRk1nQVFBQ3cwQWNZQUNRQUhBQUFGQ2lBZ2ptUnBubWlxb2lFQUlma0VCVElBRUFBc1N3SEdBQWtBQndBQUJRb2dJSTVrYVo1b3FxSWhBQ0g1QkFVeUFCQUFMR0lCeGdBSkFBY0FBQVVLSUNDT1pHbWVhS3FpSVFBNyIgLz4nOwogICAgfSwKICAgIHJlZmxlc2hQYWdlTmF2aTpmdW5jdGlvbigpewogICAgICAgIHZhciBwYWdlPXtjdXJyOjEsdG90YWxQYWdlOjEscHJlOnRydWUsbmV4dDp0cnVlLGxzdDpbXX07CiAgICAgICAgcGFnZS5jdXJyPXRoaXMubW9kZWwuY3VycjsKICAgICAgICBwYWdlLnRvdGFsUGFnZT10aGlzLm1vZGVsLnRvdGFsUGFnZT49MTA/MTA6dGhpcy5tb2RlbC50b3RhbFBhZ2U7CiAgICAgICAgcGFnZS5wcmU9cGFnZS5jdXJyPjE/dHJ1ZTpmYWxzZTsKICAgICAgICBwYWdlLm5leHQ9cGFnZS50b3RhbFBhZ2U+cGFnZS5jdXJyP3RydWU6ZmFsc2U7CiAgICAgICAgZm9yKHZhciBpPTE7aTw9cGFnZS50b3RhbFBhZ2U7aSsrKXsKICAgICAgICAgICAgcGFnZS5sc3QucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgdmFyIHRlbXBsYXRlPSAnXAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icGFnZXNlICJpZD0id3h6LXBhZ2VzZSI+XAogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InBhZ2UtY29udGVudCI+XAogICAgICAgICAgICAgICAgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iIDwlIGlmKHRoaXMucHJlKXsgJT4gcGFnZS1udW1iZXIgPCV9ZWxzZXslPiBnbG9iYWwtZGlzYWJsZWQgPCV9JT4gbW91LWV2dCIgZGF0YS1wYWdlPSI8JXRoaXMuY3Vyci0xJT4iPuS4iuS4gOmhtTwvYT5cCiAgICAgICAgICAgICAgICA8JWZvcih2YXIgaSBpbiB0aGlzLmxzdCl7JT5cCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InBhZ2UtbnVtYmVyIDwlaWYodGhpcy5sc3RbaV09PXRoaXMuY3Vycil7JT4gZ2xvYmFsLWRpc2FibGVkIDwlfSU+IiBkYXRhLXBhZ2U9IjwldGhpcy5sc3RbaV0lPiI+PCV0aGlzLmxzdFtpXSU+PC9zcGFuPlwKICAgICAgICAgICAgICAgIDwlfSU+XAogICAgICAgICAgICAgICAgPC9zcGFuPlwKICAgICAgICAgICAgICAgIDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9IiA8JSBpZih0aGlzLm5leHQpeyAlPiBwYWdlLW51bWJlciA8JX1lbHNleyU+IGdsb2JhbC1kaXNhYmxlZCA8JX0lPiBtb3UtZXZ0IiBkYXRhLXBhZ2U9IjwldGhpcy5jdXJyKzElPiI+5LiL5LiA6aG1PC9hPlwKICAgICAgICAgICAgICAgIDwvZGl2PlwKICAgICAgICAgICAgICAgICc7CiAgICAgICAgdmFyIGh0bWw9VGVtcGxhdGVFbmdpbmUodGVtcGxhdGUscGFnZSk7CiAgICAgICAgdGhpcy5VSS5wYWdlc2UuaW5uZXJIVE1MID0gaHRtbDsKICAgIH0KIH07CgoKIHZhciBDb250cm9sbGVyPWZ1bmN0aW9uKG1vZGVsLHZpZXdlcil7CiAgICB0aGlzLm1vZGVsPW1vZGVsOwogICAgdGhpcy52aWV3ZXI9dmlld2VyOwoKICAgIHZhciBfc2VsZj10aGlzOwoKICAgIHRoaXMudmlld2VyLnNlYXJjaENsaWNrLmF0dGFjaChmdW5jdGlvbihzZW5kZXIsYXJncyl7CiAgICAgICAgX3NlbGYuc2VhcmNoKGFyZ3MuY3VycixhcmdzLmtleXdvcmQpOwogICAgfSk7CiAgICB0aGlzLnZpZXdlci5jbG9zZUNsaWNrLmF0dGFjaChmdW5jdGlvbigpewogICAgICAgIF9zZWxmLmNsb3NlKCk7CiAgICB9KTsKICAgIHRoaXMudmlld2VyLmVuZ2luZU9wdENoYW5nZS5hdHRhY2goZnVuY3Rpb24oc2VuZGVyLGFyZ3MpewogICAgICAgIF9zZWxmLnNldEVuZ2luZShhcmdzKTsKICAgIH0pOwogICAgdGhpcy52aWV3ZXIudG9QYWdlQ2xpY2suYXR0YWNoKGZ1bmN0aW9uKHNlbmRlcixhcmdzKXsKICAgICAgICBfc2VsZi50b1BhZ2UoYXJncyk7CiAgICB9KTsKCiAgICB0aGlzLm1vZGVsLnJlcXVlc3RFdmVudC5hdHRhY2goZnVuY3Rpb24oKXsKICAgICAgICBfc2VsZi5sb2FkaW5nKCk7CiAgICB9KTsgCiAgICB0aGlzLm1vZGVsLmNvbnRlbnRVcGRhdGVkLmF0dGFjaChmdW5jdGlvbihzdGF0ZSl7CiAgICAgICAgX3NlbGYucmVmbGVzaChzdGF0ZSk7CiAgICB9KTsKCiB9OwogQ29udHJvbGxlci5wcm90b3R5cGU9ewogICAgc2VhcmNoOmZ1bmN0aW9uKGN1cnIsYXJncyl7CiAgICAgICAgdGhpcy5tb2RlbC51cGRhdGVDdXJyKGN1cnIpOwogICAgICAgIHRoaXMubW9kZWwudXBkYXRlS2V5d29yZChhcmdzKTsKICAgICAgICB0aGlzLm1vZGVsLnJlcXVlc3QoKTsKICAgICAgICB0aGlzLnZpZXdlci5zaG93KCk7CiAgICB9LAogICAgc2V0RW5naW5lOmZ1bmN0aW9uKGVuZ2luZSl7CiAgICAgICAgdGhpcy5tb2RlbC5zZXRFbmdpbmUoZW5naW5lKTsKICAgICAgICB0aGlzLnZpZXdlci51cGRhdGVFbmdpbmUoKTsKICAgIH0sCiAgICB0b1BhZ2U6ZnVuY3Rpb24odG9QYWdlTnVtKXsKICAgICAgICB0aGlzLm1vZGVsLnVwZGF0ZUN1cnIodG9QYWdlTnVtKTsKICAgICAgICB0aGlzLm1vZGVsLnJlcXVlc3QoKTsKICAgIH0sCiAgICBjbG9zZTpmdW5jdGlvbigpewogICAgICAgIHRoaXMubW9kZWwuZGVzdG9yeSgpOwogICAgICAgIHRoaXMudmlld2VyLmNsb3NlKCk7CiAgICB9LAogICAgbG9hZGluZzpmdW5jdGlvbigpewogICAgICAgIHRoaXMudmlld2VyLmxvYWRpbmcoKTsKICAgIH0sCiAgICByZWZsZXNoOmZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy52aWV3ZXIucmVmbGVzaCgpOwogICAgICAgIHRoaXMudmlld2VyLnJlZmxlc2hQYWdlTmF2aSgpOwogICAgfSwKICAgIHJlZmxlc2hFbmdpbmVMc3Q6ZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLnZpZXdlci5yZWZsZXNoRW5naW5lTHN0KCk7CiAgICB9LAogfTsKCgoKZnVuY3Rpb24gbmV3SW5pdCAoKSB7CiAgICAvL3JlbW92ZSBhZHZzCiAgICAvL2NyZWF0ZSBzZWFyY2ggYmFyCiAgICBpZihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyLXVuaW9uJykpewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXItdW5pb24nKS5yZW1vdmUoKTsKICAgIH0KICAgIHZhciB0YXJnZXROb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlci1pbmZvJyk7CiAgICB2YXIgd3h6U2VhcmNoQmFyTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RkJyk7CiAgICB3eHpTZWFyY2hCYXJOb2RlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCdoZWFkZXItd3h6YmFyIGhlYWRlci1pbmZvJyk7CiAgICAvL3d4elNlYXJjaEJhck5vZGUuc2V0QXR0cmlidXRlKCdub2RlLXR5cGUnLCdoZWFkZXItYXBwcycpOwogICAgd3h6U2VhcmNoQmFyTm9kZS5pbm5lckhUTUwgPQogICAgICAgICAgICAnPHNwYW4gY2xhc3M9Ind4ei1tZW51IHd4ei1kcm9wZG93biI+XAogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InVzZXItbmFtZSIgaWQ9Ind4ek1lbnVEaXNwbGF5Ij5nb29nbGU8L3NwYW4+XAogICAgICAgICAgICAgICAgPGVtIGNsYXNzPSJpY29uIGljb24tZHJvcGRvd24tYXJyb3ciPjwvZW0+XAogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJ3eHotbWVudS1jb250ZW50IiBpZD0id3h6X2VuZ2luZUxzdCI+XAogICAgICAgICAgICAgICAgPC91bD5cCiAgICAgICAgICAgIDwvc3Bhbj5cCiAgICAgICAgICAgIDxmb3JtIGNsYXNzPSJzZWFyY2gtZm9ybSIgaWQ9Ind4el9zZWFyY2hGb3JtIj5cCiAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9InNlYXJjaC1xdWVyeSIgcGxhY2Vob2xkZXI9IiDmkJzntKLlhazlvIDliIbkuqvmlofku7YiIGlkPSJ3eHpfaW5wdXQiPlwKICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIHZhbHVlPSJHTyIgY2xhc3M9InNlYXJjaC1idXR0b24iIGlkPSJ3eHpfc2VhcmNoQnV0dG9uIj5cCiAgICAgICAgICAgIDwvZm9ybT4nOwogICAgLy9pbnNlcnQgYWZ0ZXIgdGFyZ2V0IG5vZGUKICAgIHRhcmdldE5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUod3h6U2VhcmNoQmFyTm9kZSx0YXJnZXROb2RlLm5leHRTbGliaW5nKTsKICAgIC8vYmFja2dyb3VuZAogICAgdmFyIHd4emJnTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgd3h6YmdOb2RlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCd3eHotYmcnKTsKICAgIHd4emJnTm9kZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmFwcGVuZENoaWxkKHd4emJnTm9kZSk7CgogICAgLy9jcmVhdGUgZGlzcGxheSBmcmFtZQogICAgdmFyIHd4ekRpYWxvZ05vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHd4ekRpYWxvZ05vZGUuc2V0QXR0cmlidXRlKCdjbGFzcycsJ2RpYWxvZyBkaWFsb2ctZ3JheScpOwogICAgd3h6RGlhbG9nTm9kZS5zZXRBdHRyaWJ1dGUoJ2lkJywnd3h6X215RGl2Jyk7CiAgICB3eHpEaWFsb2dOb2RlLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCd6LWluZGV4Ojk5O3Bvc3Rpb246YWJzb2x1dGU7Jyk7CiAgICB3eHpEaWFsb2dOb2RlLnN0eWxlLndpZHRoID0gd2luZG93LmlubmVyV2lkdGggLyAzICogMiArICdweCc7CiAgICB3eHpEaWFsb2dOb2RlLnN0eWxlLmxlZnQgPSAnNTAlJzsgICAgCiAgICB3eHpEaWFsb2dOb2RlLnN0eWxlLm1hcmdpbkxlZnQgPSAoLTEgKiB3aW5kb3cuaW5uZXJXaWR0aCAvIDMpICsgJ3B4JzsgCiAgICB3eHpEaWFsb2dOb2RlLmlubmVySFRNTCA9IAogICAgICAgICdcCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRpYWxvZy1oZWFkZXIiIGlkPSJ3eHpfbXlEaXZfdGl0bGUiPlwKICAgICAgICAgICAgICAgIDxoMyA+PHNwYW4gY2xhc3M9ImRpYWxvZy1oZWFkZXItdGl0bGUiPuaQnOe0ojwvc3Bhbj48L2gzPlwKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRpYWxvZy1jb250cm9sIiBpZD0id3h6X2Nsb3NlQnV0dG9uIj48c3BhbiBjbGFzcz0iZGlhbG9nLWljb24gZGlhbG9nLWNsb3NlIGljb24gaWNvbi1jbG9zZSI+PHNwYW4gY2xhc3M9InNpY29uIj7Dlzwvc3Bhbj48L3NwYW4+PC9kaXY+XAogICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRsZy1iZCBnLWNsZWFyZml4IG9mZmxpbmUtbGlzdC1kaWFsb2ciPlwKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Ind4ei1jb250ZW50Ij5cCiAgICAgICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvZmZsaW5lLWJvdHRvbSI+XAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9mZmxpbmUtcGFnZWluZyI+XAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwYWdlc2UgIiBpZD0id3h6LXBhZ2VzZSI+XAogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XAogICAgICAgICAgICA8L2Rpdj5cCiAgICAgICAgJzsKCiAgICAvL2FwcGVuZCB0byBib2R5CgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmFwcGVuZENoaWxkKHd4ekRpYWxvZ05vZGUpOwoKCiAgICB2YXIgd3h6U3R5bGVOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgIHd4elN0eWxlTm9kZS50ZXh0Q29udGVudCA9IAogICAgJ1wKICAgIC53eHotbWVudXtjdXJzb3I6cG9pbnRlcjsgaGVpZ2h0OjEwMCU7IGRpc3BsYXk6aW5saW5lLWJsb2NrOyB2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7cG9zaXRpb246cmVsYXRpdmU7fVwKICAgIC53eHotbWVudTpob3ZlciAud3h6LW1lbnUtY29udGVudHtkaXNwbGF5OmJsb2NrOyB6LWluZGV4Ojk5fVwKICAgIC53eHotbWVudTpob3ZlciAuaWNvbi1kcm9wZG93bi1hcnJvd3t0cmFuc2Zvcm06cm90YXRlKDE4MCk7fVwKICAgIC53eHotbWVudS1vcHRpb257dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MzBweDtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kOndoaXRlO2NvbG9yOmJsYWNrO2JvcmRlcjoxcHggc29saWQgI2VmZjRmODtib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlO31cCiAgICAjd3h6X3NlYXJjaEZvcm17ZGlzcGxheTppbmxpbmUtYmxvY2s7IHZlcnRpY2FsLWFsaWduOm1pZGRsZTt9XAogICAgI3d4el9pbnB1dHtwYWRkaW5nOjAgNHB4OyBib3JkZXI6IDFweCBzb2xpZCAjYzBkOWZlO2JvcmRlci1yYWRpdXM6IDRweDtsaW5lLWhlaWdodDogMjJweDt9XAogICAgI3d4el9zZWFyY2hCdXR0b257Y3Vyc29yOnBvaW50ZXI7IGJhY2tncm91bmQ6ICMzYjhjZmY7Ym9yZGVyOiAycHggc29saWQgIzNiOGNmZjtjb2xvcjogI2Y4ZmJmZjtib3JkZXItcmFkaXVzOiA2cHg7fVwKICAgIC53eHotbWVudS1jb250ZW50e2Rpc3BsYXk6bm9uZTsgcG9zaXRpb246YWJzb2x1dGU7dG9wOjEwMCU7bGVmdDowO3dpZHRoOjgwcHg7fVwKICAgICN3eHpNZW51RGlzcGxheXtsaW5lLWhlaWdodDogNDBweDsgZGlzcGxheTppbmxpbmUtYmxvY2s7IHdpZHRoOjQwcHg7fVwKICAgIC53eHotYmd7cG9zaXRpb246IGZpeGVkOyBsZWZ0OiAwcHg7IHRvcDogMHB4OyBib3R0b206IDBweDsgcmlnaHQ6IDBweDsgei1pbmRleDogNTA7IGJhY2tncm91bmQ6IHJnYigwLCAwLCAwKTsgb3BhY2l0eTogMC41O31cCiAgICAud3h6LWNvbnRlbnR7aGVpZ2h0OiA1MDBweDtsaW5lLWhlaWdodDogMjAwJTt0ZXh0LWFsaWduOiBsZWZ0O3doaXRlLXNwYWNlOiBub3JtYWw7cGFkZGluZzowIDEwcHg7b3ZlcmZsb3c6YXV0bzt9XAogICAgLnd4ei1jbG9zZXttYXJnaW4tcmlnaHQ6MjBweDtpbXBvcnRhbnQ7aGVpZ2h0OjIwcHg7Y3Vyc29yOnBvaW50ZXJ9XAogICAgLnd4ei1uZXh0e21hcmdpbi1yaWdodDoyMHB4O2Zsb2F0OnJpZ2h0O2hlaWdodDoyMHB4O2N1cnNvcjpwb2ludGVyfVwKICAgIC53eHotZnJvbnR7bWFyZ2luLXJpZ2h0OjQwcHg7ZmxvYXQ6cmlnaHQ7aGVpZ2h0OjIwcHg7Y3Vyc29yOnBvaW50ZXJ9XAogICAgLnd4ei1jb250ZW50IGF7Y29sb3I6IzAwNjZGRiFpbXBvcnRhbnQ7Zm9udDogMTRweC8xLjUgYXJpYWwsc2Fucy1zZXJpZiFpbXBvcnRhbnQ7fVwKICAgICc7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kQ2hpbGQod3h6U3R5bGVOb2RlKTsgICAgCgoKCgogICAgdmFyIGJkTW9kZWw9bmV3IEJhc2VNb2RlbChbJ2JpbmcnLCdnb29nbGUnXSk7CgogICAgYmRNb2RlbC51cmxzLmJpbmc9J2h0dHA6Ly9jbi5iaW5nLmNvbS9zZWFyY2g/cT0nOwogICAgYmRNb2RlbC51cmxzLmdvb2dsZT0naHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vY3VzdG9tc2VhcmNoL3YxZWxlbWVudD9rZXk9QUl6YVN5Q1ZBWGlVelJZc01MMVB2NlJ3U0cxZ3VubU1pa1R6UXFZJnJzej1maWx0ZXJlZF9jc2UmbnVtPTEwJmhsPWVuJnByZXR0eVByaW50PXRydWUmc291cmNlPWdjc2MmZ3NzPS5jb20mc2lnPWVlOTNmOWFhZTljOWU5ZGJhNWVlYTgzMWQ1MDZlNjlhJmN4PTAxODE3NzE0MzM4MDg5MzE1MzMwNTp5azBxcGd5ZHhfZSZxPSc7CgogICAgYmRNb2RlbC50b0pzb24uYmluZz1mdW5jdGlvbihodG1sKXsKICAgICAgICB2YXIgZGF0YSA9IHsgY3Vyc29yOiB7IGVzdGltYXRlZFJlc3VsdENvdW50OiAwLCByZXN1bHRDb3VudDogMCB9LCByZXN1bHRzOiBbXSB9OwogICAgICAgIC8v5YW25Lit5LiA5p2h57uT5p6c77yaCiAgICAgICAgLy88bGkgY2xhc3M9ImJfYWxnbyI+PGgyPgogICAgICAgIC8vPGEgaHJlZj0iaHR0cDovL3Bhbi5iYWlkdS5jb20vd2FwL2xpbms/dWs9MjkyMzExMDY1OCZhbXA7c2hhcmVpZD0zNDY4ODE1ODM0JmFtcDt0aGlyZD0zIiB0YXJnZXQ9Il9ibGFuayIgaD0iSUQ9U0VSUCw1MTAxLjEiPllGSy08c3Ryb25nPlJLMzM2ODwvc3Ryb25nPi04MTg5LTIwMTUwODIxLnJhcl/lhY3otLnpq5jpgJ/kuIvovb1855m+5bqm5LqRIOe9keebmCAuLi48L2E+PC9oMj4KICAgICAgICAvLzxkaXYgY2xhc3M9ImJfY2FwdGlvbiI+PHA+5paH5Lu25ZCNOllGSy08c3Ryb25nPlJLMzM2ODwvc3Ryb25nPi04MTg5LTIwMTUwODIxLnJhciDmlofku7blpKflsI86NDk3LjU1TSDliIbkuqvogIU65pmo6IqvRkFFIOWIhuS6q+aXtumXtDoyMDE1LTgtMjEgMTQ6MDcg5LiL6L295qyh5pWwOjUgLi4uIOeZu+W9leeZvuW6puS6keWuouaIt+err+mAgTJU56m66Ze0IOeUteiEkeeJiDwvcD4KICAgICAgICAvLzxkaXYgY2xhc3M9ImJfYXR0cmlidXRpb24iIHU9IjB8NTA1OHw0ODM1MjcxMzg2OTkxMjQ4fDhPTWhjR0lJajhHVzA4STQxUjVVb1N5SnBsMl81UG55Ij48Y2l0ZT48c3Ryb25nPnBhbi5iYWlkdS5jb208L3N0cm9uZz4vd2FwL2xpbms/dWs9MjkyMzExMDY1OCZhbXA7c2hhcmVpZD0zNDY4ODE1ODM0JmFtcDsuLi48L2NpdGU+PHNwYW4gY2xhc3M9ImNfdGxieFRyZyI+CiAgICAgICAgLy88c3BhbiBjbGFzcz0iY190bGJ4SCIgSD0iQkFTRTpDQUNIRURQQUdFREVGQVVMVCIgSz0iU0VSUCw1MTAyLjEiPjwvc3Bhbj48L3NwYW4+PC9kaXY+PC9kaXY+PC9saT4KICAgICAgICAvL2h0dHA6Ly93d3cuamI1MS5uZXQvYXJ0aWNsZS80OTA4My5odG3lnKhKU+S4reino+aekEhUTUzlrZfnrKbkuLLnpLrkvovku6PnoIHvvJoKICAgICAgICB2YXIgcmF3UmVzdWx0SFRNTCA9IGh0bWwubWF0Y2goLzxsaVxzY2xhc3M9ImJfYWxnbyI+KC4qPyk8XC9saT4vZyk7CiAgICAgICAgdmFyIGJfcmVzdWx0cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CiAgICAgICAgYl9yZXN1bHRzLmlubmVySFRNTCA9IHJhd1Jlc3VsdEhUTUw7CiAgICAgICAgdmFyIGJfYWxnb19BcnJ5ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYl9yZXN1bHRzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2JfYWxnbycpKTsKICAgICAgICBiX2FsZ29fQXJyeS5mb3JFYWNoKGZ1bmN0aW9uKGVsZSwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHRlbXBSZXN1bHQgPSB7CiAgICAgICAgICAgICAgICB1bmVzY2FwZWRVcmw6ICIiLAogICAgICAgICAgICAgICAgdGl0bGVOb0Zvcm1hdHRpbmc6ICIiLAogICAgICAgICAgICAgICAgY29udGVudE5vRm9ybWF0dGluZzogIiIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGVtcFJlc3VsdC51bmVzY2FwZWRVcmwgPSBlbGUucXVlcnlTZWxlY3RvcignaDIgYScpLmdldEF0dHJpYnV0ZSgnaHJlZicpOwogICAgICAgICAgICB0ZW1wUmVzdWx0LnRpdGxlTm9Gb3JtYXR0aW5nID0gZWxlLnF1ZXJ5U2VsZWN0b3IoJ2gyIGEnKS50ZXh0Q29udGVudDsKICAgICAgICAgICAgdGVtcFJlc3VsdC5jb250ZW50Tm9Gb3JtYXR0aW5nID0gZWxlLnF1ZXJ5U2VsZWN0b3IoJy5iX2NhcHRpb24gcCcpLnRleHRDb250ZW50OwogICAgICAgICAgICBkYXRhLnJlc3VsdHMucHVzaCh0ZW1wUmVzdWx0KTsKICAgICAgICB9KTsKICAgICAgICAvLy8v5aSE55CG57uf6K6h57uT5p6cCiAgICAgICAgdmFyIHJhd1Jlc3VsdENvdW50PWh0bWwubWF0Y2goLzxzcGFuLio/c2JfY291bnQuKj8+KC4qPyk8XC9zcGFuPi8pWzFdOwogICAgICAgIHZhciBtYXRjaExzdD1bXTsgICAgCiAgICAgICAgbWF0Y2hMc3Q9cmF3UmVzdWx0Q291bnQubWF0Y2goLyhbMC05XXsxLDN9KCxbMC05XXszfSkrKS9nKTsKICAgICAgICBpZihtYXRjaExzdCE9PW51bGwpey8v5Yy56YWNMTAwLDAwMCwxMTHkuYvnsbvnmoTmg4XlhrUKICAgICAgICAgICAgZGF0YS5jdXJzb3IucmVzdWx0Q291bnQ9bWF0Y2hMc3RbMF0ucmVwbGFjZSgnLCcsJycpOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBtYXRjaExzdD1yYXdSZXN1bHRDb3VudC5tYXRjaCgvXGQrL2cpOwogICAgICAgICAgICBpZihtYXRjaExzdCE9PW51bGwpey8v5Yy56YWNMTAg5Liq57uT5p6c5LmL57G755qE5oOF5Ya177yM5Lul5Y+KMS0xMe+8jOWFsTEx5Liq55qE5oOF5Ya1CiAgICAgICAgICAgIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50PW1hdGNoTHN0LnBvcCgpOwogICAgICAgICAgICB9ZWxzZXsvL+WMuemFjeaXoOeahOaDheWGtQogICAgICAgICAgICBkYXRhLmN1cnNvci5yZXN1bHRDb3VudD0wOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50ID0gcGFyc2VJbnQoIGRhdGEuY3Vyc29yLnJlc3VsdENvdW50LnRvU3RyaW5nKCksMTApOwogICAgICAgIGRhdGEuY3Vyc29yLmVzdGltYXRlZFJlc3VsdENvdW50ID0gZGF0YS5jdXJzb3IucmVzdWx0Q291bnQ7CiAgICAgICAgcmV0dXJuIGRhdGE7ICAgICAgICAKICAgIH07CiAgICBiZE1vZGVsLnRvSnNvbi5nb29nbGU9ZnVuY3Rpb24ocmVzcG9uc2VUZXh0KXsKICAgICAgICB2YXIgZGF0YT1KU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CiAgICAgICAgZGF0YS5jdXJzb3IucmVzdWx0Q291bnQ9cGFyc2VJbnQoZGF0YS5jdXJzb3IucmVzdWx0Q291bnQuc3BsaXQoJywnKS5qb2luKCcnKSk7CiAgICAgICAgcmV0dXJuIGRhdGE7ICAgICAgICAKICAgIH07CgogICAgYmRNb2RlbC5jb21waWxlVXJsLmJpbmc9ZnVuY3Rpb24oX3NlbGYpewogICAgICAgIHJldHVybiBfc2VsZi51cmxzLmJpbmcgKyBfc2VsZi5rZXl3b3JkICsgJytzaXRlJTNBcGFuLmJhaWR1LmNvbScgKyAnJmZpcnN0PScgKyAoX3NlbGYuY3Vyci0xKSoxMDsKICAgIH07CiAgICBiZE1vZGVsLmNvbXBpbGVVcmwuZ29vZ2xlPWZ1bmN0aW9uKF9zZWxmKXsKICAgICAgICByZXR1cm4gX3NlbGYudXJscy5nb29nbGUgKyBfc2VsZi5rZXl3b3JkICsgJyZzdGFydD0nICsgKF9zZWxmLmN1cnItMSkqMTA7CiAgICB9OwoKICAgIHZhciBiZFZpZXc9bmV3IFZpZXdlcihiZE1vZGVsLHsKICAgICAgICBpbnB1dEVsZTpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6X2lucHV0JyksCiAgICAgICAgc2VhcmNoQnRuOmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHpfc2VhcmNoQnV0dG9uJyksCiAgICAgICAgY2xvc2VCdG46ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3d4el9jbG9zZUJ1dHRvbicpLAogICAgICAgIG15RGl2OmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHpfbXlEaXYnKSwKICAgICAgICBteUNvbnRlbnQ6ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnd4ei1jb250ZW50JyksCiAgICAgICAgbWVudTpkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3h6TWVudURpc3BsYXknKSwKICAgICAgICBlbmdpbmVCdG5DbGFzc05hbWU6J3d4ei1tZW51LW9wdGlvbicsCiAgICAgICAgZW5naW5lTHN0OmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHpfZW5naW5lTHN0JyksCiAgICAgICAgcGFnZXNlOmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3eHotcGFnZXNlJyksCiAgICAgICAgdG9QYWdlQnRuQ2xhc3NOYW1lOidwYWdlLW51bWJlcicsCiAgICAgICAgYmdOb2RlOnd4emJnTm9kZQogICAgfSk7CiAgICB2YXIgYmRDb250cm9sbGVyPW5ldyBDb250cm9sbGVyKGJkTW9kZWwsYmRWaWV3KTsKICAgIGJkQ29udHJvbGxlci5yZWZsZXNoRW5naW5lTHN0KCk7CgkvL+i/memHjOWGmeeahOS4jeWlvQogICAgdmFyIHRlbXBTdHIgPSAnJzsKICAgIHZhciB0ZW1wT2JqOwogICAgdGVtcFN0ciA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnd3h6WXVucGFuU2VhcmNoZXInKTsKICAgIGlmICh0ZW1wU3RyKSB7CiAgICAJdGVtcE9iaiA9IEpTT04ucGFyc2UodGVtcFN0cik7CiAgICAJYmRDb250cm9sbGVyLnNldEVuZ2luZSh0ZW1wT2JqLmVuZ2luZSk7CiAgICB9CiAgICBlbHNlewogICAgCWJkQ29udHJvbGxlci5zZXRFbmdpbmUoJ2JpbmcnKTsKICAgIH0KICAgIAoKfQoKdmFyIGNvdW50ZXIgPSAwOwoKdmFyCnQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7IC8v55m+5bqm5LqR5oqK5LiA5Lqb5YaF5a655pS+5Yiw5ZCO6Z2i5Yqg6L29LOWboOatpOaIkeiuvue9ruS6huS4gOS4quW7tuaXtuW+queOr++8jOavj+malDIwMG1z6YCJ5oup5LiA5LiL5omA6ZyA55qE5YWD57Sg77yM5b2T5omA6ZyA55qE5YWD57Sg5a2Y5Zyo5pe277yM5byA5aeL6ISa5pys77yM5ZCM5pe25YGc5q2i5bu25pe25b6q546vIAogICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5oZWFkZXItaW5mbyIpICE9PSBudWxsKSB7CiAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodCk7CiAgICAgICAgbmV3SW5pdCgpOwogICAgfQogICAgZWxzZXsKICAgICAgICBpZihjb3VudGVyIDwgMTAwKXsKICAgICAgICAgICAgY29uc29sZS5sb2coJ3dhaXRpbmcnKTsKICAgICAgICAgICAgY291bnRlciArKzsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvdXQgb2YgdGltZScpOwogICAgICAgIH0KICAgIH0KfSwgMjAwKTsK"},{"name":"YouTube +","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":["*://www.youtube.com/tv*","*://www.youtube.com/embed/*","*://www.youtube.com/live_chat*"],"orig_includes":[],"orig_matches":["*://www.youtube.com/*"],"orig_noframes":true,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]}},"storage":{"data":{"particleSettings":"s{\"GEN_BTTR_NTF\":true,\"GEN_SUB_LIST\":true,\"GEN_INF_SCRL\":true,\"GEN_BLUE_GLOW\":true,\"GEN_PPOT_ON\":true,\"VID_END_SHRE\":true,\"VID_DFLT_QLTY\":\"auto\",\"VID_PLST_ATPL\":true,\"VID_PLST_RVRS\":true,\"VID_PLR_ATPL\":true,\"VID_PLR_ALVIS\":true,\"VID_PLR_SIZE_MEM\":true,\"VID_PLR_VOL_LDN\":true,\"VID_POST_TIME\":true,\"VID_VID_CNT\":true,\"VID_DESC_SHRT\":true,\"VID_PPOT_SZ\":533,\"VID_PLR_HTML5\":true,\"BLK_ON\":true,\"floaterX\":2000,\"floaterY\":2000,\"firstTime\":false,\"volLev\":50,\"advOpts\":true,\"blacklist\":{\"UCPgRPAzeQg1UL8w_M2VN97Q\":\"禁书网\",\"UC2mLqX_IavAs3TPK3GNlzAw\":\"中国內幕\",\"UCt5zpwa264A0B-gaYtv1IpA\":\"美国之音中文网\",\"UCDrj0cP9ZQ7R9Qq_kZPpjKA\":\"NTDChinaNewsChannel\",\"UCfb1VoSCsIS7kIXMTYNhvXw\":\"中國觀察\",\"UClAHEcSSQa5aql2i81U8Idw\":\"江泽民丑行录\",\"UCdbvc-yJ4JQjNGTgFiJIZNA\":\"NTDCHINESE\",\"UCYSHqbSBDD0X3NC-ze8z5xQ\":\"ntdtvchinese2\"},\"extLang\":{\"zh_CN\":{\"YTSETS\":\"YouTube+ 设置\",\"ADV_OPTS\":\"高级选项\",\"SUB_PLST\":\"播放最新上传的内容\",\"PPOT_OPEN\":\"在弹出窗口中打开\",\"BLCK_ADD\":\"添加到黑名单\",\"BLCK_EDIT\":\"编辑\",\"BLCK_SAVE\":\"保存\",\"BLCK_CLSE\":\"关闭\",\"CNSL_AP\":\"自动播放\",\"CNSL_RPT\":\"循环播放\",\"CNSL_SVTH\":\"打开缩略图\",\"CNSL_SS\":\"画面截图\",\"CNSL_SS_CLS\":\"关闭\",\"CNSL_PPOT\":\"弹出播放视频\",\"CNSL_FLBR\":\"网页全屏模式\",\"CNSL_CINM_MD\":\"影院模式\",\"CNSL_YTSC\":\"YouTube 快捷键列表\",\"PLST_AP\":\"自动播放\",\"PLST_RVRS\":\"倒序排列\",\"SHOW_CMTS\":\"显示评论\",\"HIDE_CMTS\":\"隐藏评论\",\"GLB_IMPR\":\"导入/导出设置\",\"GLB_LOCL_LANG\":\"点击修改 YT+ 语言\",\"GLB_LOCL_LANG_CSTM\":\"本地化\",\"GLB_IMPR_SAVE\":\"保存并加载\",\"GLB_RSET\":\"重置\",\"GLB_RSET_CONF\":\"这将重置YT+的所有设置和黑名单。是否要继续？\",\"GLB_SVE\":\"保存\",\"GLB_SVE_SETS\":\"设置已保存\",\"GLB_RMBL\":\"从黑名单中移除\",\"FTR_DESC\":\"详细了解\",\"GEN\":\"常规\",\"VID\":\"视频\",\"CHN\":\"频道\",\"BLK\":\"黑名单\",\"ABT\":\"关于\",\"HLP\":\"帮助\",\"DNT\":\"捐赠\",\"GEN_TTL\":\"通用设置\",\"GEN_GEN\":\"常规\",\"GEN_LYT\":\"布局\",\"GEN_LOCL_LANG\":\"使用自定义的 YT+ 语言包\",\"GEN_PPOT_ON\":\"启用弹出模式\",\"GEN_DSBL_ADS\":\"禁止视频页面以外的广告\",\"GEN_INF_SCRL\":\"在信息源列表启用无限滚动\",\"GEN_YT_LOGO_LINK\":\"YouTube 标志重定向到订阅页\",\"GEN_SUB_LIST\":\"启用订阅播放列表\",\"GEN_REM_APUN\":\"去除自动播放下一个\",\"GEN_SPF_OFF\":\"禁用动态加载\",\"GEN_HIDE_FTR\":\"隐藏页脚\",\"GEN_BLUE_GLOW\":\"去除点击过的按钮周围的蓝色光圈\",\"GEN_HDE_RECM_SDBR\":\"隐藏推荐频道侧边栏\",\"GEN_HDE_SRCH_SDBR\":\"隐藏搜索结果侧边栏\",\"GEN_HDE_CHN_SDBR\":\"隐藏频道侧边栏\",\"GEN_CMPT_TTLS\":\"在信息源中使用缩略标题\",\"GEN_DSB_HVRC\":\"禁用悬停卡片\",\"GEN_BTTR_NTF\":\"改进的蓝色通知框\",\"GEN_GRID_SUBS\":\"在订阅中使用网格布局\",\"GEN_GRID_SRCH\":\"在搜索结果中使用网格布局\",\"VID_TTL\":\"视频设置\",\"VID_PLR\":\"播放器设置\",\"VID_PLR_LYT\":\"播放器布局\",\"VID_DFLT_QLTY\":\"默认视频质量：\",\"VID_DFLT_QLTY_AUTO\":\"自动\",\"VID_DFLT_QLTY_TNY\":\"144p\",\"VID_DFLT_QLTY_SML\":\"240p\",\"VID_DFLT_QLTY_MDM\":\"360p\",\"VID_DFLT_QLTY_LRG\":\"480p\",\"VID_DFLT_QLTY_720\":\"720p\",\"VID_DFLT_QLTY_1080\":\"1080p\",\"VID_DFLT_QLTY_1440\":\"1440p\",\"VID_DFLT_QLTY_2160\":\"2160p (4k)\",\"VID_DFLT_QLTY_2880\":\"2880p (5k)\",\"VID_DFLT_QLTY_ORIG\":\"4320p (8k)\",\"VID_PLR_ALVIS\":\"阅读评论时保持播放器可见\",\"VID_PLR_ALVIS_WDTH\":\"悬浮播放器宽度\",\"VID_PLR_ALVIS_RST\":\"重设位置\",\"VID_PLR_ALVIS_SCRL_TOP\":\"返回顶部\",\"VID_PLR_ATPL\":\"自动播放视频\",\"VID_LAYT\":\"布局\",\"VID_VID_CNT\":\"显示已上传视频数及链接\",\"VID_POST_TIME\":\"显示视频已发布时间\",\"VID_HIDE_DETLS\":\"隐藏视频详细信息\",\"VID_HIDE_COMS\":\"评论区\",\"VID_HIDE_COMS_SHOW\":\"显示\",\"VID_HIDE_COMS_HIDE\":\"隐藏\",\"VID_HIDE_COMS_REM\":\"去除\",\"VID_END_SHRE\":\"禁用视频结束时的分享面板\",\"VID_PLST\":\"播放列表\",\"VID_PLST_ATPL\":\"启用播放列表的自动播放按钮\",\"VID_PLST_RVRS\":\"启用播放列表的倒序排列按钮\",\"VID_PLR_SIZE_MEM\":\"记住播放模式\",\"VID_VOL_WHEEL\":\"使用鼠标滚轮更改音量\",\"VID_PLR_VOL_MEM\":\"记住音量\",\"VID_PLR_VOL_LDN\":\"禁用 YouTube 响度统一化\",\"VID_PLR_ADS\":\"禁用视频页面中的广告\",\"VID_PLR_ALACT\":\"播放器快捷键始终生效\",\"VID_SUB_ADS\":\"仅启用已订阅频道中视频的广告\",\"VID_PLR_ANTS\":\"禁用注释\",\"VID_PLR_HFR\":\"禁用高帧率 (60fps)\",\"VID_PLR_HTML5\":\"可能时使用 HTML 5 播放器\",\"VID_PLR_CC\":\"禁用字幕和隐藏式字幕\",\"VID_PLR_INFO\":\"启用稍后观看按钮\",\"VID_PLR_FIT\":\"为剧场模式适配页面\",\"VID_PLR_FIT_WDTH\":\"适配页面最大宽度:\",\"VID_PLR_DYN_SIZE\":\"默认视图中禁用播放器动态调节尺寸\",\"VID_DESC_SHRT\":\"小巧的视频描述按钮\",\"VID_TTL_CMPT\":\"缩略视频描述标题\",\"VID_PPOT_SZ\":\"弹出播放器的大小\",\"VID_LAYT_AUTO_PNL\":\"自动展开视频描述\",\"GEN_CHN_DFLT_PAGE\":\"默认的频道页面：\",\"GEN_CHN_DFLT_PAGE_DFLT\":\"默认\",\"GEN_CHN_DFLT_PAGE_VID\":\"视频\",\"GEN_CHN_DFLT_PAGE_PL\":\"播放列表\",\"GEN_CHN_DFLT_PAGE_CHN\":\"频道\",\"GEN_CHN_DFLT_PAGE_DISC\":\"讨论\",\"GEN_CHN_DFLT_PAGE_ABT\":\"关于\",\"BLK_TTL\":\"黑名单设置\",\"BLK_BLK\":\"黑名单\",\"BLK_ON\":\"启用黑名单\",\"ABT_TTL\":\"相关信息和实用链接\",\"ABT_THKS\":\"鸣谢：\",\"ABT_THKS_YEPPHA\":\"，他们的成果给此项目带来了灵感，没有他们，今天这些就不会存在。\",\"ABT_THKS_USERSCRIPT\":\" 使开发和发行第三方软件的任务无比简单。\",\"ABT_THKS_STACKOV\":\" 无价的信息对软件开发做出了巨大贡献。\",\"ABT_INFO\":\"官方页面\",\"ABT_LNK_GHB\":\"GitHub\",\"ABT_LNK_GRFK\":\"Greasy Fork\",\"ABT_LNK_OPNU\":\"OpenUserJS\",\"WLCM\":\"感谢您安装 YouTube+\",\"WLCMSTRT\":\"您可以点击上面的按钮来自定义您的设置\",\"WLCMFTRS\":\"点击这里查看所有特性的介绍\",\"LOCALE\":\"中文 (简体)\",\"lastMod\":1480553355000},\"nextCheck\":1481160585881},\"GEN_HDE_CHN_SDBR\":false,\"GEN_HDE_SRCH_SDBR\":false,\"GEN_HDE_RECM_SDBR\":false,\"GEN_HIDE_FTR\":false,\"GEN_CMPT_TTLS\":false,\"GEN_DSB_HVRC\":false,\"GEN_GRID_SRCH\":false,\"GEN_GRID_SUBS\":false,\"GEN_CHN_DFLT_PAGE\":\"default\",\"GEN_SPF_OFF\":false,\"GEN_REM_APUN\":false,\"GEN_YT_LOGO_LINK\":false,\"GEN_DSBL_ADS\":false,\"GEN_LOCL_LANG\":false,\"lightsOut\":true,\"fullBrs\":true}"},"ts":1480574353803},"enabled":true,"position":4,"file_url":"https://greasyfork.org/scripts/9932-youtube/code/YouTube%20+.user.js","uuid":"44276438-6a2d-40cf-a78d-7b12d9f15d96","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQHZlcnNpb24gICAgICAgICAxLjcuMgovLyBAbmFtZSAgICAgICAgICAgIFlvdVR1YmUgKwovLyBAbmFtZXNwYWNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUKLy8gQGRlc2NyaXB0aW9uICAgICBZb3VUdWJlIHdpdGggbW9yZSBmcmVlZG9tCi8vIEBpY29uICAgICAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS9naC1wYWdlcy9pbWFnZXMvWVQlMkJpY29uLnBuZwovLyBAbWF0Y2ggICAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vdHYqCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8qCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9saXZlX2NoYXQqCi8vIEBydW4tYXQgICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQGhvbWVwYWdlVVJMICAgICBodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlCi8vIEBzdXBwb3J0VVJMICAgICAgaHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpCi8vIEBjb250cmlidXRpb25VUkwgaHR0cHM6Ly93d3cucGF5cGFsLmNvbS9jZ2ktYmluL3dlYnNjcj9jbWQ9X3MteGNsaWNrJmhvc3RlZF9idXR0b25faWQ9VU1WUUpKRkc0QkZIVwovLyBAZ3JhbnQgICAgICAgICAgIEdNX2dldFZhbHVlCi8vIEBncmFudCAgICAgICAgICAgR01fc2V0VmFsdWUKLy8gQG5vZnJhbWVzCi8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24gKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHBhcnRpY2xlID0gewogICAgICAgIGluamVjdDogZnVuY3Rpb24oaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICBmdW5jdGlvbiBzZXRMb2NhbGUoY29udGVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGxpc3QsIHRlbXAsIHl0cGxhYmVsOwogICAgICAgICAgICAgICAgeXRwbGFiZWwgPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLXBdIik7CiAgICAgICAgICAgICAgICBpID0geXRwbGFiZWwubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGxpc3QgPSB5dHBsYWJlbFtpXS5kYXRhc2V0LnAuc3BsaXQoIiYiKTsKICAgICAgICAgICAgICAgICAgICBqID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gbGlzdFtqXS5zcGxpdCgifCIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFswXSA9PT0gInRuZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0cGxhYmVsW2ldLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxhbmcodGVtcFsxXSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wWzBdID09PSAidHRsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwbGFiZWxbaV0uc2V0QXR0cmlidXRlKCJ0aXRsZSIsIGxhbmcodGVtcFsxXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwbGFiZWxbaV0uZGF0YXNldC50b29sdGlwVGV4dCA9IGxhbmcodGVtcFsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY29udGVudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRMb2NhbGUoZGF0YSkgewogICAgICAgICAgICAgICAgbGFuZy5mZXRjaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgZGF0YSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZTsKICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhICYmIEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gPSBKU09OLnBhcnNlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXS5sYXN0TW9kID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgNjA0OEU1OwogICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHVzZXJfc2V0dGluZ3MuZXh0TGFuZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsYW5nLm9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRMYW5ndWFnZShkYXRhKSB7CiAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS50YXJnZXQucmVhZHlTdGF0ZSA9PT0gNCAmJiBkYXRhLnRhcmdldC5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gPSBKU09OLnBhcnNlKGRhdGEudGFyZ2V0LnJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddLmxhc3RNb2QgPSBuZXcgRGF0ZShkYXRhLnRhcmdldC5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyA2MDQ4RTU7CiAgICAgICAgICAgICAgICBzZXQoImV4dExhbmciLCB1c2VyX3NldHRpbmdzLmV4dExhbmcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrTW9kaWZpZWQoZGF0YSkgewogICAgICAgICAgICAgICAgbGFuZy5mZXRjaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGRhdGEudGFyZ2V0LnJlYWR5U3RhdGUgPT09IDQgJiYgZGF0YS50YXJnZXQuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgZ2V0TGFuZ3VhZ2UsIGxhbmcudXJsQmFzZSArIGxhbmcueXRsYW5nICsgIi5qc29uIiwgWyJBY2NlcHQiLCAiYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5yYXciXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbGFuZyhsYWJlbCkgewogICAgICAgICAgICAgICAgbGFuZy55dGxhbmcgPSB3aW5kb3cueXQgJiYgd2luZG93Lnl0LmNvbmZpZ18gJiYgd2luZG93Lnl0LmNvbmZpZ18uR0FQSV9MT0NBTEU7CiAgICAgICAgICAgICAgICBsYW5nLnVybEJhc2UgPSAiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9QYXJ0aWNsZUNvcmUvUGFydGljbGUvY29udGVudHMvTG9jYWxlLyI7CiAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuZXh0TGFuZykgewogICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHt9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmdbbGFiZWxdKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHVzZXJfc2V0dGluZ3MuZXh0TGFuZykgIT09ICJ7fSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJleHRMYW5nIiwge30pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcl9zZXR0aW5ncy5sb2NhbExhbmdbbGFiZWxdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgbGFuZy55dGxhbmcgJiYgbGFuZy55dGxhbmcgIT09ICJlbl9VUyIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXSAmJiB1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddW2xhYmVsXSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxhbmcuZmV0Y2hpbmcgJiYgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayAmJiB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrIDw9IG5ldyBEYXRlKCkuZ2V0VGltZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihnZXRMb2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtc2V0bG9jYWxlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC5nZXRsb2NhbGUgPSBsYW5nLnl0bGFuZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxYSFIoIkhFQUQiLCBjaGVja01vZGlmaWVkLCBsYW5nLnVybEJhc2UgKyBsYW5nLnl0bGFuZyArICIuanNvbiIsIFsiSWYtTW9kaWZpZWQtU2luY2UiLCBuZXcgRGF0ZSh1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddLmxhc3RNb2QpLnRvVVRDU3RyaW5nKCldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDYwNDhFNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHVzZXJfc2V0dGluZ3MuZXh0TGFuZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ11bbGFiZWxdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gJiYgIWxhbmcuZmV0Y2hpbmcgJiYgKCF1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrIHx8IHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPD0gbmV3IERhdGUoKS5nZXRUaW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcuZmV0Y2hpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihnZXRMb2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5vYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtc2V0bG9jYWxlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQuZ2V0bG9jYWxlID0gbGFuZy55dGxhbmc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgZ2V0TGFuZ3VhZ2UsIGxhbmcudXJsQmFzZSArIGxhbmcueXRsYW5nICsgIi5qc29uIiwgWyJBY2NlcHQiLCAiYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5yYXciXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VbbGFiZWxdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNvcnRMaXN0KHByZXZpb3VzLCBuZXh0KXsKICAgICAgICAgICAgICAgIHJldHVybiBuZXh0W09iamVjdC5rZXlzKG5leHQpWzBdXS5sb2NhbGVDb21wYXJlKHByZXZpb3VzW09iamVjdC5rZXlzKHByZXZpb3VzKVswXV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEJsYWNrbGlzdChibGlzdCkgewogICAgICAgICAgICAgICAgdmFyIGksIG9iaiwgdGVtcCwgbG5rLCBrZXlzLCBsaXN0LCBmcmFnbWVudCwgc29ydEFscGhhOwogICAgICAgICAgICAgICAgc29ydEFscGhhID0gW107CiAgICAgICAgICAgICAgICBsaXN0ID0gdXNlcl9zZXR0aW5ncy5ibGFja2xpc3Q7CiAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICAgICAgICAgIHNvcnRBbHBoYSA9IFtdOwogICAgICAgICAgICAgICAgdGVtcCA9IE9iamVjdC5rZXlzKGxpc3QpOwogICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICAgICAgICAgIG9ialt0ZW1wW2ldXSA9IGxpc3RbdGVtcFtpXV07CiAgICAgICAgICAgICAgICAgICAgc29ydEFscGhhLnB1c2gob2JqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXAgPSBzb3J0QWxwaGEuc29ydChzb3J0TGlzdCk7CiAgICAgICAgICAgICAgICBpID0gdGVtcC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAga2V5cyA9IE9iamVjdC5rZXlzKHRlbXBbaV0pOwogICAgICAgICAgICAgICAgICAgIG9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgb2JqLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGNsYXNzPSdibGFja2xpc3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nY2xvc2UnIGRhdGEtcD0ndHRsfEdMQl9STUJMJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHZpZXdCb3g9JzAgMCAxMCAxMCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nMTAsMS40IDguNiwwIDUsMy42IDEuNCwwIDAsMS40IDMuNiw1IDAsOC42IDEuNCwxMCA1LDYuNCA4LjYsMTAgMTAsOC42IDYuNCw1Jy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj48YSB0YXJnZXQ9J19ibGFuayc+PC9hPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIG9iaiA9IHNldExvY2FsZShvYmouY29udGVudC5maXJzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICBsbmsgPSBvYmoucXVlcnlTZWxlY3RvcigiYSIpOwogICAgICAgICAgICAgICAgICAgIGxuay5ocmVmID0gIi9jaGFubmVsLyIgKyBrZXlzWzBdOwogICAgICAgICAgICAgICAgICAgIGxuay5zZXRBdHRyaWJ1dGUoInRpdGxlIiwgdGVtcFtpXVtrZXlzWzBdXSk7CiAgICAgICAgICAgICAgICAgICAgbG5rLnRleHRDb250ZW50ID0gdGVtcFtpXVtrZXlzWzBdXTsKICAgICAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChvYmopOwogICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJcbiIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJsaXN0LmFwcGVuZENoaWxkKGZyYWdtZW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRWYWx1ZXMobWVudSkgewogICAgICAgICAgICAgICAgdmFyIGksIHl0cCwgbGlzdDsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IG1lbnUucXVlcnlTZWxlY3RvcigiI2JsYWNrbGlzdCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdldEJsYWNrbGlzdChsaXN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgeXRwID0gbWVudS5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dFtpZF0iKTsKICAgICAgICAgICAgICAgICAgICBpID0geXRwLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5dHBbaV0udHlwZSA9PT0gImNoZWNrYm94IiAmJiB1c2VyX3NldHRpbmdzW3l0cFtpXS5pZF0gPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0cFtpXS5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5dHBbaV0udHlwZSA9PT0gInRleHQiICYmIHR5cGVvZiB1c2VyX3NldHRpbmdzW3l0cFtpXS5pZF0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBbaV0uc2V0QXR0cmlidXRlKCJ2YWx1ZSIsIHVzZXJfc2V0dGluZ3NbeXRwW2ldLmlkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgeXRwID0gbWVudS5xdWVyeVNlbGVjdG9yQWxsKCJvcHRpb24iKTsKICAgICAgICAgICAgICAgICAgICBpID0geXRwLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzW3l0cFtpXS5wYXJlbnROb2RlLmlkXSA9PT0geXRwW2ldLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBbaV0uc2V0QXR0cmlidXRlKCJzZWxlY3RlZCIsICJ0cnVlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbWVudTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRNZW51KHNlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHZhciBpLCB0ZW1wLCBzdmcsIGlucHV0czsKICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgaWYgKHNlY3Rpb24gPT09ICJNRU4iKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1zZXR0aW5ncyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdQLWNvbnRhaW5lcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nUC1zaWRlYmFyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGlkPSdQLXNpZGViYXItbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0dFTicgY2xhc3M9J3NlbGVjdGVkJyBkYXRhLXA9J3RuZHxHRU4nPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J1ZJRCcgZGF0YS1wPSd0bmR8VklEJz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdCTEsnIGRhdGEtcD0ndG5kfEJMSyc+PC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0nQUJUJyBkYXRhLXA9J3RuZHxBQlQnPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0hMUCc+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraScgZGF0YS1wPSd0bmR8SExQJz48L2E+PC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0nRE5UJz48YSB0aXRsZT0nUGF5UGFsJyB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cHM6Ly93d3cucGF5cGFsLmNvbS9jZ2ktYmluL3dlYnNjcj9jbWQ9X3MteGNsaWNrJmhvc3RlZF9idXR0b25faWQ9VU1WUUpKRkc0QkZIVycgZGF0YS1wPSd0bmR8RE5UJz48L2E+PHN2ZyB2aWV3Qm94PScwIDAgMTUuMyAxOCc+PHBhdGggc3R5bGU9J2ZpbGw6IzI3MzQ2QTsnIGQ9J00xMywxLjRDMTIuMiwwLjQsMTAuNiwwLDguNywwSDMuMUMyLjcsMCwyLjQsMC4zLDIuMywwLjdMMCwxNS40QzAsMTUuNywwLjIsMTYsMC41LDE2aDMuNSBsMC45LTUuNWwwLDAuMkM0LjgsMTAuMyw1LjIsMTAsNS42LDEwaDEuNmMzLjIsMCw1LjctMS4zLDYuNS01LjFjMC0wLjEsMC0wLjIsMC4xLTAuM2MtMC4xLDAtMC4xLDAsMCwwQzE0LDMuMiwxMy43LDIuMiwxMywxLjQnLz48cGF0aCBzdHlsZT0nZmlsbDojMjczNDZBOycgZD0nTTYuMSw0LjFDNi4yLDQsNi4zLDQsNi40LDRoNC40YzAuNSwwLDEsMCwxLjQsMC4xYzAuMSwwLDAuMiwwLDAuNCwwLjFjMC4xLDAsMC4yLDAuMSwwLjMsMC4xIGMwLjEsMCwwLjEsMCwwLjIsMC4xYzAuMiwwLjEsMC40LDAuMiwwLjYsMC4zYzAuMi0xLjQsMC0yLjQtMC44LTMuMkMxMi4yLDAuNCwxMC42LDAsOC43LDBIMy4xQzIuNywwLDIuNCwwLjMsMi4zLDAuN0wwLDE1LjQgQzAsMTUuNywwLjIsMTYsMC41LDE2aDMuNUw1LjcsNC42QzUuOCw0LjQsNS45LDQuMiw2LjEsNC4xeicvPjxwYXRoIHN0eWxlPSdmaWxsOiMyNzkwQzM7JyBkPSdNMTMuNyw0LjlDMTMsOC43LDEwLjQsMTAsNy4yLDEwSDUuNmMtMC40LDAtMC43LDAuMy0wLjgsMC43bC0xLjEsNi44YzAsMC4zLDAuMiwwLjUsMC40LDAuNUg3IGMwLjMsMCwwLjYtMC4zLDAuNy0wLjZsMC0wLjFsMC41LTMuNWwwLTAuMkM4LjQsMTMuMyw4LjcsMTMsOSwxM2gwLjRjMi44LDAsNS0xLjEsNS43LTQuNWMwLjMtMS40LDAuMS0yLjUtMC42LTMuNCBjLTAuMi0wLjItMC41LTAuNC0wLjgtMC42QzEzLjcsNC43LDEzLjcsNC44LDEzLjcsNC45TDEzLjcsNC45eicvPjxwYXRoIHN0eWxlPSdmaWxsOiMxRjI2NEY7JyBkPSdNMTMsNC4zYy0wLjEsMC0wLjItMC4xLTAuMy0wLjFjLTAuMSwwLTAuMiwwLTAuNC0wLjFDMTEuOCw0LDExLjMsNCwxMC44LDRINi40IEM2LjMsNCw2LjIsNCw2LjEsNC4xQzUuOSw0LjIsNS44LDQuNCw1LjcsNC42bC0wLjksNS45bDAsMC4yQzQuOCwxMC4zLDUuMiwxMCw1LjYsMTBoMS42YzMuMiwwLDUuNy0xLjMsNi41LTUuMSBjMC0wLjEsMC0wLjIsMC4xLTAuM2MtMC4yLTAuMS0wLjQtMC4yLTAuNi0wLjNDMTMuMSw0LjMsMTMsNC4zLDEzLDQuMycvPjwvc3ZnPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgc3R5bGU9J2Rpc3BsYXk6bm9uZTsnPjxzeW1ib2wgaWQ9J3l0cC1zdmctY2hlY2ttYXJrJyB2aWV3Qm94PScwIDAgMTIuNyA5LjknPjxwb2x5Z29uIHBvaW50cz0nMS40LDQuMiAwLDUuNyA0LjIsOS45IDEyLjcsMS40IDExLjMsMCA0LjIsNy4xJy8+PC9zeW1ib2w+PHN5bWJvbCBpZD0neXRwLXN2Zy1zYXZlJyB2aWV3Qm94PScwIDAgMTYgMTYnPjxwYXRoIGQ9J00xMywwSDB2MTZoMTZWM0wxMywweiBNMywxaDl2NkgzVjF6IE0xNCwxNUgyVjloMTJWMTV6Jy8+PHJlY3QgeD0nMTAnIHk9JzInIHdpZHRoPScxJyBoZWlnaHQ9JzQnLz48L3N5bWJvbD48L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbiA9PT0gIkdFTiIpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdQLWNvbnRlbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1oZWFkZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1Atc2F2ZScgICAgZGF0YS1wPSd0bmR8R0xCX1NWRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1yZXNldCcgICBkYXRhLXA9J3RuZHxHTEJfUlNFVCc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBleHAnICBkYXRhLXA9J3R0bHxHTEJfSU1QUic+PHN2ZyBjbGFzcz0nc2F2ZSc+PHVzZSB4bGluazpocmVmPScjeXRwLXN2Zy1zYXZlJy8+PC9zdmc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBsYW5nJyBkYXRhLXA9J3R0bHxHTEJfTE9DTF9MQU5HJnRuZHxMT0NBTEUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBkYXRhLXA9J3RuZHxHRU5fVFRMJz48L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgY2xhc3M9J1AtaG9yeic+PC9ocj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxHRU5fR0VOJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9MT0NMX0xBTkcnICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fTE9DTF9MQU5HJyAgICBkYXRhLXA9J3RuZHxHRU5fTE9DTF9MQU5HJz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2N1c3RvbV9sYW5nJyAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0RTQkxfQURTJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9EU0JMX0FEUycgICAgIGRhdGEtcD0ndG5kfEdFTl9EU0JMX0FEUyc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjb3V0c2lkZV9hZHMnICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fWVRfTE9HT19MSU5LJyB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX1lUX0xPR09fTElOSycgZGF0YS1wPSd0bmR8R0VOX1lUX0xPR09fTElOSyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNsb2dvX3JlZGlyZWN0JyAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9TVUJfTElTVCcgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fU1VCX0xJU1QnICAgICBkYXRhLXA9J3RuZHxHRU5fU1VCX0xJU1QnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3N1Yl9wbGF5bGlzdCcgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0lORl9TQ1JMJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9JTkZfU0NSTCcgICAgIGRhdGEtcD0ndG5kfEdFTl9JTkZfU0NSTCc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaW5maW5pdGVfc2Nyb2xsJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fUFBPVF9PTicgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX1BQT1RfT04nICAgICAgZGF0YS1wPSd0bmR8R0VOX1BQT1RfT04nPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNwb3BvdXRfb24nICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9SRU1fQVBVTicgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fUkVNX0FQVU4nICAgICBkYXRhLXA9J3RuZHxHRU5fUkVNX0FQVU4nPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3JlbW92ZV9hdXRvcGxheScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX1NQRl9PRkYnICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9TUEZfT0ZGJyAgICAgIGRhdGEtcD0ndG5kfEdFTl9TUEZfT0ZGJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc3BmX29mZicgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0nR0VOX0NITl9ERkxUX1BBR0UnIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFJz48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1Atc2VsZWN0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0nR0VOX0NITl9ERkxUX1BBR0UnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nZGVmYXVsdCcgICAgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfREZMVCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSd2aWRlb3MnICAgICBkYXRhLXA9J3RuZHxHRU5fQ0hOX0RGTFRfUEFHRV9WSUQnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ncGxheWxpc3RzJyAgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfUEwnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nY2hhbm5lbHMnICAgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfQ0hOJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2Rpc2N1c3Npb24nIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX0RJU0MnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nYWJvdXQnICAgICAgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfQUJUJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjY2hhbm5lbF9wYWdlJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfEdFTl9MWVQnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0dSSURfU1VCUycgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fR1JJRF9TVUJTJyAgICAgZGF0YS1wPSd0bmR8R0VOX0dSSURfU1VCUyc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc3ViX2dyaWQnICAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9HUklEX1NSQ0gnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0dSSURfU1JDSCcgICAgIGRhdGEtcD0ndG5kfEdFTl9HUklEX1NSQ0gnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3NlYXJjaF9ncmlkJyAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fQlRUUl9OVEYnICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9CVFRSX05URicgICAgICBkYXRhLXA9J3RuZHxHRU5fQlRUUl9OVEYnPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNibHVlX2JveCcgICAgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0RTQl9IVlJDJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fRFNCX0hWUkMnICAgICAgZGF0YS1wPSd0bmR8R0VOX0RTQl9IVlJDJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaG92ZXJjYXJkc19vZmYnICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9DTVBUX1RUTFMnICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0NNUFRfVFRMUycgICAgIGRhdGEtcD0ndG5kfEdFTl9DTVBUX1RUTFMnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2ZlZWRfdGl0bGVzJyAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fQkxVRV9HTE9XJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9CTFVFX0dMT1cnICAgICBkYXRhLXA9J3RuZHxHRU5fQkxVRV9HTE9XJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNibHVlX2dsb3cnICAgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0hJREVfRlRSJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fSElERV9GVFInICAgICAgZGF0YS1wPSd0bmR8R0VOX0hJREVfRlRSJz4gICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV9mb290ZXInICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9IREVfUkVDTV9TREJSJyB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nR0VOX0hERV9SRUNNX1NEQlInIGRhdGEtcD0ndG5kfEdFTl9IREVfUkVDTV9TREJSJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfcmVjb21fc2lkZWJhcicgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fSERFX1NSQ0hfU0RCUicgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J0dFTl9IREVfU1JDSF9TREJSJyBkYXRhLXA9J3RuZHxHRU5fSERFX1NSQ0hfU0RCUic+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNoaWRlX3NlYXJjaF9zaWRlYmFyJyAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0hERV9DSE5fU0RCUicgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdHRU5fSERFX0NITl9TREJSJyAgZGF0YS1wPSd0bmR8R0VOX0hERV9DSE5fU0RCUic+IDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV9jaGFubmVsX3NpZGViYXInIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoIi5QLWltcGxhbmciKS5kYXRhc2V0LnAgPSAiR0xCX0xPQ0xfTEFOR19DU1RNIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICJWSUQiKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1jb250ZW50Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1AtaGVhZGVyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXNhdmUnICAgIGRhdGEtcD0ndG5kfEdMQl9TVkUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtcmVzZXQnICAgZGF0YS1wPSd0bmR8R0xCX1JTRVQnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtaW1wZXhwJyAgZGF0YS1wPSd0dGx8R0xCX0lNUFInPjxzdmcgY2xhc3M9J3NhdmUnPjx1c2UgeGxpbms6aHJlZj0nI3l0cC1zdmctc2F2ZScvPjwvc3ZnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtaW1wbGFuZycgZGF0YS1wPSd0dGx8R0xCX0xPQ0xfTEFORyZ0bmR8TE9DQUxFJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgZGF0YS1wPSd0bmR8VklEX1RUTCc+PC9oMj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGhyIGNsYXNzPSdQLWhvcnonPjwvaHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8VklEX1BMUic+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0FEUycgICAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0FEUycgICAgICBkYXRhLXA9J3RuZHxWSURfUExSX0FEUyc+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3ZpZGVvX2FkcycgICAgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1NVQl9BRFMnICAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1NVQl9BRFMnICAgICAgZGF0YS1wPSd0bmR8VklEX1NVQl9BRFMnPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzdWJzX2Fkc19vbicgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfQUxWSVMnICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfQUxWSVMnICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfQUxWSVMnPiAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjZmxvYXRpbmdfcGxheWVyJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0FMVklTX1dEVEgnIHR5cGU9J3RleHQnIHBsYWNlaG9sZGVyPSczNTAnIHNpemU9JzYnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfQUxWSVNfV0RUSCcgZGF0YS1wPSd0bmR8VklEX1BMUl9BTFZJU19XRFRIJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Zsb2F0aW5nX3BsYXllcl93aWR0aCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BVFBMJyAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9BVFBMJyAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9BVFBMJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN2aWRlb19hdXRvcGxheScgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfQ0MnICAgICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfQ0MnICAgICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfQ0MnPiAgICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjc3VidGl0bGVzX29mZicgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0FOVFMnICAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0FOVFMnICAgICBkYXRhLXA9J3RuZHxWSURfUExSX0FOVFMnPiAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Fubm90YXRpb25zX29mZicgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX0VORF9TSFJFJyAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX0VORF9TSFJFJyAgICAgZGF0YS1wPSd0bmR8VklEX0VORF9TSFJFJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzaGFyZV9wYW5lbF9vZmYnICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfVk9MX01FTScgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfVk9MX01FTScgIGRhdGEtcD0ndG5kfFZJRF9QTFJfVk9MX01FTSc+IDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcmVtZW1iZXJfdm9sdW1lJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX1ZPTF9MRE4nICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX1ZPTF9MRE4nICBkYXRhLXA9J3RuZHxWSURfUExSX1ZPTF9MRE4nPiA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Rpc2FibGVfbm9ybWFsaXNhdGlvbicgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BTEFDVCcgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9BTEFDVCcgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9BTEFDVCc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzaG9ydGN1dHNfb24nICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfU0laRV9NRU0nICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfU0laRV9NRU0nIGRhdGEtcD0ndG5kfFZJRF9QTFJfU0laRV9NRU0nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcmVtZW1iZXJfbW9kZScgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfVk9MX1dIRUVMJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfVk9MX1dIRUVMJyAgICBkYXRhLXA9J3RuZHxWSURfVk9MX1dIRUVMJz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3doZWVsX3ZvbHVtZScgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9IRlInICAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9IRlInICAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9IRlInPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNoZnJfb2ZmJyAgICAgICAgICAgICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfSFRNTDUnICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfSFRNTDUnICAgIGRhdGEtcD0ndG5kfFZJRF9QTFJfSFRNTDUnPiAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjZm9yY2VfaHRtbDUnICAgICAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0nVklEX0RGTFRfUUxUWScgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWSc+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSdQLXNlbGVjdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9J1ZJRF9ERkxUX1FMVFknPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nYXV0bycgICAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV9BVVRPJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2hpZ2hyZXMnIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfT1JJRyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdoZDI4ODAnICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzI4ODAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQyMTYwJyAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV8yMTYwJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2hkMTQ0MCcgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfMTQ0MCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdoZDEwODAnICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzEwODAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQ3MjAnICAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV83MjAnID48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2xhcmdlJyAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfTFJHJyA+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdtZWRpdW0nICBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX01ETScgPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nc21hbGwnICAgZGF0YS1wPSd0bmR8VklEX0RGTFRfUUxUWV9TTUwnID48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J3RpbnknICAgIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfVE5ZJyA+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2RlZmF1bHRfcXVhbGl0eScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxWSURfUExSX0xZVCc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0lORk8nICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMUl9JTkZPJyAgICAgZGF0YS1wPSd0bmR8VklEX1BMUl9JTkZPJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNpbmZvX2JhcicgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9EWU5fU0laRScgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QTFJfRFlOX1NJWkUnIGRhdGEtcD0ndG5kfFZJRF9QTFJfRFlOX1NJWkUnPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjZHluYW1pY19zaXplX29mZicgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfRklUJyAgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExSX0ZJVCcgICAgICBkYXRhLXA9J3RuZHxWSURfUExSX0ZJVCc+ICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2ZpdF90b19wYWdlJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0ZJVF9XRFRIJyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nMTI4MHB4JyBzaXplPSc2Jz48bGFiZWwgZm9yPSdWSURfUExSX0ZJVF9XRFRIJyBkYXRhLXA9J3RuZHxWSURfUExSX0ZJVF9XRFRIJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2ZpdF9tYXhfd2lkdGgnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfFZJRF9QTFNUJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFNUX0FUUEwnICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfUExTVF9BVFBMJyAgICBkYXRhLXA9J3RuZHxWSURfUExTVF9BVFBMJz4gICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3BsYXlsaXN0X2F1dG9wbGF5JyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExTVF9SVlJTJyAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1BMU1RfUlZSUycgICAgZGF0YS1wPSd0bmR8VklEX1BMU1RfUlZSUyc+ICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNwbGF5bGlzdF9yZXZlcnNlJyAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8VklEX0xBWVQnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BQT1RfU1onIHR5cGU9J3RleHQnIHBsYWNlaG9sZGVyPSc1MzMnIHNpemU9JzYnPjxsYWJlbCBmb3I9J1ZJRF9QUE9UX1NaJyBkYXRhLXA9J3RuZHxWSURfUFBPVF9TWic+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNwb3BvdXRfc2l6ZScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9J1ZJRF9ISURFX0NPTVMnIGRhdGEtcD0ndG5kfFZJRF9ISURFX0NPTVMnPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1zZWxlY3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSdWSURfSElERV9DT01TJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzAnIGRhdGEtcD0ndG5kfFZJRF9ISURFX0NPTVNfU0hPVyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPScxJyBkYXRhLXA9J3RuZHxWSURfSElERV9DT01TX0hJREUnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nMicgZGF0YS1wPSd0bmR8VklEX0hJREVfQ09NU19SRU0nPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNjb21tZW50cycgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfVFRMX0NNUFQnICAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9UVExfQ01QVCcgICAgICBkYXRhLXA9J3RuZHxWSURfVFRMX0NNUFQnPiAgICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN2aWRlb190aXRsZScgICAgICAgICAgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX0RFU0NfU0hSVCcgICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfREVTQ19TSFJUJyAgICAgZGF0YS1wPSd0bmR8VklEX0RFU0NfU0hSVCc+ICAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjbGFiZWxsZXNzX2J1dHRvbnMnICAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9WSURfQ05UJyAgICAgICB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX1ZJRF9DTlQnICAgICAgIGRhdGEtcD0ndG5kfFZJRF9WSURfQ05UJz4gICAgICA8L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3VwbG9hZF9jb3VudGVyJyAgICAgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUE9TVF9USU1FJyAgICAgdHlwZT0nY2hlY2tib3gnPjxsYWJlbCBmb3I9J1ZJRF9QT1NUX1RJTUUnICAgICBkYXRhLXA9J3RuZHxWSURfUE9TVF9USU1FJz4gICAgPC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNyZWxhdGl2ZV91cGxvYWRfdGltZScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX0hJREVfREVUTFMnICAgIHR5cGU9J2NoZWNrYm94Jz48bGFiZWwgZm9yPSdWSURfSElERV9ERVRMUycgICAgZGF0YS1wPSd0bmR8VklEX0hJREVfREVUTFMnPiAgIDwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV92aWRlb19kZXRhaWxzJyAgIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9MQVlUX0FVVE9fUE5MJyB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nVklEX0xBWVRfQVVUT19QTkwnIGRhdGEtcD0ndG5kfFZJRF9MQVlUX0FVVE9fUE5MJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2V4cGFuZF9kZXNjcmlwdGlvbicgICBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fTE9DTF9MQU5HICYmIHVzZXJfc2V0dGluZ3MubG9jYWxMYW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAuY29udGVudC5xdWVyeVNlbGVjdG9yKCIuUC1pbXBsYW5nIikuZGF0YXNldC5wID0gIkdMQl9MT0NMX0xBTkdfQ1NUTSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWN0aW9uID09PSAiQkxLIikgewogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1AtY29udGVudCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSdQLWhlYWRlcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1zYXZlJyAgICBkYXRhLXA9J3RuZHxHTEJfU1ZFJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXJlc2V0JyAgIGRhdGEtcD0ndG5kfEdMQl9SU0VUJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGV4cCcgIGRhdGEtcD0ndHRsfEdMQl9JTVBSJz48c3ZnIGNsYXNzPSdzYXZlJz48dXNlIHhsaW5rOmhyZWY9JyN5dHAtc3ZnLXNhdmUnLz48L3N2Zz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGxhbmcnIGRhdGEtcD0ndHRsfEdMQl9MT0NMX0xBTkcmdG5kfExPQ0FMRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGRhdGEtcD0ndG5kfEJMS19UVEwnPjwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxociBjbGFzcz0nUC1ob3J6Jz48L2hyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfEJMS19CTEsnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nQkxLX09OJyB0eXBlPSdjaGVja2JveCc+PGxhYmVsIGZvcj0nQkxLX09OJyBkYXRhLXA9J3RuZHxCTEtfT04nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmxhY2tsaXN0X29uJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2JsYWNrbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nYmxhY2tsaXN0LWNvbnRyb2xzJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LWVkaXQnICBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX0VESVQnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LXNhdmUnICBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX1NBVkUnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LWNsb3NlJyBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz48c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxCTENLX0NMU0UnPjwvc3Bhbj48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9J2JsYWNrbGlzdC1lZGl0LWxpc3QnPjwvdGV4dGFyZWE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxicj48L2JyPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoIi5QLWltcGxhbmciKS5kYXRhc2V0LnAgPSAidHRsfEdMQl9MT0NMX0xBTkcmdG5kfEdMQl9MT0NMX0xBTkdfQ1NUTSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWN0aW9uID09PSAiQUJUIikgewogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1AtY29udGVudCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSdQLWhlYWRlcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGRhdGEtcD0ndG5kfEFCVF9UVEwnPjwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxociBjbGFzcz0nUC1ob3J6Jz48L2hyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfEFCVF9USEtTJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1llUHBIYSc+SmVwcGUgUnVuZSBNb3J0ZW5zZW48L2E+PHNwYW4gZGF0YS1wPSd0bmR8QUJUX1RIS1NfWUVQUEhBJz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwOi8vd3d3LmdyZWFzZXNwb3QubmV0Lyc+R3JlYXNlbW9ua2V5PC9hPiArIDxhIGhyZWY9J2h0dHA6Ly90YW1wZXJtb25rZXkubmV0Lyc+VGFtcGVybW9ua2V5PC9hPjxzcGFuIGRhdGEtcD0ndG5kfEFCVF9USEtTX1VTRVJTQ1JJUFQnPjwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS8nPlN0YWNrIE92ZXJmbG93PC9hPjxzcGFuIGRhdGEtcD0ndG5kfEFCVF9USEtTX1NUQUNLT1YnPjwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxBQlRfSU5GTyc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvJz5HaXRIdWI8L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2dyZWFzeWZvcmsub3JnL2VuL3VzZXJzLzgyMjMtcGFydGljbGVjb3JlJz5HcmVhc3kgRm9yazwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHA6Ly9vcGVudXNlcmpzLm9yZy9zY3JpcHRzL1BhcnRpY2xlQ29yZS8nPk9wZW5Vc2VySlM8L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbnB1dHMgPSB0ZW1wLmNvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgiaW5wdXRbdHlwZT0nY2hlY2tib3gnXSArIGxhYmVsIik7CiAgICAgICAgICAgICAgICBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgInN2ZyIpOwogICAgICAgICAgICAgICAgc3ZnLmlubmVySFRNTCA9ICI8dXNlIHhsaW5rOmhyZWY9JyN5dHAtc3ZnLWNoZWNrbWFyayc+IjsKICAgICAgICAgICAgICAgIGkgPSBpbnB1dHMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0c1tpXS5hcHBlbmRDaGlsZChzdmcuY2xvbmVOb2RlKHRydWUpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBzZXRMb2NhbGUoZ2V0VmFsdWVzKHRlbXAuY29udGVudCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGV4cG9ydFNldHRpbmdzKHRhcmdldCkgewogICAgICAgICAgICAgICAgdmFyIGV4cENvbnQ7CiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1pbXBleHAiKSB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGxhbmciKSkgewogICAgICAgICAgICAgICAgICAgIGV4cENvbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZXhwLWNvbnQiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZXhwQ29udCkgewogICAgICAgICAgICAgICAgICAgICAgICBleHBDb250Lm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGV4cENvbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGV4cENvbnQuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J2V4cC1jb250Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0naW1wbGFuZy1zYXZlJyBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1kZWZhdWx0IHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0neXQtdWl4LWJ1dHRvbi1jb250ZW50JyBkYXRhLXA9J3RuZHxHTEJfSU1QUl9TQVZFJz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSdpbXBleHAtbGlzdCc+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1pbXBleHAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBleHBDb250LmNvbnRlbnQucXVlcnlTZWxlY3RvcigiI2ltcGxhbmctc2F2ZSIpLmlkID0gImltcGV4cC1zYXZlIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udCA9IHNldExvY2FsZShleHBDb250LmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtY29udGVudCIpLmFwcGVuZENoaWxkKGV4cENvbnQpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbXBleHAtbGlzdCIpLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkoKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wZXhwIikgJiYgdXNlcl9zZXR0aW5ncykgfHwgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcgfHwgbGFuZ3VhZ2UsIHVuZGVmaW5lZCwgMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gImltcGV4cC1zYXZlIiB8fCB0YXJnZXQuaWQgPT09ICJpbXBsYW5nLXNhdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5pZCA9PT0gImltcGxhbmctc2F2ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJsb2NhbExhbmciLCBKU09OLnBhcnNlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbXBleHAtbGlzdCIpLnZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzZXQoInVzZXJfc2V0dGluZ3MiLCBKU09OLnBhcnNlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbXBleHAtbGlzdCIpLnZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbi5jbGljaygpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUuc2V0dGluZ3NCdXR0b24uY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0QmxhY2tMaXN0KHRhcmdldCkgewogICAgICAgICAgICAgICAgaWYgKHRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1lZGl0IikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJibGFja2xpc3QiKS5jbGFzc0xpc3QuYWRkKCJlZGl0Iik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJsYWNrbGlzdC1lZGl0LWxpc3QiKS52YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0LCB1bmRlZmluZWQsIDIpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuaWQgPT09ICJibGFja2xpc3Qtc2F2ZSIpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoImJsYWNrbGlzdCIsIEpTT04ucGFyc2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJsYWNrbGlzdC1lZGl0LWxpc3QiKS52YWx1ZSkpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuaWQgPT09ICJibGFja2xpc3QtY2xvc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkJMSyIpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZGVsQmxhY2tMaXN0KGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgbmV3S2V5ID0gdXNlcl9zZXR0aW5ncy5ibGFja2xpc3Q7CiAgICAgICAgICAgICAgICBkZWxldGUgbmV3S2V5W2V2ZW50LnRhcmdldC5uZXh0U2libGluZy5ocmVmLnNwbGl0KCIvY2hhbm5lbC8iKVsxXV07CiAgICAgICAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgIHNldCgiYmxhY2tsaXN0IiwgbmV3S2V5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkZWxOb3RpZmljYXRpb24oKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoInNob3ctZ3VpZGUtYnV0dG9uLW5vdGlmaWNhdGlvbiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNhdmVTZXR0aW5ncyhzYWx0KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgdmFsdWUsIG5vdGlmaWNhdGlvbiwgbmF2SWQsIHVzZXJTZXRzLCBzYXZlZFNldHM7CiAgICAgICAgICAgICAgICBuYXZJZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5zZWxlY3RlZCIpLmlkOwogICAgICAgICAgICAgICAgdXNlclNldHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1jb250ZW50IikucXVlcnlTZWxlY3RvckFsbCgiW2lkXj0nIiArIG5hdklkICsgIiddIik7CiAgICAgICAgICAgICAgICBzYXZlZFNldHMgPSB1c2VyX3NldHRpbmdzOwogICAgICAgICAgICAgICAgaSA9IHVzZXJTZXRzLmxlbmd0aDsKICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICh1c2VyU2V0c1tpXS5jaGVja2VkICYmICh1c2VyU2V0c1tpXS52YWx1ZSA9PT0gIm9uIiB8fCB1c2VyU2V0c1tpXS52YWx1ZSkpIHx8ICh1c2VyU2V0c1tpXS5sZW5ndGggJiYgdXNlclNldHNbaV0udmFsdWUpIHx8ICh1c2VyU2V0c1tpXS5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PT0gInRleHQiICYmIHVzZXJTZXRzW2ldLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWRTZXRzW3VzZXJTZXRzW2ldLm5hbWUgfHwgdXNlclNldHNbaV0uaWRdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdmFsdWUgJiYgdXNlclNldHNbaV0udHlwZSAhPT0gInJhZGlvIikgewogICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFNldHNbdXNlclNldHNbaV0uaWRdID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2V0KCJ1c2VyX3NldHRpbmdzIiwgc2F2ZWRTZXRzKTsKICAgICAgICAgICAgICAgIGN1c3RvbVN0eWxlcygpOwogICAgICAgICAgICAgICAgaWYgKCFzYWx0KSB7CiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFwcGJhci1tYWluLWd1aWRlLW5vdGlmaWNhdGlvbi1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uLmNoaWxkTm9kZXMubGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24ub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J2FwcGJhci1tYWluLWd1aWRlLW5vdGlmaWNhdGlvbi1jb250YWluZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J2FwcGJhci1ndWlkZS1ub3RpZmljYXRpb24nIHJvbGU9J2FsZXJ0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9J2FwcGJhci1ndWlkZS1ub3RpZmljYXRpb24tY29udGVudC13cmFwcGVyIHl0LXZhbGlnbic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi1pY29uIHl0LXNwcml0ZSc+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9J2FwcGJhci1ndWlkZS1ub3RpZmljYXRpb24tdGV4dC1jb250ZW50Jz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbiA9IHNldExvY2FsZShub3RpZmljYXRpb24uY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0LW1hc3RoZWFkLWxvZ28tY29udGFpbmVyIikuYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmFwcGJhci1ndWlkZS1ub3RpZmljYXRpb24tdGV4dC1jb250ZW50IikudGV4dENvbnRlbnQgPSBsYW5nKCJHTEJfU1ZFX1NFVFMiKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoInNob3ctZ3VpZGUtYnV0dG9uLW5vdGlmaWNhdGlvbiIpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGRlbE5vdGlmaWNhdGlvbiwgMjAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbmF2aWdhdGVTZXR0aW5ncyhldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtc2F2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtcmVzZXQiKSAmJiB3aW5kb3cuY29uZmlybShsYW5nKCJHTEJfUlNFVF9DT05GIikpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJ1c2VyX3NldHRpbmdzIiwgZGVmYXVsdF9zZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImNsb3NlIikpIHsKICAgICAgICAgICAgICAgICAgICBkZWxCbGFja0xpc3QoZXZlbnQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImltcGV4cC1zYXZlIiB8fCBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGxhbmciKSB8fCBldmVudC50YXJnZXQuaWQgPT09ICJpbXBsYW5nLXNhdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwb3J0U2V0dGluZ3MoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiYmxhY2tsaXN0LWVkaXQiIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1zYXZlIiB8fCBldmVudC50YXJnZXQuaWQgPT09ICJibGFja2xpc3QtY2xvc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0QmxhY2tMaXN0KGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gIlAtY29udGFpbmVyIiB8fCBldmVudC50YXJnZXQuaWQgPT09ICJQLXNldHRpbmdzIikgewogICAgICAgICAgICAgICAgICAgIGV2ZW50ID0gKGV2ZW50LnRhcmdldC5pZCA9PT0gIlAtc2V0dGluZ3MiKSA/IGV2ZW50LnRhcmdldCA6IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIGV2ZW50Lm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50Wyh3aW5kb3cuY2hyb21lICYmICJib2R5IikgfHwgImRvY3VtZW50RWxlbWVudCJdLnNjcm9sbFRvcCA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pZCAhPT0gIkROVCIgJiYgZXZlbnQudGFyZ2V0LnRhZ05hbWUgIT09ICJBIiAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZS5pZCA9PT0gIlAtc2lkZWJhci1saXN0IikgewogICAgICAgICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygibm8tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtY29udGVudCIpLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQLWNvbnRhaW5lciIpLmFwcGVuZENoaWxkKGdldE1lbnUoZXZlbnQudGFyZ2V0LmlkKSk7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigiLnNlbGVjdGVkIikucmVtb3ZlQXR0cmlidXRlKCJjbGFzcyIpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc05hbWUgPSAic2VsZWN0ZWQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldHRpbmdzVGVtcGxhdGUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBwV3JhcHBlcjsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJQIiAmJiBldmVudC50YXJnZXQudGFnTmFtZSAhPT0gIklOUFVUIikgewogICAgICAgICAgICAgICAgICAgIHBXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtc2V0dGluZ3MiKTsKICAgICAgICAgICAgICAgICAgICBpZiAocFdyYXBwZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImZsb2F0ZXIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKS5yZW1vdmVBdHRyaWJ1dGUoInN0eWxlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIgPSBnZXRNZW51KCJNRU4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIucXVlcnlTZWxlY3RvcigiI1AtY29udGFpbmVyIikuYXBwZW5kQ2hpbGQoZ2V0TWVudSgiR0VOIikpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYm9keS1jb250YWluZXIiKS5pbnNlcnRCZWZvcmUocFdyYXBwZXIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYWdlLWNvbnRhaW5lciIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBuYXZpZ2F0ZVNldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBmaXJzdFRpbWUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NOYW1lID09PSAicGFyX2Nsb3Nld2xjbSIpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoImZpcnN0VGltZSIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGZpcnN0VGltZSk7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LndlbGNvbWUuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXR0aW5nc01lbnUoKSB7CiAgICAgICAgICAgICAgICB2YXIgbm90aWZfYnV0dG9uLCBzZXR0aW5nc19idXR0b24sIHdlbGNvbWVfbWVzc2FnZTsKICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nc01lbnUuc2V0dGluZ3NCdXR0b24pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub3RpZl9idXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubm90aWZpY2F0aW9ucy1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzX2J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN5dC1tYXN0aGVhZC11c2VyLCAjeXQtbWFzdGhlYWQtc2lnbmluIik7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3NfYnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICB3ZWxjb21lX21lc3NhZ2UuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1BzZXR0aW5ncyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdQJyBkYXRhLXA9J3R0bHxZVFNFVFMnIHN0eWxlPSdoZWlnaHQ6MjhweDttYXJnaW4tcmlnaHQ6MTBweDtvcGFjaXR5Oi41NTt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7d2lkdGg6MThweDsnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgdmlld0JveD0nMCAwIDE4IDIwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScwLDIwIDE0LDEyIDAsNCcvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzE1LDMgMTUsMCAxMywwIDEzLDMgMTAsMyAxMCw1IDEzLDUgMTMsOCAxNSw4IDE1LDUgMTgsNSAxOCwzJy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J3BhcnRfd2VsY29tZScgc3R5bGU9J2Rpc3BsYXk6bm9uZTttYXJnaW4tbGVmdDotMjIwcHg7dG9wOjM4cHg7cmlnaHQ6MCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gZGF0YS1wPSd0bmR8V0xDTSc+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxicj48L2JyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtcD0ndG5kfFdMQ01TVFJUJz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyPjwvYnI+PGJyPjwvYnI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgZGF0YS1wPSd0bmR8V0xDTUZUUlMnIHN0eWxlPSdjb2xvcjojRkZGOycgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzJyB0YXJnZXQ9J19ibGFuayc+PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J3Bhcl9jbG9zZXdsY20nPjxzcGFuPsOXPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gc2V0TG9jYWxlKHdlbGNvbWVfbWVzc2FnZS5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHNldHRpbmdzVGVtcGxhdGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChub3RpZl9idXR0b24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfYnV0dG9uLmluc2VydEJlZm9yZSh3ZWxjb21lX21lc3NhZ2UsIG5vdGlmX2J1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NfYnV0dG9uLmFwcGVuZENoaWxkKHdlbGNvbWVfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQIik7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LndlbGNvbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFydF93ZWxjb21lIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZmlyc3RUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS53ZWxjb21lLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZpcnN0VGltZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZENvbW1lbnQob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjb21tZW50cywgaXNfbGl2ZTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1kaXNjdXNzaW9uIik7CiAgICAgICAgICAgICAgICAgICAgaXNfbGl2ZSA9IHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MubGl2ZXN0cmVhbTsKICAgICAgICAgICAgICAgICAgICBpZiAoYS5zcGxpdCgiY29tbWVudHMiKS5sZW5ndGggPiAxICYmICFpc19saXZlICYmIGNvbW1lbnRzICYmICFjb21tZW50cy5sYXp5bG9hZCAmJiB1c2VyX3NldHRpbmdzLlZJRF9ISURFX0NPTVMgPT09ICIxIiAmJiAhY29tbWVudHMuY2xhc3NMaXN0LmNvbnRhaW5zKCJzaG93IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMubGF6eWxvYWQgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RTZXRDb25maWcob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJTSEFSRV9PTl9WSURFT19FTkQiIGluIGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuU0hBUkVfT05fVklERU9fRU5EID0gIXVzZXJfc2V0dGluZ3MuVklEX0VORF9TSFJFOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgiVU5JVkVSU0FMX0hPVkVSQ0FSRFMiIGluIGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuVU5JVkVSU0FMX0hPVkVSQ0FSRFMgPSAhdXNlcl9zZXR0aW5ncy5HRU5fRFNCX0hWUkM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kRW1iZWQob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wLCBwbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGEuaWQgfHwgYTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcCAhPT0gInBsYXllci1hcGkiICYmIHRlbXAgIT09ICJ1cHNlbGwtdmlkZW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBiID0gbW9kQXJncyhiKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllcikgewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuc2V0UGxheWJhY2tRdWFsaXR5KHVzZXJfc2V0dGluZ3MuVklEX0RGTFRfUUxUWSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RBdXRvcGxheShvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFiIHx8IHVzZXJfc2V0dGluZ3MucGxBcGwgfHwgKCF1c2VyX3NldHRpbmdzLnBsQXBsICYmIGIuZmVhdHVyZSAmJiBiLmZlYXR1cmUgIT09ICJhdXRvcGxheSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RBdXRvcGxheUZ1bGxzY3JlZW4ob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhc19lbmRlZCwgbmV4dF9idXR0b24sIG5leHRfY2xpY2tlZDsKICAgICAgICAgICAgICAgICAgICBoYXNfZW5kZWQgPSBhcGkgJiYgYXBpLmdldEN1cnJlbnRUaW1lICYmIE1hdGgucm91bmQoYXBpLmdldEN1cnJlbnRUaW1lKCkpID49IE1hdGguZmxvb3IoYXBpLmdldER1cmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIG5leHRfY2xpY2tlZCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dHAtYnV0dG9uLW5leHQiKSB8fCBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygieXRwLW5leHQtYnV0dG9uIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLnBsQXBsICYmICFuZXh0X2NsaWNrZWQgJiYgaGFzX2VuZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1uZXh0LWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dF9idXR0b24gJiYgbmV4dF9idXR0b24uZ2V0QXR0cmlidXRlKCJhcmlhLWRpc2FibGVkIikgPT09ICJ0cnVlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9idXR0b24ub25jbGljayA9IGFwaS5uZXh0VmlkZW87CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFwaS5uZXh0VmlkZW8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9idXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLWRpc2FibGVkIiwgImZhbHNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5wbEFwbCB8fCBuZXh0X2NsaWNrZWQgfHwgIWhhc19lbmRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dF9jbGlja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIikuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZEFyZ3NXYXRjaChhcmdzKSB7CiAgICAgICAgICAgICAgICBpZiAoYXJncyAmJiBhcmdzLmF1dG9wbGF5ID09PSAiMSIgJiYgIXVzZXJfc2V0dGluZ3MuVklEX1BMUl9BVFBMICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoID09PSAiIikgewogICAgICAgICAgICAgICAgICAgIGFyZ3MuYXV0b3BsYXkgPSAiMCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbW9kQXJnc1dhdGNoLm9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kUGxheWVyQ3JlYXRlKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaSwgdGVtcCwgcGxheWVyOwogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBhLmlkIHx8IGE7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXAgIT09ICJwbGF5ZXItYXBpIiAmJiB0ZW1wICE9PSAidXBzZWxsLXZpZGVvIikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYiA9IG1vZEFyZ3MoYik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuaWQgPT09ICJ1cHNlbGwtdmlkZW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyX2luc3RhbmNlID0gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IE9iamVjdC5rZXlzKHBsYXllcl9pbnN0YW5jZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGF5ZXJfaW5zdGFuY2VbdGVtcFtpXV0gPT09ICJvYmplY3QiICYmIHBsYXllcl9pbnN0YW5jZVt0ZW1wW2ldXSAmJiBwbGF5ZXJfaW5zdGFuY2VbdGVtcFtpXV0uaGFzTmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pbnN0YW5jZVt0ZW1wW2ldXS5oYXNOZXh0ID0gbW9kQXV0b3BsYXlGdWxsc2NyZWVuKHBsYXllcl9pbnN0YW5jZVt0ZW1wW2ldXS5oYXNOZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemVQbGF5ZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kU2Vla1RvKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odGltZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuY2FsbCh0aGlzLCB0aW1lLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNjcmlwdEV4aXQoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBqLCBrZXksIHRlbXA7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoIm5hbWUiKSA9PT0gInd3dy9iYXNlIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cueXQuc2V0Q29uZmlnID0gbW9kU2V0Q29uZmlnKHdpbmRvdy55dC5zZXRDb25maWcpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Ll95dF93d3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBPYmplY3Qua2V5cyh3aW5kb3cuX3l0X3d3dyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpID0gdGVtcC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSB0ZW1wW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93Ll95dF93d3dba2V5XSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoU3RyaW5nKHdpbmRvdy5feXRfd3d3W2tleV0pLnNwbGl0KCJwbGF5ZXItYWRkZWQiKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuX3l0X3d3d1trZXldID0gbW9kRW1iZWQod2luZG93Ll95dF93d3dba2V5XSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nKHdpbmRvdy5feXRfd3d3W2tleV0pLnNwbGl0KCJ3aW5kb3cuc3BmLm5hdmlnYXRlIikubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Ll95dF93d3dba2V5XSA9IG1vZEF1dG9wbGF5KHdpbmRvdy5feXRfd3d3W2tleV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFN0cmluZyh3aW5kb3cuX3l0X3d3d1trZXldKS5zcGxpdCgiLnNldChcIlwiK2EsYixjLFwiL1wiLGQiKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cueXRwc2V0d2lkZSA9IHdpbmRvdy5feXRfd3d3W2tleV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPT09IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJ3d3cvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dC53d3cud2F0Y2gucGxheWVyLnNlZWtUbyA9IG1vZFNlZWtUbyh3aW5kb3cueXQud3d3LndhdGNoLnBsYXllci5zZWVrVG8pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgibmFtZSIpID09PSAic3BmL3NwZiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNwZi5sb2FkID0gbW9kQ29tbWVudCh3aW5kb3cuc3BmLmxvYWQpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc3BmLnByZWZldGNoID0gZnVuY3Rpb24oKXtyZXR1cm47fTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNwZi5uYXZpZ2F0ZSA9IGZ1bmN0aW9uKCl7cmV0dXJuO307CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJwbGF5ZXIvYmFzZSIpIHx8ICghd2luZG93Lmh0bWw1UGF0Y2hlZCAmJiB3aW5kb3cueXQgJiYgd2luZG93Lnl0LnBsYXllciAmJiB3aW5kb3cueXQucGxheWVyLkFwcGxpY2F0aW9uICYmIHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24uY3JlYXRlKSkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5odG1sNVBhdGNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24uY3JlYXRlID0gbW9kUGxheWVyQ3JlYXRlKHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24uY3JlYXRlKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Ll95dF9wbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IE9iamVjdC5rZXlzKHdpbmRvdy5feXRfcGxheWVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dID09PSAiZnVuY3Rpb24iICYmIHdpbmRvdy5feXRfcGxheWVyW3RlbXBbaV1dLnRvU3RyaW5nKCkubWF0Y2goInRoaXMuYWRhcHRpdmVGb3JtYXRzIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSB0ZW1wW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZEFyZ3NXYXRjaC5vcmlnaW5hbCA9IHdpbmRvdy5feXRfcGxheWVyW2tleV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RBcmdzV2F0Y2gucHJvdG90eXBlID0gbW9kQXJnc1dhdGNoLm9yaWdpbmFsLnByb3RvdHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBPYmplY3Qua2V5cyhtb2RBcmdzV2F0Y2gub3JpZ2luYWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZEFyZ3NXYXRjaFt0ZW1wW2ldXSA9IG1vZEFyZ3NXYXRjaC5vcmlnaW5hbFt0ZW1wW2ldXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5feXRfcGxheWVyW2tleV0gPSBtb2RBcmdzV2F0Y2g7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tCb3VuZHMoZWxtLCBYLCBZKSB7CiAgICAgICAgICAgICAgICB2YXIgc25hcFgsIHNuYXBZOwogICAgICAgICAgICAgICAgaWYgKFggPiAtMSAmJiBYICsgZWxtLm9mZnNldFdpZHRoIDwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgc25hcFggPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoWCA8IDEpIHsKICAgICAgICAgICAgICAgICAgICBYID0gMDsKICAgICAgICAgICAgICAgICAgICBzbmFwWCA9IC0xOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBYID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoIC0gZWxtLm9mZnNldFdpZHRoOwogICAgICAgICAgICAgICAgICAgIHNuYXBYID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChZID4gNTAgJiYgWSArIGVsbS5vZmZzZXRIZWlnaHQgPCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgc25hcFkgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoWSA8IDUxKSB7CiAgICAgICAgICAgICAgICAgICAgWSA9IDUwOwogICAgICAgICAgICAgICAgICAgIHNuYXBZID0gLTE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gZWxtLm9mZnNldEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBzbmFwWSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4ge1g6IFggKyAicHgiLCBZOiBZICsgInB4Iiwgc25hcFg6IHNuYXBYLCBzbmFwWTogc25hcFl9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVBvcygpIHsKICAgICAgICAgICAgICAgIHZhciB4LCB5LCBoZWlnaHQsIHBsYXllciwgYm91bmRzOwogICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIikgfHwgd2luZG93LmlubmVyV2lkdGggPCA2NTcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5yZW1vdmVBdHRyaWJ1dGUoInN0eWxlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHVwZGF0ZVBvcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGVpZ2h0ID0gcGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUExSX0FMVklTX1dEVEgpIHx8IDM1MDsKICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgIGJvdW5kcyA9IGNoZWNrQm91bmRzKHBsYXllciwgdXNlcl9zZXR0aW5ncy5mbG9hdGVyWCwgdXNlcl9zZXR0aW5ncy5mbG9hdGVyWSk7CiAgICAgICAgICAgICAgICBoZWlnaHQgPSAoaGVpZ2h0IDwgMzUwID8gMzUwIDogaGVpZ2h0KSAvICgxNiAvIDkpOwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBYID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHggPSAiMHB4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICB4ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoIC0gcGxheWVyLm9mZnNldFdpZHRoICsgInB4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeCA9IGJvdW5kcy5YOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBZID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHkgPSAiNTBweCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBZID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQgLSBwbGF5ZXIub2Zmc2V0SGVpZ2h0ICsgInB4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IGJvdW5kcy5ZOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGxheWVyLnNldEF0dHJpYnV0ZSgic3R5bGUiLCAid2lkdGg6IiArIChoZWlnaHQgKiAoMTYgLyA5KSkgKyAicHg7aGVpZ2h0OiIgKyBoZWlnaHQgKyAicHg7bGVmdDoiICsgeCArICI7dG9wOiIgKyB5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnb1RvVG9wKCkgewogICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkcmFnRmxvYXRlcihldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGV4Y2x1ZGVkLCBpc0ZTY3JlZW4sIGlzRmxvYXRlciwgYm91bmRzLCBwbGF5ZXI7CiAgICAgICAgICAgICAgICBpc0ZTY3JlZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLWZ1bGxzY3JlZW4iKTsKICAgICAgICAgICAgICAgIGlzRmxvYXRlciA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAhaXNGU2NyZWVuICYmIGlzRmxvYXRlcikgewogICAgICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtY2hyb21lLWJvdHRvbSIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gIm1vdXNlZG93biIgJiYgcGxheWVyLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiYgKCFleGNsdWRlZCB8fCAhZXhjbHVkZWQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZHJhZ0Zsb2F0ZXIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIub2xkUG9zID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFg6IHBhcnNlSW50KHBsYXllci5zdHlsZS5sZWZ0KSAtIGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWTogcGFyc2VJbnQocGxheWVyLnN0eWxlLnRvcCkgLSBldmVudC5jbGllbnRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ1g6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWTogZXZlbnQuY2xpZW50WQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAibW91c2Vtb3ZlIiAmJiAoZHJhZ0Zsb2F0ZXIuaGFzTW92ZWQgfHwgTWF0aC5hYnMoZXZlbnQuY2xpZW50WCAtIGRyYWdGbG9hdGVyLm9sZFBvcy5vcmdYKSA+IDEwIHx8IE1hdGguYWJzKGV2ZW50LmNsaWVudFkgLSBkcmFnRmxvYXRlci5vbGRQb3Mub3JnWSkgPiAxMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcyA9IGNoZWNrQm91bmRzKHBsYXllciwgZXZlbnQuY2xpZW50WCArIGRyYWdGbG9hdGVyLm9sZFBvcy5YLCBldmVudC5jbGllbnRZICsgZHJhZ0Zsb2F0ZXIub2xkUG9zLlkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnN0eWxlLmxlZnQgPSBib3VuZHMuWDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5zdHlsZS50b3AgPSBib3VuZHMuWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLmhhc01vdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLnNuYXBYID0gYm91bmRzLnNuYXBYOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIuc25hcFkgPSBib3VuZHMuc25hcFk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbnMgIT09IDEgfHwgZXZlbnQudHlwZSA9PT0gImNsaWNrIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZ0Zsb2F0ZXIuaGFzTW92ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLm9sZFBvcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0Zsb2F0ZXIuaGFzTW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZmxvYXRlclggPSBwYXJzZUludChwbGF5ZXIuc3R5bGUubGVmdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmZsb2F0ZXJZID0gcGFyc2VJbnQocGxheWVyLnN0eWxlLnRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWCA9IGRyYWdGbG9hdGVyLnNuYXBYOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFkgPSBkcmFnRmxvYXRlci5zbmFwWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCgidXNlcl9zZXR0aW5ncyIsIHVzZXJfc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnRmxvYXRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGluaUZsb2F0ZXIoKSB7CiAgICAgICAgICAgICAgICB2YXIgcGxheWVyLCBwbHJBcGksIG91dF9vZl9zaWdodCwgaXNGbG9hdGVyLCBpc0ZTY3JlZW4sIGZsb2F0ZXJVSSwgc2V0dGluZ3Nfb3BlbjsKICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgIHBsckFwaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXItYXBpIikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBzZXR0aW5nc19vcGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtc2V0dGluZ3MiKTsKICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICBvdXRfb2Zfc2lnaHQgPSBwbHJBcGkuYm90dG9tIDwgKChwbHJBcGkuaGVpZ2h0IC8gMikgKyA1MCk7CiAgICAgICAgICAgICAgICAgICAgaXNGbG9hdGVyID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgICAgIGlzRlNjcmVlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtZnVsbHNjcmVlbiIpOwogICAgICAgICAgICAgICAgICAgIGZsb2F0ZXJVSSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXJ0X2Zsb2F0ZXJ1aSIpOwogICAgICAgICAgICAgICAgICAgIGlmICghZmxvYXRlclVJICYmICFpc0ZTY3JlZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRlclVJID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXRlclVJLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0ncGFydF9mbG9hdGVydWknPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9J3BhcnRfZmxvYXRlcnVpX21vdmUnIGRhdGEtcD0ndHRsfFZJRF9QTFJfQUxWSVNfTU9WRSc+PHN2ZyB2aWV3Qm94PScwIDAgMjAgMjAnPjxwb2x5Z29uIHBvaW50cz0nNi40LDMuNiA3LjIsNC4zIDEwLDEuNSAxMi44LDQuMyAxMy42LDMuNiAxMCwwJy8+PHBvbHlnb24gcG9pbnRzPScxNi40LDYuNCAxNS43LDcuMiAxOC41LDEwIDE1LjcsMTIuOCAxNi40LDEzLjYgMjAsMTAnLz48cG9seWdvbiBwb2ludHM9JzMuNiw2LjQgMCwxMCAzLjYsMTMuNiA0LjMsMTIuOCAxLjUsMTAgNC4zLDcuMicvPjxwb2x5Z29uIHBvaW50cz0nMTAsMTguNSA3LjIsMTUuNyA2LjQsMTYuNCAxMCwyMCAxMy42LDE2LjQgMTIuOCwxNS43Jy8+PGNpcmNsZSBjeD0nMTAnIGN5PScxMCcgcj0nMicvPjwvc3ZnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9J3BhcnRfZmxvYXRlcnVpX3Njcm9sbHRvcCcgZGF0YS1wPSd0dGx8VklEX1BMUl9BTFZJU19TQ1JMX1RPUCc+PHN2ZyB2aWV3Qm94PScwIDAgMjAgMjAnPjxwb2x5Z29uIHBvaW50cz0nMTAsMC4xIDAsMTAuMSAyLjksMTIuOSAxMCw1LjggMTcuMSwxMi45IDIwLDEwLjEgJy8+PC9zdmc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGVyVUkgPSBzZXRMb2NhbGUoZmxvYXRlclVJLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5hcHBlbmRDaGlsZChmbG9hdGVyVUkpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFydF9mbG9hdGVydWlfbW92ZSIpLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhcnRfZmxvYXRlcnVpX3Njcm9sbHRvcCIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZ29Ub1RvcCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvdXRfb2Zfc2lnaHQgJiYgIWlzRmxvYXRlciAmJiAhc2V0dGluZ3Nfb3BlbikgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgdXBkYXRlUG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlUG9zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKCFvdXRfb2Zfc2lnaHQgfHwgc2V0dGluZ3Nfb3BlbikgJiYgaXNGbG9hdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCB1cGRhdGVQb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWx3YXlzVmlzaWJsZSgpIHsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQUxWSVMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgaW5pRmxvYXRlcik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBpbmlGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWx3YXlzQWN0aXZlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgbGlzdCwgY2xlYXIsIGxlbmd0aCwgZXZlbnRDbG9uZTsKICAgICAgICAgICAgICAgIGNsZWFyID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09ICIvd2F0Y2giICYmIGFwaSAmJiBhcGkgIT09IGV2ZW50LnRhcmdldCAmJiAhYXBpLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiYgIWV2ZW50LmN0cmxLZXkgJiYgIWV2ZW50LnNoaWZ0S2V5ICYmICFldmVudC5hbHRLZXkgJiYgIWV2ZW50Lm1ldGFLZXkgJiYgIWV2ZW50LnRhcmdldC5pc0NvbnRlbnRFZGl0YWJsZTsKICAgICAgICAgICAgICAgIGlmIChjbGVhciAmJiAoKGV2ZW50LndoaWNoID4gNDcgJiYgZXZlbnQud2hpY2ggPCA1OCkgfHwgKGV2ZW50LndoaWNoID4gOTUgJiYgZXZlbnQud2hpY2ggPCAxMDYpIHx8IFsyNywgMzIsIDM1LCAzNiwgMzcsIDM4LCAzOSwgNDAsIDY2LCA2NywgNzksIDg3LCAxODcsIDE4OV0uaW5kZXhPZihldmVudC53aGljaCkgPiAtMSkgJiYgWyJFTUJFRCIsICJJTlBVVCIsICJPQkpFQ1QiLCAiVEVYVEFSRUEiLCAiSUZSQU1FIl0uaW5kZXhPZihkb2N1bWVudC5hY3RpdmVFbGVtZW50LnRhZ05hbWUpIDwgMCkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50Q2xvbmUgPSBuZXcgRXZlbnQoImtleWRvd24iKTsKICAgICAgICAgICAgICAgICAgICBsaXN0ID0gT2JqZWN0LmtleXMoT2JqZWN0LmdldFByb3RvdHlwZU9mKGV2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50Q2xvbmVbbGlzdFtpXV0gPSBldmVudFtsaXN0W2ldXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBhcGkuZGlzcGF0Y2hFdmVudChldmVudENsb25lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwbGF5ZXJTdGF0ZShldmVudCkgewogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZnVsbEJycyB8fCB1c2VyX3NldHRpbmdzLmxpZ2h0c091dCkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3RbKGV2ZW50IDwgNSAmJiBldmVudCA+IDAgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgodXNlcl9zZXR0aW5ncy5mdWxsQnJzICYmICJwYXJ0X2Z1bGxicm93c2VyIikgfHwgIjAiLCAodXNlcl9zZXR0aW5ncy5saWdodHNPdXQgJiYgInBhcnRfY2luZW1hX21vZGUiKSB8fCAiMCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ3VzdG9tcyhldmVudCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBldmVudCA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoInZvbExldiIsIGV2ZW50LnZvbHVtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNldCgidGhlYXRlck1vZGUiLCBldmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7CiAgICAgICAgICAgICAgICBhcGkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICBpZiAoYXBpICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYzQtcGxheWVyIikpIHsKICAgICAgICAgICAgICAgICAgICBhcGkuYWRkRXZlbnRMaXN0ZW5lcigib25TdGF0ZUNoYW5nZSIsIHBsYXllclN0YXRlKTsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1ZPTF9NRU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmFkZEV2ZW50TGlzdGVuZXIoIm9uVm9sdW1lQ2hhbmdlIiwgaGFuZGxlQ3VzdG9tcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfU0laRV9NRU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmFkZEV2ZW50TGlzdGVuZXIoIlNJWkVfQ0xJQ0tFRCIsIGhhbmRsZUN1c3RvbXMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1ZPTF9NRU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBpLnNldFZvbHVtZSh1c2VyX3NldHRpbmdzLnZvbExldik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmxvb3BWaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKS5sb29wID0gdXNlcl9zZXR0aW5ncy5sb29wVmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0FMQUNUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBhbHdheXNBY3RpdmUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRUaHVtYigpIHsKICAgICAgICAgICAgICAgIHZhciBhcmdzLCBiYXNlLCB0aHVtYl91cmw7CiAgICAgICAgICAgICAgICBhcmdzID0gd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzOwogICAgICAgICAgICAgICAgYmFzZSA9IChhcmdzLml1cmxfd2VicCAmJiAiX3dlYnAiKSB8fCAiIjsKICAgICAgICAgICAgICAgIHRodW1iX3VybCA9IGFyZ3NbIml1cmxtYXhyZXMiICsgYmFzZV0gfHwgYXJnc1siaXVybHNkIiArIGJhc2VdIHx8IGFyZ3NbIml1cmwiICsgYmFzZV07CiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih0aHVtYl91cmwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGhpZGVTY3JlZW5zaG90KGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiY2xvc2Utc2NyZWVuc2hvdCIpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGhpZGVTY3JlZW5zaG90KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRTY3JlZW5zaG90KCkgewogICAgICAgICAgICAgICAgdmFyIHdpZHRoLCBoZWlnaHQsIGFzcGVjdFJhdGlvLCB2aWRlbywgY29udGFpbmVyLCBjYW52YXMsIGNsb3NlLCBjb250ZXh0OwogICAgICAgICAgICAgICAgdmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNjcmVlbnNob3QtcmVzdWx0IikgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICBjYW52YXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcigiY2FudmFzIikgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgICAgICBhc3BlY3RSYXRpbyA9IHZpZGVvLnZpZGVvV2lkdGggLyB2aWRlby52aWRlb0hlaWdodDsKICAgICAgICAgICAgICAgIHdpZHRoID0gdmlkZW8udmlkZW9XaWR0aDsKICAgICAgICAgICAgICAgIGhlaWdodCA9IHBhcnNlSW50KHdpZHRoIC8gYXNwZWN0UmF0aW8sIDEwKTsKICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKHZpZGVvLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmICghY29udGFpbmVyLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmlkID0gInNjcmVlbnNob3QtcmVzdWx0IjsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTsKICAgICAgICAgICAgICAgICAgICBjbG9zZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgICAgIGNsb3NlLmlkID0gImNsb3NlLXNjcmVlbnNob3QiOwogICAgICAgICAgICAgICAgICAgIGNsb3NlLnRleHRDb250ZW50ID0gbGFuZygiQ05TTF9TU19DTFMiKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhpZGVTY3JlZW5zaG90KTsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2xvc2UpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBleGl0RnVsbEJyb3dzZXIoa2V5KSB7CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygicGFydF9mdWxsYnJvd3NlciIpICYmIChrZXkua2V5Q29kZSA9PT0gMjcgfHwga2V5LmtleSA9PT0gIkVzY2FwZSIgfHwgKGtleS50YXJnZXQuY2xhc3NOYW1lICYmIGtleS50YXJnZXQuY2xhc3NOYW1lLnNwbGl0KCJ5dHAtc2l6ZSIpLmxlbmd0aCA+IDEpKSkgewogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZ1bGxCcm93c2VyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS50eXBlID09PSAibW91c2Vkb3duIikgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAga2V5LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUZ1bGxCcm93c2VyKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcGxyU3RhdGUgPSBhcGkgJiYgYXBpLmdldFBsYXllclN0YXRlICYmIGFwaS5nZXRQbGF5ZXJTdGF0ZSgpOwogICAgICAgICAgICAgICAgcGxyU3RhdGUgPSBwbHJTdGF0ZSA8IDUgJiYgcGxyU3RhdGUgPiAwOwogICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBleGl0RnVsbEJyb3dzZXIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgIHNldCgiZnVsbEJycyIsIGV2ZW50ID8gIXVzZXJfc2V0dGluZ3MuZnVsbEJycyA6IHRydWUpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZ1bGxfYnJvd3Nlci5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuZnVsbEJycyAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAocGxyU3RhdGUgfHwgZXZlbnQua2V5Q29kZSA9PT0gMjcgfHwgZXZlbnQua2V5ID09PSAiRXNjYXBlIikpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLmZ1bGxCcnMgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgicGFydF9mdWxsYnJvd3NlciIpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZVNob3J0Y3V0cygpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKCJodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvWW91VHViZS1zaG9ydGN1dHMiLCAiX2JsYW5rIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlQ29uc29sZShldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gImNvbnNvbGUtYnV0dG9uIikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCJwbGF5ZXItY29uc29sZSIpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3RbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygicGxheWVyLWNvbnNvbGUiKSA/ICJhZGQiIDogInJlbW92ZSJdKCJjbG9zZSIpOwogICAgICAgICAgICAgICAgICAgIHNldCgiYWR2T3B0cyIsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoInBsYXllci1jb25zb2xlIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZVBsYXkoKSB7CiAgICAgICAgICAgICAgICBzZXQoIlZJRF9QTFJfQVRQTCIsICF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJwYXJ0X2F1dG9wbGF5b24iKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhdXRvcGxheS1idXR0b24iKS5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9BVFBMICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oImFjdGl2ZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUxvb3AoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciB2aWRlb1BsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7CiAgICAgICAgICAgICAgICBpZiAodmlkZW9QbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICB2aWRlb1BsYXllci5sb29wID0gZXZlbnQgPyAhdXNlcl9zZXR0aW5ncy5sb29wVmlkIDogdXNlcl9zZXR0aW5ncy5sb29wVmlkOwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMubG9vcF9idXR0b24uY2xhc3NMaXN0WyghdXNlcl9zZXR0aW5ncy5sb29wVmlkICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNldCgibG9vcFZpZCIsIGFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVDaW5lbWFNb2RlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcGxyU3RhdGUgPSBhcGkgJiYgYXBpLmdldFBsYXllclN0YXRlICYmIGFwaS5nZXRQbGF5ZXJTdGF0ZSgpIDwgNSAmJiBhcGkuZ2V0UGxheWVyU3RhdGUoKSA+IDA7CiAgICAgICAgICAgICAgICBzZXQoImxpZ2h0c091dCIsIGV2ZW50ID8gIXVzZXJfc2V0dGluZ3MubGlnaHRzT3V0IDogdHJ1ZSk7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY2luZW1hX21vZGUuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLmxpZ2h0c091dCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBwbHJTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MubGlnaHRzT3V0ICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oInBhcnRfY2luZW1hX21vZGUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVUb2dnbGVzKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmRhdGFzZXQgJiYgZXZlbnQudGFyZ2V0LmRhdGFzZXQuYWN0aW9uICYmIGFkdmFuY2VkT3B0aW9ucy5hY3Rpb25zW2V2ZW50LnRhcmdldC5kYXRhc2V0LmFjdGlvbl0pIHsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuYWN0aW9uc1tldmVudC50YXJnZXQuZGF0YXNldC5hY3Rpb25dKGV2ZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBob29rQnV0dG9ucygpIHsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5wb3BQbGF5ZXIgPSBwb3BQbGF5ZXI7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnVsbF9icm93c2VyID0gYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLnF1ZXJ5U2VsZWN0b3IoIiNmdWxsYnJvd3Nlci1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jaW5lbWFfbW9kZSA9IGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5xdWVyeVNlbGVjdG9yKCIjY2luZW1hbW9kZS1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbiA9IGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5xdWVyeVNlbGVjdG9yKCIjbG9vcC1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5hY3Rpb25zID0gewogICAgICAgICAgICAgICAgICAgIHRvZ2dsZVBsYXk6IHRvZ2dsZVBsYXksCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlTG9vcDogdG9nZ2xlTG9vcCwKICAgICAgICAgICAgICAgICAgICBnZXRUaHVtYjogZ2V0VGh1bWIsCiAgICAgICAgICAgICAgICAgICAgZ2V0U2NyZWVuc2hvdDogZ2V0U2NyZWVuc2hvdCwKICAgICAgICAgICAgICAgICAgICBwb3BQbGF5ZXI6IHBvcFBsYXllciwKICAgICAgICAgICAgICAgICAgICB0b2dnbGVGdWxsQnJvd3NlcjogdG9nZ2xlRnVsbEJyb3dzZXIsCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQ2luZW1hTW9kZTogdG9nZ2xlQ2luZW1hTW9kZSwKICAgICAgICAgICAgICAgICAgICB0b2dnbGVTaG9ydGN1dHM6IHRvZ2dsZVNob3J0Y3V0cwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaGFuZGxlVG9nZ2xlcyk7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5sb29wVmlkICYmICFhZHZhbmNlZE9wdGlvbnMubG9vcF9idXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB0b2dnbGVMb29wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5mdWxsQnJzICYmICFhZHZhbmNlZE9wdGlvbnMuZnVsbF9icm93c2VyLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnVsbF9icm93c2VyLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZ1bGxCcm93c2VyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5saWdodHNPdXQgJiYgIWFkdmFuY2VkT3B0aW9ucy5jaW5lbWFfbW9kZS5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNpbmVtYV9tb2RlLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNpbmVtYU1vZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBhZHZhbmNlZE9wdGlvbnMoKSB7CiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyLCBjbnNsQnRuLCBjbnNsQ29udDsKICAgICAgICAgICAgICAgIGhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1oZWFkZXIiKTsKICAgICAgICAgICAgICAgIGNuc2xCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uc29sZS1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXItY29uc29sZSIpOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgaGVhZGVyICYmICFjbnNsQnRuKSB7CiAgICAgICAgICAgICAgICAgICAgY25zbEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgY25zbEJ0bi5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGJ1dHRvbiBpZD0nY29uc29sZS1idXR0b24nIGRhdGEtcD0ndHRsfEFEVl9PUFRTJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9J2Nsb3NlJyB2aWV3Qm94PScwIDAgMTAgMTAnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nMTAsMS40IDguNiwwIDUsMy42IDEuNCwwIDAsMS40IDMuNiw1IDAsOC42IDEuNCwxMCA1LDYuNCA4LjYsMTAgMTAsOC42IDYuNCw1Jy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9J29wZW4nIHZpZXdCb3g9JzAgMCAxMiAxMCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3Qgd2lkdGg9JzEyJyBoZWlnaHQ9JzInLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCB3aWR0aD0nMTInIGhlaWdodD0nMicgeT0nNCcvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IHdpZHRoPScxMicgaGVpZ2h0PScyJyB5PSc4Jy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+YDsKICAgICAgICAgICAgICAgICAgICBjbnNsQnRuID0gc2V0TG9jYWxlKGNuc2xCdG4uY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRvZ2dsZUNvbnNvbGUpOwogICAgICAgICAgICAgICAgICAgIGNuc2xDb250ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udC5pbm5lckhUTUwgPSAiPGRpdiBpZD0nYWR2YW5jZWQtb3B0aW9ucyc+PC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udCA9IGNuc2xDb250LmNvbnRlbnQuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udC5hcHBlbmRDaGlsZChjbnNsQnRuKTsKICAgICAgICAgICAgICAgICAgICBoZWFkZXIuYXBwZW5kQ2hpbGQoY25zbENvbnQpOwogICAgICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0ncGxheWVyLWNvbnNvbGUnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nYXV0b3BsYXktYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfQVAnIGRhdGEtYWN0aW9uPSd0b2dnbGVQbGF5Jz48c3ZnIHZpZXdCb3g9JzAgMCAxNCAxNic+PHBvbHlnb24gcG9pbnRzPScwLDE2IDE0LDggMCwwJy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdsb29wLWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX1JQVCcgZGF0YS1hY3Rpb249J3RvZ2dsZUxvb3AnPjxzdmcgdmlld0JveD0nMCAwIDIwLjUgMTgnPjxwYXRoIGQ9J00xMS41LDBDOSwwLDYuOCwxLDUuMSwyLjZsMS40LDEuNEM3LjgsMi44LDkuNiwyLDExLjUsMmMzLjksMCw3LDMuMSw3LDdjMCwzLjktMy4xLDctNyw3cy03LTMuMS03LTdIN0wzLjUsNEwwLDkgaDIuNWMwLDUsNCw5LDksOXM5LTQsOS05QzIwLjUsNCwxNi41LDAsMTEuNSwweicvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nc2F2ZS10aHVtYm5haWwtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfU1ZUSCcgZGF0YS1hY3Rpb249J2dldFRodW1iJz48c3ZnIHZpZXdCb3g9JzAgMCAyNCAxOCc+PHBhdGggZD0nTTAsMHYxOGgyNFYwSDB6IE0yMiwxNkgyVjJoMjBWMTZ6Jy8+PGNpcmNsZSBjeD0nOCcgY3k9JzYnIHI9JzMnLz48cG9seWdvbiBwb2ludHM9JzMsMTIgNiwxMCA5LDEyIDEwLDEyIDE2LDYgMjEsMTEgMjEsMTUgMywxNScvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nc2NyZWVuc2hvdC1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9TUycgZGF0YS1hY3Rpb249J2dldFNjcmVlbnNob3QnPjxzdmcgdmlld0JveD0nMCAwIDIyIDE4Jz48cGF0aCBkPSdNMTcuNyw0bC0yLjMtNGgtOUw0LjEsNEgwdjE0aDIyVjRIMTcuN3ogTTExLDE1Yy0yLjgsMC01LTIuMi01LTVzMi4yLTUsNS01czUsMi4yLDUsNVMxMy44LDE1LDExLDE1eicvPjxjaXJjbGUgY3g9JzExJyBjeT0nMTAnIHI9JzQnLz48L3N2Zz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J3BvcG91dC1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9QUE9UJyBkYXRhLWFjdGlvbj0ncG9wUGxheWVyJz48c3ZnIHZpZXdCb3g9JzAgMCAyMiAxNic+PHBhdGggZD0nTTYsMHYxMmgxNlYwSDZ6IE0yMCwxMEg4VjJoMTJWMTB6Jy8+PHBvbHlnb24gcG9pbnRzPScxNCwxNCAyLDE0IDIsNiA1LDYgNSw0IDAsNCAwLDE2IDE2LDE2IDE2LDEzIDE0LDEzJy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdmdWxsYnJvd3Nlci1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9GTEJSJyBkYXRhLWFjdGlvbj0ndG9nZ2xlRnVsbEJyb3dzZXInPjxzdmcgdmlld0JveD0nMCAwIDIwIDE4Jz48cGF0aCBkPSdNMCwwdjE4aDIwVjBIMHogTTE4LDE2SDJWNGgxNlYxNnonLz48cG9seWdvbiBwb2ludHM9JzMsNSAzLDkgNSw5IDUsNyA3LDcgNyw1Jy8+PHBvbHlnb24gcG9pbnRzPScxNyw1IDEzLDUgMTMsNyAxNSw3IDE1LDkgMTcsOScvPjxwb2x5Z29uIHBvaW50cz0nMTcsMTUgMTcsMTEgMTUsMTEgMTUsMTMgMTMsMTMgMTMsMTUnLz48cG9seWdvbiBwb2ludHM9JzMsMTUgNywxNSA3LDEzIDUsMTMgNSwxMSAzLDExJy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdjaW5lbWFtb2RlLWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX0NJTk1fTUQnIGRhdGEtYWN0aW9uPSd0b2dnbGVDaW5lbWFNb2RlJz48c3ZnIHZpZXdCb3g9JzAgMCAyMCAxOCc+PHBhdGggZD0nTTE4LDB2MmgtMlYwSDR2MkgyVjBIMHYxOGgydi0yaDJ2MmgxMnYtMmgydjJoMlYwSDE4eiBNNCwxNEgydi0yaDJWMTR6IE00LDEwSDJWOGgyVjEweiBNNCw2SDJWNGgyVjZ6IE0xNCwxNiBINnYtNmg4VjE2eiBNMTQsOEg2VjJoOFY4eiBNMTgsMTRoLTJ2LTJoMlYxNHogTTE4LDEwaC0yVjhoMlYxMHogTTE4LDZoLTJWNGgyVjZ6Jy8+PC9zdmc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdzaG9ydGN1dHMtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfWVRTQycgZGF0YS1hY3Rpb249J3RvZ2dsZVNob3J0Y3V0cyc+PHN2ZyB2aWV3Qm94PScwIDAgMTggMTgnPjxwb2x5Z29uIHBvaW50cz0nNyw4IDEwLDggMTAsMTMgMTEsMTMgMTEsMTQgNywxNCA3LDEzIDgsMTMgOCw5IDcsOScvPjxyZWN0IHg9JzgnIHk9JzQnIHdpZHRoPScyJyBoZWlnaHQ9JzInLz48cGF0aCBkPSdNOSwwQzQsMCwwLDQsMCw5YzAsNSw0LDksOSw5czktNCw5LTlDMTgsNCwxNCwwLDksMHogTTksMTYuMWMtMy45LDAtNy4xLTMuMi03LjEtNy4xUzUuMSwxLjksOSwxLjkgczcuMSwzLjIsNy4xLDcuMVMxMi45LDE2LjEsOSwxNi4xeicvPjwvc3ZnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCkgewogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMuY29udGVudC5xdWVyeVNlbGVjdG9yKCIjYXV0b3BsYXktYnV0dG9uIikuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scyA9IHNldExvY2FsZShhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMuY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udC5hcHBlbmRDaGlsZChhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMpOwogICAgICAgICAgICAgICAgICAgIGhvb2tCdXR0b25zKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuYWR2T3B0cykgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgicGxheWVyLWNvbnNvbGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgY25zbEJ0bi5jbGFzc0xpc3QuYWRkKCJjbG9zZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBpbmlBY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBvYnNlcnZlciwgbG9hZF9tb3JlLCBjbGlja190aXRsZTsKICAgICAgICAgICAgICAgIGxvYWRfbW9yZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN3YXRjaC1tb3JlLXJlbGF0ZWQsIC5sb2FkLW1vcmUtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBjbGlja190aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtdGlsZSIpOwogICAgICAgICAgICAgICAgd2hpbGUgKGNsaWNrX3RpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgY2xpY2tfdGl0bGUuY2xhc3NMaXN0LnJlbW92ZSgieXQtdWl4LXRpbGUiKTsKICAgICAgICAgICAgICAgICAgICBjbGlja190aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtdGlsZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGxvYWRfbW9yZSAmJiAhbG9hZF9tb3JlLmNsYXNzTGlzdC5jb250YWlucygibW9kVGh1bWJzIikpIHsKICAgICAgICAgICAgICAgICAgICBsb2FkX21vcmUuY2xhc3NMaXN0LmFkZCgibW9kVGh1bWJzIik7CiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtb2RUaHVtYnMpOwogICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUobG9hZF9tb3JlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAvcG9wb3V0bW9kZXxibGFja2xpc3QvLnRlc3QoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50ID0gZXZlbnQudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5jbGFzc0xpc3QuY29udGFpbnMoInBvcG91dG1vZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwb3BQbGF5ZXIoZXZlbnQuZGF0YXNldC5saW5rKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmRhdGFzZXQueXRpZCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5ibGFja2xpc3RbZXZlbnQuZGF0YXNldC55dGlkXSA9IGV2ZW50LmRhdGFzZXQudXNlcjsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJibGFja2xpc3QiLCB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZFRodW1icygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRCdXR0b25zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGxpc3QsIHRlbXAsIHRodW1iLCBidXR0b247CiAgICAgICAgICAgICAgICBsaXN0ID0gT2JqZWN0LmtleXMobW9kVGh1bWJzLnRodW1icyk7CiAgICAgICAgICAgICAgICBpID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG1vZFRodW1icy50aHVtYnNbbGlzdFtpXV07CiAgICAgICAgICAgICAgICAgICAgaiA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSB0ZW1wW2pdLnF1ZXJ5U2VsZWN0b3IoIi55dC1sb2NrdXAtdGh1bWJuYWlsLCAudGh1bWItd3JhcHBlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGh1bWIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9QUE9UX09OICYmICF0aHVtYi5xdWVyeVNlbGVjdG9yKCIucG9wb3V0bW9kZSIpICYmICEvY2hhbm5lbC8udGVzdCh0ZW1wW2pdLmZpcnN0Q2hpbGQuY2xhc3NOYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGRhdGEtcD0ndHRsfFBQT1RfT1BFTiZ0dHB8UFBPVF9PUEVOJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAgcG9wb3V0bW9kZSc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHZpZXdCb3g9JzAgMCAxMCAxMCcgY2xhc3M9J3RodW1iLXN2Zyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPSc3LDkgMSw5IDEsNCAzLDQgMywyIDAsMiAwLDEwIDgsMTAgOCw3IDcsNycvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9J000LDB2Nmg2VjBINHogTTksNUg1VjJoNFY1eicvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5kYXRhc2V0LmxpbmsgPSB0ZW1wW2pdLnF1ZXJ5U2VsZWN0b3IoImFbaHJlZio9Jy93YXRjaD92J10iKS5ocmVmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iLmFwcGVuZENoaWxkKHNldExvY2FsZShidXR0b24uY29udGVudCkuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5CTEtfT04gJiYgIXRodW1iLnF1ZXJ5U2VsZWN0b3IoIi5ibGFja2xpc3QiKSAmJiB3aW5kb3cueXQuY29uZmlnXy5QQUdFX05BTUUgIT09ICJjaGFubmVsIiAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvZmVlZC9zdWJzY3JpcHRpb25zIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGRhdGEtcD0ndHRsfEJMQ0tfQUREJnR0cHxCTENLX0FERCcgY2xhc3M9J3l0LXVpeC10b29sdGlwIGJsYWNrbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHZpZXdCb3g9JzAgMCAxMCAxMCcgY2xhc3M9J3RodW1iLXN2Zyc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gcG9pbnRzPScxMCwxLjQgOC42LDAgNSwzLjYgMS40LDAgMCwxLjQgMy42LDUgMCw4LjYgMS40LDEwIDUsNi40IDguNiwxMCAxMCw4LjYgNi40LDUnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LmZpcnN0Q2hpbGQuZGF0YXNldC51c2VyID0gdGVtcFtqXS51c2VybmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmRhdGFzZXQueXRpZCA9IGxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIuYXBwZW5kQ2hpbGQoc2V0TG9jYWxlKGJ1dHRvbi5jb250ZW50KS5maXJzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkZWxWaWRlb3MoKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgaiwgdGVtcCwgcGFyZW50LCBibGFja2xpc3QsIGhhc191cG5leHQ7CiAgICAgICAgICAgICAgICBoYXNfdXBuZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmF1dG9wbGF5LWJhciIpOwogICAgICAgICAgICAgICAgYmxhY2tsaXN0ID0gT2JqZWN0LmtleXModXNlcl9zZXR0aW5ncy5ibGFja2xpc3QpOwogICAgICAgICAgICAgICAgaSA9IGJsYWNrbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG1vZFRodW1icy50aHVtYnNbYmxhY2tsaXN0W2ldXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcCkgewogICAgICAgICAgICAgICAgICAgICAgICBqID0gdGVtcC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNfdXBuZXh0ICYmIGhhc191cG5leHQuY29udGFpbnModGVtcFtqXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNfdXBuZXh0LnBhcmVudE5vZGUub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzX3VwbmV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi53YXRjaC1zaWRlYmFyLXNlcGFyYXRpb24tbGluZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNfdXBuZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc191cG5leHQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc191cG5leHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gdGVtcFtqXS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbal0ub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmNoaWxkRWxlbWVudENvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuZmlyc3RDaGlsZC5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRlbXAubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbW9kVGh1bWJzLnRodW1ic1tibGFja2xpc3RbaV1dOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmZlZWQtaXRlbS1jb250YWluZXI6bm90KC5zZWFyY2gtaGlzdG9yeS1pdGVtKSIpOwogICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoInVsIikubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSB0ZW1wW2ldLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbaV0ub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuY2hpbGRFbGVtZW50Q291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmZpcnN0Q2hpbGQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmlkZW9zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGxpc3QsIHRlbXAsIGNoYW5uZWxfaWQ7CiAgICAgICAgICAgICAgICBtb2RUaHVtYnMudGh1bWJzID0ge307CiAgICAgICAgICAgICAgICBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgCiAgICAgICAgICAgICAgICAgICAgLnl0LWxvY2t1cC1ieWxpbmUgPiBhLAogICAgICAgICAgICAgICAgICAgIC55dC1sb2NrdXAtY29udGVudCAuZy1ob3ZlcmNhcmQsCiAgICAgICAgICAgICAgICAgICAgLnZpZGVvLWxpc3QtaXRlbSAuZy1ob3ZlcmNhcmQsCiAgICAgICAgICAgICAgICAgICAgLmNoYW5uZWxzLWNvbnRlbnQtaXRlbSAueXQtbG9ja3VwLXRpdGxlID4gYQogICAgICAgICAgICAgICAgYCk7CiAgICAgICAgICAgICAgICBpID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IGxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbF9pZCA9IHRlbXAuZGF0YXNldC55dGlkOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0ZW1wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wLnRhZ05hbWUgJiYgdGVtcC50YWdOYW1lID09PSAiTEkiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLnVzZXJuYW1lID0gbGlzdFtpXS50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbW9kVGh1bWJzLnRodW1ic1tjaGFubmVsX2lkXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZFRodW1icy50aHVtYnNbY2hhbm5lbF9pZF0gPSBbdGVtcF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZFRodW1icy50aHVtYnNbY2hhbm5lbF9pZF0uaW5kZXhPZih0ZW1wKSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RUaHVtYnMudGh1bWJzW2NoYW5uZWxfaWRdLnB1c2godGVtcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RUaHVtYnMoKSB7CiAgICAgICAgICAgICAgICBpZiAoKHVzZXJfc2V0dGluZ3MuQkxLX09OIHx8IHVzZXJfc2V0dGluZ3MuR0VOX1BQT1RfT04pICYmICF3aW5kb3cub3BlbmVyICYmIHdpbmRvdy55dCAmJiB3aW5kb3cueXQuY29uZmlnXyAmJiAvd2F0Y2h8aW5kZXh8ZmVlZHxjaGFubmVsfHJlc3VsdHMvLnRlc3Qod2luZG93Lnl0LmNvbmZpZ18uUEFHRV9OQU1FKSkgewogICAgICAgICAgICAgICAgICAgIGdldFZpZGVvcygpOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkJMS19PTiAmJiB3aW5kb3cueXQuY29uZmlnXy5QQUdFX05BTUUgIT09ICJjaGFubmVsIikgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxWaWRlb3MoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0QnV0dG9ucygpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaW5pQWN0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpbmlBY3Rpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRWaWRlb0NvdW50KCkgewogICAgICAgICAgICAgICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgICAgICAgICAgICBzcGFuLnRleHRDb250ZW50ID0gIiDCtyAiOwogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lLmFwcGVuZENoaWxkKHNwYW4pOwogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsuaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyAiL2NoYW5uZWwvIiArIGVuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZCArICIvdmlkZW9zIjsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VybmFtZS5hcHBlbmRDaGlsZChlbmhhbmNlZERldGFpbHMubGluayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVmlkZW9Db3VudChkZXRhaWxzKSB7CiAgICAgICAgICAgICAgICBkZXRhaWxzID0gZGV0YWlscy50YXJnZXQucmVzcG9uc2UucXVlcnlTZWxlY3RvcigiLnBsLWhlYWRlci1kZXRhaWxzIGxpOm50aC1jaGlsZCgyKSIpOwogICAgICAgICAgICAgICAgaWYgKGRldGFpbHMpIHsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMubGluay5jbGFzc05hbWUgPSAic3BmLWxpbmsiOwogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy5saW5rLnRleHRDb250ZW50ID0gY2lkW2VuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZF0gPSBkZXRhaWxzLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIHNldFZpZGVvQ291bnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRWaWRlb0NvdW50KCkgewogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0LXVzZXItaW5mbyIpOwogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXBsb2FkZWQtdmlkZW9zIikgJiYgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsuaWQgPSAidXBsb2FkZWQtdmlkZW9zIjsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMudXNlcm5hbWUuYXBwZW5kQ2hpbGQoZW5oYW5jZWREZXRhaWxzLmxpbmspOwogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VyID0gZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lLnF1ZXJ5U2VsZWN0b3IoImEiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2lkW2VuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsudGV4dENvbnRlbnQgPSBjaWRbZW5oYW5jZWREZXRhaWxzLnVzZXIuZGF0YXNldC55dGlkXTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VmlkZW9Db3VudCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCB1cGRhdGVWaWRlb0NvdW50LCAiL3BsYXlsaXN0P2xpc3Q9IiArIGVuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZC5yZXBsYWNlKCJVQyIsICJVVSIpLCAiZG9jIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENoYW5uZWxJbmZvKGRldGFpbHMpIHsKICAgICAgICAgICAgICAgIHZhciByZXRyeSwgaXNMaXZlOwogICAgICAgICAgICAgICAgaXNMaXZlID0gZGV0YWlscy50YXJnZXQucmVzcG9uc2UucXVlcnlTZWxlY3RvcigiLnl0LWJhZGdlLWxpdmUiKTsKICAgICAgICAgICAgICAgIGlmICghaXNMaXZlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0cnkgPSBkZXRhaWxzLnRhcmdldC5yZXNwb25zZVVSTC5zcGxpdCgiL3ZpZGVvcyIpLmxlbmd0aCA8IDI7CiAgICAgICAgICAgICAgICAgICAgZGV0YWlscyA9IGRldGFpbHMudGFyZ2V0LnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLWNvbnRleHQtaXRlbS1pZD0nIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy52aWRlb19pZCArICInXSAueXQtbG9ja3VwLW1ldGEtaW5mbyBsaSIpOwogICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWxzICYmIGRldGFpbHMubGVuZ3RoID4gMCAmJiBlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lLnRleHRDb250ZW50LnNwbGl0KCLCtyIpLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS50ZXh0Q29udGVudCArPSAiIMK3ICIgKyBkZXRhaWxzW3JldHJ5ID8gMCA6IDFdLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmV0cnkgJiYgd2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWcgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy51Y2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCBnZXRDaGFubmVsSW5mbywgIi9jaGFubmVsLyIgKyB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudWNpZCArICIvdmlkZW9zIiwgImRvYyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRQdWJsaXNoZWRUaW1lKCkgewogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi53YXRjaC10aW1lLXRleHQiKTsKICAgICAgICAgICAgICAgIGlmIChlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lICYmICFlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lLmZldGNoaW5nICYmIHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS5mZXRjaGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgbG9jYWxYSFIoIkdFVCIsIGdldENoYW5uZWxJbmZvLCAiL2NoYW5uZWwvIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy51Y2lkICsgIi9zZWFyY2g/cXVlcnk9JTIyIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy52aWRlb19pZCArICIlMjIiLCAiZG9jIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZW5oYW5jZWREZXRhaWxzKCkgewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfVklEX0NOVCkgewogICAgICAgICAgICAgICAgICAgICAgICBnZXRWaWRlb0NvdW50KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QT1NUX1RJTUUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UHVibGlzaGVkVGltZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXZlcnNlQ29udHJvbCgpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB0ZW1wLCBwcmV2LCBuZXh0LCBsaXN0LCB2aWRlb3M7CiAgICAgICAgICAgICAgICBwcmV2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnByZXYtcGxheWxpc3QtbGlzdC1pdGVtIik7CiAgICAgICAgICAgICAgICBuZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm5leHQtcGxheWxpc3QtbGlzdC1pdGVtIik7CiAgICAgICAgICAgICAgICBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXlsaXN0LWF1dG9zY3JvbGwtbGlzdCIpOwogICAgICAgICAgICAgICAgdmlkZW9zID0gbGlzdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGkiKTsKICAgICAgICAgICAgICAgIGkgPSB2aWRlb3MubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQodmlkZW9zW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXAgPSBwcmV2LmhyZWY7CiAgICAgICAgICAgICAgICBwcmV2LmhyZWYgPSBuZXh0LmhyZWY7CiAgICAgICAgICAgICAgICBuZXh0LmhyZWYgPSB0ZW1wOwogICAgICAgICAgICAgICAgbGlzdC5zY3JvbGxUb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY3VycmVudGx5LXBsYXlpbmciKS5vZmZzZXRUb3A7CiAgICAgICAgICAgICAgICBpZiAoYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgYXBpLnVwZGF0ZVBsYXlsaXN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZUJ1dHRvbihldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gInJldmVyc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoInl0LXVpeC1idXR0b24tdG9nZ2xlZCIpOwogICAgICAgICAgICAgICAgICAgIHNldCgicGxSZXYiLCBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dC11aXgtYnV0dG9uLXRvZ2dsZWQiKSk7CiAgICAgICAgICAgICAgICAgICAgcmV2ZXJzZUNvbnRyb2woKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBhdXRvcGxheUJ1dHRvbihldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gImF1dG9wbGF5IikgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCJ5dC11aXgtYnV0dG9uLXRvZ2dsZWQiKTsKICAgICAgICAgICAgICAgICAgICBzZXQoInBsQXBsIiwgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygieXQtdWl4LWJ1dHRvbi10b2dnbGVkIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1dHRvbih0eXBlLCBsYWJlbCwgYm9vbCwgY2FsbCkgewogICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICBidXR0b24uaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICBgPGJ1dHRvbiBjbGFzcz0neXQtdWl4LWJ1dHRvbiB5dC11aXgtYnV0dG9uLXBsYXllci1jb250cm9scyB5dC11aXgtYnV0dG9uLW9wYWNpdHkgeXQtdWl4LXRvb2x0aXAnIHR5cGU9J2J1dHRvbic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSdwbC1hdXRvcGxheScgdmlld0JveD0nMCAwIDE0IDE2Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzAsMTYgMTQsOCAwLDAnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0ncGwtcmV2ZXJzZScgdmlld0JveD0nMCAwIDE2IDIwJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBwb2ludHM9JzcsOCAzLDggMywxNCAwLDE0IDUsMjAgMTAsMTQgNywxNCcvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nMTEsMCA2LDYgOSw2IDksMTIgMTMsMTIgMTMsNiAxNiw2Jy8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgaWYgKGJvb2wgPT09IHRydWUgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoYm9vbCkubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoImJ1dHRvbiIpLmNsYXNzTGlzdC5hZGQoInl0LXVpeC1idXR0b24tdG9nZ2xlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5pZCA9IHR5cGU7CiAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmRhdGFzZXQucCA9ICJ0dHB8IiArIGxhYmVsICsgIiZ0dGx8IiArIGxhYmVsOwogICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5jbGFzc0xpc3QuYWRkKCJ5dC11aXgtYnV0dG9uLWljb24td2F0Y2gtYXBwYmFyLSIgKyB0eXBlICsgIi12aWRlby1saXN0Iik7CiAgICAgICAgICAgICAgICBidXR0b24gPSBzZXRMb2NhbGUoYnV0dG9uLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICBwbGF5bGlzdENvbnRyb2xzLnBsQmFyLmNsYXNzTmFtZSA9IHBsYXlsaXN0Q29udHJvbHMucGxCYXIuY2xhc3NOYW1lLnJlcGxhY2UoInJhZGlvLXBsYXlsaXN0IiwgIiIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBjYWxsKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5wbGF5bGlzdC1uYXYtY29udHJvbHMiKS5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYXlsaXN0Q29udHJvbHMoKSB7CiAgICAgICAgICAgICAgICBwbGF5bGlzdENvbnRyb2xzLnBsQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWFwcGJhci1wbGF5bGlzdCIpOwogICAgICAgICAgICAgICAgaWYgKHBsYXlsaXN0Q29udHJvbHMucGxCYXIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiAmJiB1c2VyX3NldHRpbmdzLnBsUmV2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldmVyc2VDb250cm9sKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFNUX1JWUlMgJiYgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXZlcnNlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQnV0dG9uKCJyZXZlcnNlIiwgIlBMU1RfUlZSUyIsIHVzZXJfc2V0dGluZ3MucGxSZXYsIHJldmVyc2VCdXR0b24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExTVF9BVFBMICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXV0b3BsYXkiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVCdXR0b24oImF1dG9wbGF5IiwgIlBMU1RfQVAiLCB1c2VyX3NldHRpbmdzLnBsQXBsLCBhdXRvcGxheUJ1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHhoclBhdGNoKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgdGVtcCwgcGxheWVyOwogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gNCkgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSB7YXJnczogSlNPTi5wYXJzZSgKICAgICAgICAgICAgICAgICAgICAgICAgIntcIiIgKwogICAgICAgICAgICAgICAgICAgICAgICBkZWNvZGVVUklDb21wb25lbnQodGhpcy5yZXNwb25zZVRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lNUMvZywgIiU1QyU1QyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJTIyL2csICIlNUMlMjIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgIlwiLFwiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cPS9nLCAiXCI6XCIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1wrL2csICIlMjAiKQogICAgICAgICAgICAgICAgICAgICAgICApICsKICAgICAgICAgICAgICAgICAgICAgICAgIlwifSIKICAgICAgICAgICAgICAgICAgICApfTsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gbW9kQXJncyh0ZW1wKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KHRlbXAuYXJncykuc3BsaXQoL1x7IihbXHdcV10qPykiXH0vKVsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyU1QyU1Qy9nLCAiJTVDIikKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyU1QyUyMi9nLCAiJTIyIikKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyUyMiUyQyUyMi9nLCAiJiIpCiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lMjIlM0ElMjIvZywgIj0iKQogICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJTIwL2csICIrIik7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJyZXNwb25zZVRleHQiLCB7d3JpdGFibGU6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlVGV4dCA9IHRlbXA7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnNldFBsYXliYWNrUXVhbGl0eSh1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjaGVja1hIUihvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG1ldGhvZCwgdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVybC5tYXRjaCgiZ2V0X3ZpZGVvX2luZm8iKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoInJlYWR5c3RhdGVjaGFuZ2UiLCB4aHJQYXRjaCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBoaWRlVm9sdW1lKCkgewogICAgICAgICAgICAgICAgaWYgKHZvbHVtZVdoZWVsLmNCb3R0b20gJiYgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QuY29udGFpbnMoInl0cC12b2x1bWUtc2xpZGVyLWFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QucmVtb3ZlKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB2b2x1bWVXaGVlbChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGZzUGwsIHBTZXRzLCBpdkNhcmQsIHBsYXllciwgY2FuU2Nyb2xsLCBkaXJlY3Rpb247CiAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgZnNQbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtcGxheWxpc3QtbWVudSIpOwogICAgICAgICAgICAgICAgcFNldHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLXNldHRpbmdzLW1lbnUiKTsKICAgICAgICAgICAgICAgIGl2Q2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5pdi1kcmF3ZXIiKTsKICAgICAgICAgICAgICAgIGNhblNjcm9sbCA9IGV2ZW50ICYmICghZnNQbCB8fCAoZnNQbCAmJiAhZnNQbC5jb250YWlucyhldmVudC50YXJnZXQpKSkgJiYgKCFpdkNhcmQgfHwgKGl2Q2FyZCAmJiAhaXZDYXJkLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpKSAmJiAoIXBTZXRzIHx8IChwU2V0cyAmJiAhcFNldHMuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGFwaSAmJiBwbGF5ZXIgJiYgY2FuU2Nyb2xsICYmIChldmVudC50YXJnZXQuaWQgPT09IGFwaSB8fCBhcGkuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHZvbHVtZVdoZWVsLmNCb3R0b20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLWNocm9tZS1ib3R0b20iKTsKICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lV2hlZWwuY0JvdHRvbSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZvbHVtZVdoZWVsLmNCb3R0b20uY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QuYWRkKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh2b2x1bWVXaGVlbC5jQm90dG9tLnRpbWVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoIm1vdXNlbW92ZSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWVXaGVlbC5jQm90dG9tLnRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoaGlkZVZvbHVtZSwgNDAwMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGV2ZW50ICYmIChldmVudC5kZWx0YVkgfHwgZXZlbnQud2hlZWxEZWx0YVkpOwogICAgICAgICAgICAgICAgICAgIGFwaS5zZXRWb2x1bWUocGxheWVyLnZvbHVtZSAqIDEwMCAtIChNYXRoLnNpZ24oZGlyZWN0aW9uKSAqIDUpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50ICYmIHVzZXJfc2V0dGluZ3MuVklEX1ZPTF9XSEVFTCkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgdm9sdW1lV2hlZWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigid2hlZWwiLCB2b2x1bWVXaGVlbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZHJhZ1BvcE91dChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGV4Y2x1ZGVkLCBpc0ZTY3JlZW47CiAgICAgICAgICAgICAgICBleGNsdWRlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtY2hyb21lLWJvdHRvbSIpOwogICAgICAgICAgICAgICAgaXNGU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1mdWxsc2NyZWVuIik7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgIWlzRlNjcmVlbiAmJiAoIWV4Y2x1ZGVkIHx8IChldmVudC50YXJnZXQgIT09IGV4Y2x1ZGVkICYmICFleGNsdWRlZC5jb250YWlucyhldmVudC50YXJnZXQpKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gIm1vdXNlZG93biIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdQb3BPdXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnUG9wT3V0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRQb3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWDogZXZlbnQuY2xpZW50WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZOiBldmVudC5jbGllbnRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ1g6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWTogZXZlbnQuY2xpZW50WQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAibW91c2Vtb3ZlIiAmJiAod2luZG93Lmhhc01vdmVkIHx8IE1hdGguYWJzKGV2ZW50LmNsaWVudFggLSB3aW5kb3cub2xkUG9zLm9yZ1gpID4gMTAgfHwgTWF0aC5hYnMoZXZlbnQuY2xpZW50WSAtIHdpbmRvdy5vbGRQb3Mub3JnWSkgPiAxMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3ZlQnkoZXZlbnQuY2xpZW50WCAtIHdpbmRvdy5vbGRQb3MuWCwgZXZlbnQuY2xpZW50WSAtIHdpbmRvdy5vbGRQb3MuWSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaGFzTW92ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5idXR0b25zICE9PSAxIHx8IGV2ZW50LnR5cGUgPT09ICJjbGljayIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5oYXNNb3ZlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdpbmRvdy5vbGRQb3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgd2luZG93Lmhhc01vdmVkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdQb3BPdXQpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGRyYWdQb3BPdXQsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50ICYmIHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGRyYWdQb3BPdXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc3VtZVBsYXliYWNrKCkgewogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7CiAgICAgICAgICAgICAgICBpZiAodGVtcCAmJiAhaXNOYU4odGVtcC5kdXJhdGlvbikgJiYgdGVtcC5jdXJyZW50VGltZSA8IHRlbXAuZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcC5jdXJyZW50VGltZTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAidD0iICsgdGVtcDsKICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwb3BQbGF5ZXIodXJsKSB7CiAgICAgICAgICAgICAgICB2YXIgcG9wT3V0LCB3aWR0aCwgaGVpZ2h0LCBwb3BfdXJsLCB2aWRlbzsKICAgICAgICAgICAgICAgIHdpZHRoID0gcGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUFBPVF9TWikgfHwgNTMzOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5yb3VuZCh3aWR0aCAvICgxNiAvIDkpKTsKICAgICAgICAgICAgICAgIHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKTsKICAgICAgICAgICAgICAgIHBvcF91cmwgPSAoIXVybC50YXJnZXQgJiYgdXJsKSB8fCB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgvJnQ9WzAtOV0rfCN0PVswLTldK3wmdGltZT1bMC05XSsvKS5qb2luKCIiKTsKICAgICAgICAgICAgICAgIGlmICh1cmwudGFyZ2V0ICYmIHZpZGVvICYmIHZpZGVvLmN1cnJlbnRUaW1lICYmIHZpZGVvLmN1cnJlbnRUaW1lIDwgdmlkZW8uZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBwb3BfdXJsICs9ICIjdD0iICsgdmlkZW8uY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLnN0YXJ0ID0gdmlkZW8uY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgICAgICAgYXBpLmN1ZVZpZGVvQnlQbGF5ZXJWYXJzKHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3BPdXQgPSB3aW5kb3cub3Blbihwb3BfdXJsLCAicG9wT3V0IiwgIndpZHRoPSIgKyB3aWR0aCArICIsaGVpZ2h0PSIgKyBoZWlnaHQpOwogICAgICAgICAgICAgICAgaWYgKHVybC50YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBwb3BPdXQuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JldW5sb2FkIiwgcmVzdW1lUGxheWJhY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcG9wT3V0LmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0U3ViUGxheWxpc3QoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBsaXN0LCBidXR0b247CiAgICAgICAgICAgICAgICBsaXN0ID0gW107CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5pZCA9PT0gInN1YnNjcmlwdGlvbi1wbGF5bGlzdCIpIHsKICAgICAgICAgICAgICAgICAgICBpID0gc3ViUGxheWxpc3QudmlkZW9fbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2goc3ViUGxheWxpc3QudmlkZW9fbGlzdFtpXS5kYXRhc2V0LnZpZGVvSWRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsaXN0ID0gbGlzdC5yZXZlcnNlKCkuc3BsaWNlKDAsIDIwKS5qb2luKCIlMkMiKTsKICAgICAgICAgICAgICAgICAgICBzdWJQbGF5bGlzdC5saXN0X3RpdGxlID0gc3ViUGxheWxpc3QubGlzdF90aXRsZSAmJiBzdWJQbGF5bGlzdC5saXN0X3RpdGxlLnF1ZXJ5U2VsZWN0b3IoIi5lcGljLW5hdi1pdGVtLWhlYWRpbmciKS50ZXh0Q29udGVudC50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN1YnNjcmlwdGlvbi1wbGF5bGlzdCIpOwogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5ocmVmID0gIi93YXRjaF92aWRlb3M/dGl0bGU9IiArIHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUgKyAiJnZpZGVvX2lkcz0iICsgbGlzdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzdWJQbGF5bGlzdCgpIHsKICAgICAgICAgICAgICAgIHZhciBidXR0b24sIG5hdl9tZW51OwogICAgICAgICAgICAgICAgbmF2X21lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYXBwYmFyLW5hdi1tZW51Iik7CiAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3Vic2NyaXB0aW9uLXBsYXlsaXN0Iik7CiAgICAgICAgICAgICAgICBzdWJQbGF5bGlzdC5saXN0X3RpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmFwcGJhci1uYXYtbWVudSIpOwogICAgICAgICAgICAgICAgc3ViUGxheWxpc3QudmlkZW9fbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImFkZHRvLXdhdGNoLWxhdGVyLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX1NVQl9MSVNUICYmIG5hdl9tZW51ICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCIvZmVlZC9zdWJzY3JpcHRpb25zIikubGVuZ3RoID4gMSAmJiAhYnV0dG9uICYmIHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUgJiYgc3ViUGxheWxpc3QudmlkZW9fbGlzdCkgewogICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8bGkgaWQ9J3N1YnNjcmlwdGlvbi1wbGF5bGlzdC1pY29uJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGlkPSdzdWJzY3JpcHRpb24tcGxheWxpc3QnIGRhdGEtcD0ndHRsfFNVQl9QTFNUJyBjbGFzcz0neXQtdWl4LWJ1dHRvbiBzcGYtbGluayB5dC11aXgtc2Vzc2lvbmxpbmsgeXQtdWl4LWJ1dHRvbi1lcGljLW5hdi1pdGVtIHl0LXVpeC1idXR0b24tc2l6ZS1kZWZhdWx0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHZpZXdCb3g9JzAgMCAxNCAxNic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIHBvaW50cz0nMCwxNiAxNCw4IDAsMCAnLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9saT5gOwogICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IHNldExvY2FsZShidXR0b24uY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBuYXZfbWVudS5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgc2V0U3ViUGxheWxpc3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWRDb21tZW50cyhldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZSAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZS5pZCA9PT0gIlAtc2hvdy1jb21tZW50cyIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobW9kQ29tbWVudHMuY29tbWVudHMubGF6eWxvYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNwZi5sb2FkLmFwcGx5KG1haW4sIG1vZENvbW1lbnRzLmNvbW1lbnRzLmxhenlsb2FkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMuY29tbWVudHMuY2xhc3NMaXN0LnRvZ2dsZSgic2hvdyIpOwogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLndyYXBwZXIucXVlcnlTZWxlY3RvcigiYnV0dG9uIikudGV4dENvbnRlbnQgPSBsYW5nKChtb2RDb21tZW50cy5jb21tZW50cy5jbGFzc0xpc3QuY29udGFpbnMoInNob3ciKSAmJiAiSElERV9DTVRTIikgfHwgIlNIT1dfQ01UUyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2l6ZVBsYXllcihldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIHRlbXAsIGlzX3NtYWxsLCBjb250ZW50LCBtYXhfd2lkdGg7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLmluZGV4T2YoIi93YXRjaCIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGVtcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXItYXBpIik7CiAgICAgICAgICAgICAgICBpZiAoIXRlbXApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwogICAgICAgICAgICAgICAgaXNfc21hbGwgPSB3aW5kb3cuaW5uZXJXaWR0aCA8IDY1NyA/ICIiIDogIi53YXRjaC1zdGFnZS1tb2RlICI7CiAgICAgICAgICAgICAgICBpZiAoaXNfc21hbGwgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVRfV0RUSCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0ZJVF9XRFRILm1hdGNoKCIlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF93aWR0aCA9IHdpbmRvdy5wYXJzZUludCh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUX1dEVEgpIC8gMTAwICogdGVtcDsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF93aWR0aCA9IHdpbmRvdy5wYXJzZUludCh1c2VyX3NldHRpbmdzLlZJRF9QTFJfRklUX1dEVEgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG1heF93aWR0aCA9IHRlbXAgPj0gbWF4X3dpZHRoID8gbWF4X3dpZHRoIDogdGVtcDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBtYXhfd2lkdGggPSB0ZW1wID49IDEyODAgPyAxMjgwIDogdGVtcDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1heF93aWR0aCA9IHRlbXA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250ZW50ID0gLy8KICAgICAgICAgICAgICAgICAgICBgQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjU2cHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgI3BsYXllci1hcGksCiAgICAgICAgICAgICAgICAgICAgICAgICNwbGF5ZXItdW5hdmFpbGFibGUgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiA1MXB4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMTBweCAjMDAwOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICN0aGVhdGVyLWJhY2tncm91bmQgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAke2lzX3NtYWxsfS5wbGF5ZXItd2lkdGggewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogJHttYXhfd2lkdGh9cHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogJHttYXhfd2lkdGggLyAyICogLTF9cHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHtpc19zbWFsbH0ucGxheWVyLWhlaWdodDpub3QoLndhdGNoLXBsYXlsaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogJHttYXhfd2lkdGggLyAoMTYgLyA5KX1weCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAke2lzX3NtYWxsfSN3YXRjaC1hcHBiYXItcGxheWxpc3QgewogICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICR7bWF4X3dpZHRoIC8gKDE2IC8gOSkgLSAoaXNfc21hbGwgPT09ICIiID8gMCA6IDM2MCl9cHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgICAgICB9YDsKICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgieXRwLXJlc2l6ZXIiKTsKICAgICAgICAgICAgICAgIGlmICghdGVtcCkgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwogICAgICAgICAgICAgICAgICAgIHRlbXAuaWQgPSAieXRwLXJlc2l6ZXIiOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGVtcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wLnRleHRDb250ZW50ID0gY29udGVudDsKICAgICAgICAgICAgICAgIGlmICghZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RQbGF5ZXJTaXplKCkgewogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVQpIHsKICAgICAgICAgICAgICAgICAgICByZXNpemVQbGF5ZXIoKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgcmVzaXplUGxheWVyKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJzcGZkb25lIiwgcmVzaXplUGxheWVyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHJlc2l6ZVBsYXllcik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigic3BmZG9uZSIsIHJlc2l6ZVBsYXllcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQ29tbWVudHMoKSB7CiAgICAgICAgICAgICAgICB2YXIgaXNfbGl2ZSA9IHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MubGl2ZXN0cmVhbTsKICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLmNvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWRpc2N1c3Npb24iKTsKICAgICAgICAgICAgICAgIGlmICghaXNfbGl2ZSAmJiBtb2RDb21tZW50cy5jb21tZW50cyAmJiAhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtc2hvdy1jb21tZW50cyIpICYmIHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyA9PT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMud3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMud3JhcHBlci5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1zaG93LWNvbW1lbnRzJyBjbGFzcz0neXQtY2FyZCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSd5dC11aXgtYnV0dG9uIHl0LXVpeC1idXR0b24tZXhwYW5kZXInIGRhdGEtcD0ndG5kfFNIT1dfQ01UUyc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMud3JhcHBlciA9IHNldExvY2FsZShtb2RDb21tZW50cy53cmFwcGVyLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBsb2FkQ29tbWVudHMpOwogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLmNvbW1lbnRzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG1vZENvbW1lbnRzLndyYXBwZXIsIG1vZENvbW1lbnRzLmNvbW1lbnRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRDdXN0b21TdHlsZXMoY2xzcykgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdFt1c2VyX3NldHRpbmdzW2Nsc3NdID8gImFkZCIgOiAicmVtb3ZlIl0oY3VzdG9tU3R5bGVzLmN1c3RvbV9zdHlsZXNbY2xzc10pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGN1c3RvbVN0eWxlcygpIHsKICAgICAgICAgICAgICAgIHZhciBjaGlsZCwgcGFyZW50LCBwbHJfYXBpLCBjb21tZW50cywgc2lkZWJhciwgeXRHcmlkLCBhZHZlcnRzLCBhZHNfbGlzdDsKICAgICAgICAgICAgICAgIGNvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWRpc2N1c3Npb24iKTsKICAgICAgICAgICAgICAgIHl0R3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtbWVudS10b3AtbGV2ZWwtZmxvdy1idXR0b246bGFzdC1jaGlsZCBhIik7CiAgICAgICAgICAgICAgICBjdXN0b21TdHlsZXMuY3VzdG9tX3N0eWxlcyA9IHsKICAgICAgICAgICAgICAgICAgICBHRU5fRFNCTF9BRFMgICAgOiAicGFydF9ub19hZHMiLAogICAgICAgICAgICAgICAgICAgIEdFTl9CTFVFX0dMT1cgICA6ICJwYXJ0X2RzYmxfZ2xvdyIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0hJREVfRlRSICAgIDogInBhcnRfaGlkZV9mb290ZXIiLAogICAgICAgICAgICAgICAgICAgIEdFTl9CVFRSX05URiAgICA6ICJwYXJ0X25vdGlmX2J1dHRvbiIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0dSSURfU1VCUyAgIDogInBhcnRfZ3JpZF9zdWJzIiwKICAgICAgICAgICAgICAgICAgICBHRU5fR1JJRF9TUkNIICAgOiAicGFydF9ncmlkX3NlYXJjaCIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0NNUFRfVFRMUyAgIDogInBhcnRfY29tcGFjdF90aXRsZXMiLAogICAgICAgICAgICAgICAgICAgIFZJRF9QTFJfQVRQTCAgICA6ICJwYXJ0X2F1dG9wbGF5b24iLAogICAgICAgICAgICAgICAgICAgIFZJRF9QTFJfRFlOX1NJWkU6ICJwYXJ0X3N0YXRpY19zaXplIiwKICAgICAgICAgICAgICAgICAgICBWSURfSElERV9ERVRMUyAgOiAicGFydF9oaWRlX2RldGFpbHMiLAogICAgICAgICAgICAgICAgICAgIFZJRF9UVExfQ01QVCAgICA6ICJwYXJ0X2NvbXBhY3RfdGl0bGUiLAogICAgICAgICAgICAgICAgICAgIFZJRF9ERVNDX1NIUlQgICA6ICJwYXJ0X2xhYmVsbGVzc19idXR0b25zIgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cueXQgJiYgd2luZG93Lnl0LmNvbmZpZ18gJiYgd2luZG93Lnl0LmNvbmZpZ18uUEFHRV9OQU1FID09PSAic2hhcmVkX2NvbnZlcnNhdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltyZWw9J3Nob3J0bGluayddIikuaHJlZjsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAod2luZG93Lm5hbWUgPT09ICJwb3BPdXQiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoInBhcnRfcG9wb3V0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoeXRHcmlkICYmIHVzZXJfc2V0dGluZ3MuR0VOX0dSSURfU1VCUykgewogICAgICAgICAgICAgICAgICAgIHl0R3JpZC5jbGljaygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwbHJfYXBpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllci1hcGkiKTsKICAgICAgICAgICAgICAgICAgICBzaWRlYmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmJyYW5kZWQtcGFnZS12Mi1zZWNvbmRhcnktY29sIik7CiAgICAgICAgICAgICAgICAgICAgYWRzX2xpc3QgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgI21hc3RoZWFkX2NoaWxkLAogICAgICAgICAgICAgICAgICAgICAgICAjZmVlZC1weXYtY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAjd2F0Y2g3LXNpZGViYXItYWRzLAogICAgICAgICAgICAgICAgICAgICAgICAjd2F0Y2g3LXNpZGViYXItb2ZmZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIC5hZC1kaXYsCiAgICAgICAgICAgICAgICAgICAgICAgIC5weXYtYWZjLWFkcy1jb250YWluZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIC52aWRlby1saXN0LWl0ZW06bm90KC5yZWxhdGVkLWxpc3QtaXRlbSk6bm90KC5kYXNoYm9hcmQtd2lkZ2V0LWl0ZW0pYDsKICAgICAgICAgICAgICAgICAgICBhZHZlcnRzID0gdXNlcl9zZXR0aW5ncy5HRU5fRFNCTF9BRFMgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhZHNfbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGFkdmVydHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBhZHZlcnRzOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGNoaWxkLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmNoaWxkRWxlbWVudENvdW50ID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBwYXJlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2ZXJ0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYWRzX2xpc3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc2lkZWJhciAmJiBzaWRlYmFyLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvcmVzdWx0cyIgJiYgc2lkZWJhciAmJiBzaWRlYmFyLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKS5sZW5ndGggPCAxMCkgfHwgKHNpZGViYXIgJiYgKCh1c2VyX3NldHRpbmdzLkdFTl9IREVfUkVDTV9TREJSICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCIvZmVlZC9zdWJzY3JpcHRpb25zIikubGVuZ3RoID4gMSkgfHwgKHVzZXJfc2V0dGluZ3MuR0VOX0hERV9TUkNIX1NEQlIgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3Jlc3VsdHMiKSB8fCAodXNlcl9zZXR0aW5ncy5HRU5fSERFX0NITl9TREJSICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KC9cLyhjaGFubmVsfHVzZXJ8YylcLy8pLmxlbmd0aCA+IDEpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGViYXIub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgdXNlcl9zZXR0aW5ncy5WSURfSElERV9DT01TID4gMSAmJiBjb21tZW50cykgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyA9PT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJwYXJ0X2hpZGVfY29tbWVudHMiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyAhPT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJwYXJ0X2hpZGVfY29tbWVudHMiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kUGxheWVyU2l6ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhjdXN0b21TdHlsZXMuY3VzdG9tX3N0eWxlcykuZm9yRWFjaChzZXRDdXN0b21TdHlsZXMpOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgiL2ZlZWQvc3Vic2NyaXB0aW9ucyIpLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoInBhcnRfZ3JpZF9zdWJzIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRlZmF1bHRDaGFubmVsUGFnZShldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fQ0hOX0RGTFRfUEFHRSAhPT0gImRlZmF1bHQiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnRhcmdldCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlID0gZXZlbnQudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LnRhZ05hbWUgIT09ICJBIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnROb2RlICYmIHBhcmVudE5vZGUudGFnTmFtZSA9PT0gIkEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50Tm9kZSAmJiBwYXJlbnROb2RlLmhyZWYgJiYgcGFyZW50Tm9kZS5ocmVmLnNwbGl0KHVzZXJfc2V0dGluZ3MuR0VOX0NITl9ERkxUX1BBR0UpLmxlbmd0aCA8IDIgJiYgKHBhcmVudE5vZGUuaHJlZi5zcGxpdCgiL2NoYW5uZWwvIikubGVuZ3RoID4gMSB8fCBwYXJlbnROb2RlLmhyZWYuc3BsaXQoIi91c2VyLyIpLmxlbmd0aCA+IDEpICYmIHBhcmVudE5vZGUuaHJlZi5zcGxpdCgvW2EtejAtOV1cL1thLXowLTldL2kpLmxlbmd0aCA8IDQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUuaHJlZiArPSAiLyIgKyB1c2VyX3NldHRpbmdzLkdFTl9DSE5fREZMVF9QQUdFOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIGRlZmF1bHRDaGFubmVsUGFnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZEFyZ3MoY29uZmlnKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgdGVtcCwgbGlzdCwgbGVuZ3RoLCB2aWRlb3MsIG5ld19saXN0LCBjYW5fc2hhcmU7CiAgICAgICAgICAgICAgICBpZiAod2luZG93Lm5hbWUgPT09ICJwb3BPdXQiKSB7CiAgICAgICAgICAgICAgICAgICAgY2FuX3NoYXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnBsYXlsaXN0LWhlYWRlci1jb250ZW50Iik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbl9zaGFyZSAmJiBjYW5fc2hhcmUuZGF0YXNldC5zaGFyZWFibGUgPT09ICJGYWxzZSIgJiYgIWNvbmZpZy5hcmdzLnZpZGVvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLnZpZGVvID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImxpW2RhdGEtdmlkZW8taWRdIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IHZpZGVvcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MudmlkZW9baV0gPSB7ImVuY3J5cHRlZF9pZCI6IHZpZGVvc1tpXS5nZXRBdHRyaWJ1dGUoImRhdGEtdmlkZW8taWQiKX07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBjb25maWcuYXJncy50aXRsZTsKICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5lbCA9ICJlbWJlZGRlZCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmFyZ3MudnEpIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy52cSA9IHVzZXJfc2V0dGluZ3MuVklEX0RGTFRfUUxUWTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFkgIT09ICJhdXRvIikgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2VbInl0LXBsYXllci1xdWFsaXR5Il0gPSBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGF0YSI6IHVzZXJfc2V0dGluZ3MuVklEX0RGTFRfUUxUWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJleHBpcmF0aW9uIjogbmV3IERhdGUoKS5nZXRUaW1lKCkgKyA4NjRFNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjcmVhdGlvbiI6IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGlnbm9yZSkge30KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy5jYXB0aW9uX2F1ZGlvX3RyYWNrcyAmJiB1c2VyX3NldHRpbmdzLlZJRF9QTFJfQ0MpIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5jYXB0aW9uX2F1ZGlvX3RyYWNrcyA9IGNvbmZpZy5hcmdzLmNhcHRpb25fYXVkaW9fdHJhY2tzLnNwbGl0KC8mZD1bMC05XXxkPVswLTldJi8pLmpvaW4oIiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9WT0xfTEROKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5hcmdzLmxvdWRuZXNzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9IVE1MNSkgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5odG1sNSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0lORk8pIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5zaG93aW5mbyA9ICIxIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh3aW5kb3cub3BlbmVyICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmF1dG9wbGF5ID0gIjEiOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwpIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5hdXRvcGxheSA9ICIwIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy5mZmxhZ3MpIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5mZmxhZ3MgPSBjb25maWcuYXJncy5mZmxhZ3MucmVwbGFjZSgibGVnYWN5X2F1dG9wbGF5X2ZsYWc9dHJ1ZSIsICJsZWdhY3lfYXV0b3BsYXlfZmxhZz1mYWxzZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9TSVpFX01FTSkgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLnBsYXllcl93aWRlID0gKHVzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgJiYgIjEiKSB8fCAiMCI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy55dHBzZXR3aWRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBzZXR3aWRlKCJ3aWRlIiwgY29uZmlnLmFyZ3MucGxheWVyX3dpZGUsIC0xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmFyZ3MuaXZfbG9hZF9wb2xpY3kgJiYgdXNlcl9zZXR0aW5ncy5WSURfUExSX0FOVFMpIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5pdl9sb2FkX3BvbGljeSA9ICIzIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQURTICYmICghdXNlcl9zZXR0aW5ncy5WSURfU1VCX0FEUyB8fCAodXNlcl9zZXR0aW5ncy5WSURfU1VCX0FEUyAmJiAhY29uZmlnLmFyZ3Muc3Vic2NyaWJlZCkpKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5hcmdzLmFkM19tb2R1bGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmFyZ3MuYWRhcHRpdmVfZm10cyAmJiB1c2VyX3NldHRpbmdzLlZJRF9QTFJfSEZSKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3X2xpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICBsaXN0ID0gY29uZmlnLmFyZ3MuYWRhcHRpdmVfZm10cy5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgICAgIGkgPSBsaXN0Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBsaXN0W2ldLnNwbGl0KC9mcHNcPShbMC05XXsyfSkvKVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZW1wIHx8IHRlbXAgPCAzMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2xpc3QucHVzaChsaXN0W2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzID0gbmV3X2xpc3Quam9pbigiLCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RNYXRjaE1lZGlhKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGV4dCA9PT0gInNjcmVlbiBhbmQgKG1heC13aWR0aDogNjU2cHgpIiAmJiB0ZW1wLm1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRlbXA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0ZW1wLCAibWF0Y2hlcyIsIHt3cml0YWJsZTogdHJ1ZX0pOwogICAgICAgICAgICAgICAgICAgIHRlbXAubWF0Y2hlcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZW5lcmFsQ2hhbmdlcygpIHsKICAgICAgICAgICAgICAgIHZhciBsb2dvLCBjaGVja2JveCwgYXV0b3BsYXliYXIsIGRlc2NyaXB0aW9uOwogICAgICAgICAgICAgICAgYXV0b3BsYXliYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYXV0b3BsYXktYmFyIik7CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhY3Rpb24tcGFuZWwtZGV0YWlscyIpOwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX1lUX0xPR09fTElOSyAmJiB3aW5kb3cueXQgJiYgd2luZG93Lnl0LmNvbmZpZ18gJiYgd2luZG93Lnl0LmNvbmZpZ18uTE9HR0VEX0lOKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIm1hcFtuYW1lPSdkb29kbGUnXSA+IGFyZWEsIGEjbG9nby1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nbyAmJiBsb2dvLmhyZWYgPT09IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyAiLyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nby5ocmVmID0gIi9mZWVkL3N1YnNjcmlwdGlvbnMiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9SRU1fQVBVTiAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvd2F0Y2giICYmIGF1dG9wbGF5YmFyKSB7CiAgICAgICAgICAgICAgICAgICAgY2hlY2tib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY2hlY2tib3gtb24tb2ZmIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrYm94KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrYm94Lm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9MQVlUX0FVVE9fUE5MICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgZGVzY3JpcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCJ5dC11aXgtZXhwYW5kZXItY29sbGFwc2VkIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fU1BGX09GRiAmJiB3aW5kb3cuc3BmICYmIHdpbmRvdy5zcGYuZGlzcG9zZSkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zcGYuZGlzcG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGxvY2FsWEhSKG1ldGhvZCwgY2FsbCwgdXJsLCBoZWFkKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgY2FsbCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9wZW4obWV0aG9kLCB1cmwsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGhlYWQgJiYgaGVhZCAhPT0gImRvYyIpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoaGVhZFswXSwgaGVhZFsxXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gImRvY3VtZW50IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlcXVlc3Quc2VuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBsYXllck1vZGUoKSB7CiAgICAgICAgICAgICAgICB2YXIgcGFnZUVsZW1lbnQsIHBsYXllckVsZW1lbnQ7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1NJWkVfTUVNKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFnZSIpOwogICAgICAgICAgICAgICAgICAgIHBsYXllckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVyIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy55dHBzZXR3aWRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBzZXR3aWRlKCJ3aWRlIiwgKHVzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyAiMSIgOiAiMCIpLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJFbGVtZW50ICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUVsZW1lbnQuY2xhc3NMaXN0W3VzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyAiYWRkIiA6ICJyZW1vdmUiXSgid2F0Y2gtd2lkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwYWdlRWxlbWVudC5jbGFzc05hbWUgPSBwYWdlRWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSh1c2VyX3NldHRpbmdzLnRoZWF0ZXJNb2RlID8gIm5vbi0iIDogIndhdGNoLXN0YWdlIiwgdXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSA/ICIiIDogIndhdGNoLW5vbi1zdGFnZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJFbGVtZW50LmNsYXNzTmFtZSA9IHVzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyBwbGF5ZXJFbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKCJzbWFsbCIsICJsYXJnZSIpIDogcGxheWVyRWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgibGFyZ2UiLCAic21hbGwiKS5yZXBsYWNlKCJtZWRpdW0iLCAic21hbGwiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaW5maW5pdGVTY3JvbGwoKSB7CiAgICAgICAgICAgICAgICB2YXIgb2JzZXJ2ZXIsIGxvYWRNb3JlOwogICAgICAgICAgICAgICAgbG9hZE1vcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubG9hZC1tb3JlLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgaWYgKGxvYWRNb3JlICYmIHVzZXJfc2V0dGluZ3MuR0VOX0lORl9TQ1JMKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFsb2FkTW9yZS5jbGFzc0xpc3QuY29udGFpbnMoImluZmluaXRlU2Nyb2xsIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZE1vcmUuY2xhc3NMaXN0LmFkZCgiaW5maW5pdGVTY3JvbGwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihpbmZpbml0ZVNjcm9sbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUobG9hZE1vcmUsIHthdHRyaWJ1dGVzOiB0cnVlfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghbG9hZE1vcmUuY2xhc3NMaXN0LmNvbnRhaW5zKCJzY3JvbGxkZXRlY3QiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkTW9yZS5jbGFzc0xpc3QuYWRkKCJzY3JvbGxkZXRlY3QiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZE1vcmUuZGF0YXNldC5zY3JvbGxkZXRlY3RDYWxsYmFjayA9ICJsb2FkLW1vcmUtYXV0byI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrTmV3RmVhdHVyZXMoKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwga2V5czsKICAgICAgICAgICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhkZWZhdWx0X3NldHRpbmdzKTsKICAgICAgICAgICAgICAgIGkgPSBrZXlzLmxlbmd0aDsKICAgICAgICAgICAgICAgIHdoaWxlIChpKSB7CiAgICAgICAgICAgICAgICAgICAgaSAtPSAxOwogICAgICAgICAgICAgICAgICAgIGlmICghdXNlcl9zZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eShrZXlzW2ldKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzZXQoa2V5c1tpXSwgZGVmYXVsdF9zZXR0aW5nc1trZXlzW2ldXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNoYXJlQXBpKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHBsYXllclJlYWR5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmVxdWVzdChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHZpZGVvX3BsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICBpZiAodmlkZW9fcGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgdmlkZW9fcGxheWVyLnJlbW92ZUF0dHJpYnV0ZSgic3R5bGUiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuVklEX1BMUl9BVFBMIHx8ICFldmVudC5kZXRhaWwudXJsLmluZGV4T2YoIi93YXRjaCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmxvYWRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdpbmRvdy55dHBsYXllci5jb25maWcubG9hZGVkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHBhZ2VTY3JpcHRNZXNzYWdlcygpIHsKICAgICAgICAgICAgICAgIHZhciBrZXksIGdhdGUsIHNldHMsIG9ic2VydmVyOwogICAgICAgICAgICAgICAga2V5ID0gInBhcnJlY2VpdmUiOwogICAgICAgICAgICAgICAgZ2F0ZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgICAgIHNldHMgPSBKU09OLnBhcnNlKGdhdGUuZGF0YXNldFtrZXldIHx8IG51bGwpOwogICAgICAgICAgICAgICAgaWYgKCFnYXRlLnBhZ2VzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBnYXRlLnBhZ2VzY3JpcHQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIocGFnZVNjcmlwdE1lc3NhZ2VzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIub2JzZXJ2ZShnYXRlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6dHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtIiArIGtleV0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZXRzKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IHNldHM7CiAgICAgICAgICAgICAgICAgICAgZ2F0ZS5kYXRhc2V0W2tleV0gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGN1c3RvbVN0eWxlcygpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtcGFycmVjZWl2ZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldChzZXR0aW5nLCBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nICE9PSAidXNlcl9zZXR0aW5ncyIpIHsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzW3NldHRpbmddID0gbmV3X3ZhbHVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzID0gbmV3X3ZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQucGFyc2VuZCA9IEpTT04uc3RyaW5naWZ5KHVzZXJfc2V0dGluZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1haW4oKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNNYXRlcmlhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGFnZVNjcmlwdE1lc3NhZ2VzKCk7CiAgICAgICAgICAgICAgICBjdXN0b21TdHlsZXMoKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudSgpOwogICAgICAgICAgICAgICAgaW5maW5pdGVTY3JvbGwoKTsKICAgICAgICAgICAgICAgIHBsYXlsaXN0Q29udHJvbHMoKTsKICAgICAgICAgICAgICAgIHBsYXllck1vZGUoKTsKICAgICAgICAgICAgICAgIG1vZFBsYXllclNpemUoKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucygpOwogICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwoKTsKICAgICAgICAgICAgICAgIHN1YlBsYXlsaXN0KCk7CiAgICAgICAgICAgICAgICBhbHdheXNWaXNpYmxlKCk7CiAgICAgICAgICAgICAgICBtb2RUaHVtYnMoKTsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscygpOwogICAgICAgICAgICAgICAgbW9kQ29tbWVudHMoKTsKICAgICAgICAgICAgICAgIGRlZmF1bHRDaGFubmVsUGFnZSgpOwogICAgICAgICAgICAgICAgZ2VuZXJhbENoYW5nZXMoKTsKICAgICAgICAgICAgICAgIGRyYWdQb3BPdXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBpc01hdGVyaWFsKCkgewogICAgICAgICAgICAgICAgdmFyIGksIHRlbXA7CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigieXRkLWFwcCIpOwogICAgICAgICAgICAgICAgaWYgKHRlbXAgJiYgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtYXRlcmlhbC1ub3RpY2UiKSkgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J21hdGVyaWFsLW5vdGljZScgc3R5bGU9J2JvcmRlci1yYWRpdXM6MnB4O2NvbG9yOiNGRkY7cGFkZGluZzoxMHB4O2JhY2tncm91bmQtY29sb3I6IzA5Rjtib3gtc2hhZG93OjAgMCAzcHggcmdiYSgwLDAsMCwuNSk7Zm9udC1zaXplOjEycHg7cG9zaXRpb246Zml4ZWQ7Ym90dG9tOjIwcHg7cmlnaHQ6MjBweDt6LWluZGV4Ojk5OTk5Jz4KICAgICAgICAgICAgICAgICAgICAgICAgWW91VHViZSBQbHVzIGlzIG5vdCB5ZXQgY29tcGF0aWJsZSB3aXRoIHRoZSBZb3VUdWJlIGJldGEgTWF0ZXJpYWwgTGF5b3V0PGJyPgogICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvUmVzdG9yZS1jbGFzc2ljLVlvdVR1YmUnIHRhcmdldD0nX2JsYW5rJyBzdHlsZT0nY29sb3I6I0ZGRjtmb250LXdlaWdodDpib2xkOyc+Q2xpY2sgaGVyZTwvYT4gZm9yIGluc3RydWN0aW9ucyB0byByZXN0b3JlIGNsYXNzaWMgWW91VHViZSBhbmQgY29udGludWUgdXNpbmcgWVQrPGJyPgogICAgICAgICAgICAgICAgICAgICAgICBUbyBrZWVwIHVzaW5nIHRoZSBjdXJyZW50IGxheW91dCB3aXRob3V0IHRoaXMgbWVzc2FnZSBwbGVhc2UgZGlzYWJsZSBZVCsKICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodGVtcC5jb250ZW50LmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtdXNlcl9zZXR0aW5ncyIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlTWlncmF0aW9uSW5zdHJ1Y3Rpb25zKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5pZCA9PT0gImNsb3NlX21pZ3JhdGlvbl9pbnN0cnVjdGlvbnMiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBjbG9zZU1pZ3JhdGlvbkluc3RydWN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJtaWdyYXRpb25faW5zdHJ1Y3Rpb25zIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbWlncmF0aW9uSW5zdHJ1Y3Rpb25zKCkgewogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgIGA8ZGl2IHN0eWxlPSdib3JkZXItcmFkaXVzOiAycHg7IGNvbG9yOiAjRkZGOyBmb250OiAxMnB4IFJvYm90byxhcmlhbCxzYW5zLXNlcmlmOyBwYWRkaW5nOiAxMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMCwgMTUzLCAyNTUpOyBib3gtc2hhZG93OiAwcHggMHB4IDNweCByZ2JhKDAsIDAsIDAsIDAuNSk7IHBvc2l0aW9uOiBmaXhlZDsgei1pbmRleDogOTk5OTk7IHRvcDogNTAlOyBsZWZ0OiA1MCU7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOyc+CiAgICAgICAgICAgICAgICAgICAgWW91VHViZSBQbHVzIGhhcyBiZWVuIHVwZGF0ZWQgYW5kIGlzIG5vdyBhIFdlYmV4dGVuc2lvbi4gVW5mb3J0dW5hdGVseSB0aGlzIG1lYW5zIHRoYXQgeW91ciBwcmV2aW91cyBzZXR0aW5ncyBuZWVkIHRvIGJlIGltcG9ydGVkIG1hbnVhbGx5Ljxicj4KICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvUmVzdG9yZS1zZXR0aW5ncycgdGFyZ2V0PSdfYmxhbmsnIHN0eWxlPSdjb2xvcjojRkZGO2ZvbnQtd2VpZ2h0OmJvbGQ7Jz5DbGljayBoZXJlPC9hPiBpZiB5b3Ugd2lzaCB0byBpbXBvcnQgdGhlIHByZXZpb3VzIHNldHRpbmdzIG9yIGtub3cgbW9yZSBhYm91dCB0aGlzIGNoYW5nZS48YnI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nY2xvc2VfbWlncmF0aW9uX2luc3RydWN0aW9ucycgc3R5bGU9J2JhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKTsgY29sb3I6ICNGRkY7IGN1cnNvcjogcG9pbnRlcjsgbWFyZ2luLXRvcDogMTBweDsgYm9yZGVyLXJhZGl1czogMnB4OyBwYWRkaW5nOiA0cHg7IGZsb2F0OiByaWdodDsnPkNMT1NFPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0ZW1wLmNvbnRlbnQuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGNsb3NlTWlncmF0aW9uSW5zdHJ1Y3Rpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYXBpLCBjaWQsIGV2ZW50cywgbGFuZ3VhZ2UsIHVzZXJfc2V0dGluZ3MsIHBsYXllcl9pbnN0YW5jZSwgZGVmYXVsdF9zZXR0aW5nczsKICAgICAgICAgICAgaWYgKGlzTWF0ZXJpYWwoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNpZCA9IHt9OwogICAgICAgICAgICBldmVudHMgPSB7fTsKICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IEpTT04ucGFyc2UoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQudXNlcl9zZXR0aW5ncyB8fCBudWxsKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnVzZXJfc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtdXNlcl9zZXR0aW5ncyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlZmF1bHRfc2V0dGluZ3MgPSB7CiAgICAgICAgICAgICAgICBHRU5fQlRUUl9OVEYgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgR0VOX1NVQl9MSVNUICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEdFTl9JTkZfU0NSTCAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBHRU5fQkxVRV9HTE9XICAgOiB0cnVlLAogICAgICAgICAgICAgICAgR0VOX1BQT1RfT04gICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9FTkRfU0hSRSAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZICAgOiAiYXV0byIsCiAgICAgICAgICAgICAgICBWSURfUExTVF9BVFBMICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BMU1RfUlZSUyAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQVRQTCAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMVklTICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BMUl9TSVpFX01FTTogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFJfVk9MX0xETiA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUE9TVF9USU1FICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1ZJRF9DTlQgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9ERVNDX1NIUlQgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUFBPVF9TWiAgICAgOiA1MzMsCiAgICAgICAgICAgICAgICBWSURfUExSX0hUTUw1ICAgOiB0cnVlLAogICAgICAgICAgICAgICAgQkxLX09OICAgICAgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZsb2F0ZXJYICAgICAgICA6IDIwMDAsCiAgICAgICAgICAgICAgICBmbG9hdGVyWSAgICAgICAgOiAyMDAwLAogICAgICAgICAgICAgICAgZmlyc3RUaW1lICAgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIHZvbExldiAgICAgICAgICA6IDUwLAogICAgICAgICAgICAgICAgYWR2T3B0cyAgICAgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIGJsYWNrbGlzdCAgICAgICA6IHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxhbmd1YWdlID0gewogICAgICAgICAgICAgICAgWVRTRVRTICAgICAgICAgICAgICAgIDogIllvdVR1YmUrIHNldHRpbmdzIiwKICAgICAgICAgICAgICAgIEFEVl9PUFRTICAgICAgICAgICAgICA6ICJBZHZhbmNlZCBvcHRpb25zIiwKICAgICAgICAgICAgICAgIFNVQl9QTFNUICAgICAgICAgICAgICA6ICJQbGF5IHJlY2VudCB1cGxvYWRzIiwKICAgICAgICAgICAgICAgIFBQT1RfT1BFTiAgICAgICAgICAgICA6ICJPcGVuIGluIHBvcC1vdXQiLAogICAgICAgICAgICAgICAgQkxDS19BREQgICAgICAgICAgICAgIDogIkFkZCB0byBibGFja2xpc3QiLAogICAgICAgICAgICAgICAgQkxDS19FRElUICAgICAgICAgICAgIDogIkVkaXQiLAogICAgICAgICAgICAgICAgQkxDS19TQVZFICAgICAgICAgICAgIDogIlNhdmUiLAogICAgICAgICAgICAgICAgQkxDS19DTFNFICAgICAgICAgICAgIDogIkNsb3NlIiwKICAgICAgICAgICAgICAgIENOU0xfQVAgICAgICAgICAgICAgICA6ICJBdXRvcGxheSIsCiAgICAgICAgICAgICAgICBDTlNMX1JQVCAgICAgICAgICAgICAgOiAiUmVwZWF0IHZpZGVvIiwKICAgICAgICAgICAgICAgIENOU0xfU1ZUSCAgICAgICAgICAgICA6ICJPcGVuIHRodW1ibmFpbCIsCiAgICAgICAgICAgICAgICBDTlNMX1NTICAgICAgICAgICAgICAgOiAiVGFrZSBzY3JlZW5zaG90IiwKICAgICAgICAgICAgICAgIENOU0xfU1NfQ0xTICAgICAgICAgICA6ICJDTE9TRSIsCiAgICAgICAgICAgICAgICBDTlNMX1BQT1QgICAgICAgICAgICAgOiAiUG9wLW91dCB2aWRlbyIsCiAgICAgICAgICAgICAgICBDTlNMX0ZMQlIgICAgICAgICAgICAgOiAiRnVsbGJyb3dzZXIgbW9kZSIsCiAgICAgICAgICAgICAgICBDTlNMX0NJTk1fTUQgICAgICAgICAgOiAiQ2luZW1hIG1vZGUiLAogICAgICAgICAgICAgICAgQ05TTF9ZVFNDICAgICAgICAgICAgIDogIllvdVR1YmUgc2hvcnRjdXRzIGxpc3QiLAogICAgICAgICAgICAgICAgUExTVF9BUCAgICAgICAgICAgICAgIDogIkF1dG9wbGF5IiwKICAgICAgICAgICAgICAgIFBMU1RfUlZSUyAgICAgICAgICAgICA6ICJSZXZlcnNlIiwKICAgICAgICAgICAgICAgIFNIT1dfQ01UUyAgICAgICAgICAgICA6ICJTaG93IGNvbW1lbnRzIiwKICAgICAgICAgICAgICAgIEhJREVfQ01UUyAgICAgICAgICAgICA6ICJIaWRlIGNvbW1lbnRzIiwKICAgICAgICAgICAgICAgIEdMQl9JTVBSICAgICAgICAgICAgICA6ICJJbXBvcnQvZXhwb3J0IHNldHRpbmdzIiwKICAgICAgICAgICAgICAgIEdMQl9MT0NMX0xBTkcgICAgICAgICA6ICJDbGljayB0byBlZGl0IFlUKyBsYW5ndWFnZSIsCiAgICAgICAgICAgICAgICBHTEJfTE9DTF9MQU5HX0NTVE0gICAgOiAiTG9jYWwiLAogICAgICAgICAgICAgICAgR0xCX0lNUFJfU0FWRSAgICAgICAgIDogIlNhdmUgYW5kIGxvYWQiLAogICAgICAgICAgICAgICAgR0xCX1JTRVQgICAgICAgICAgICAgIDogIlJlc2V0IiwKICAgICAgICAgICAgICAgIEdMQl9SU0VUX0NPTkYgICAgICAgICA6ICJUaGlzIHdpbGwgcmVzZXQgWVQrIHNldHRpbmdzIGFuZCB0aGUgYmxhY2tsaXN0IHdpbGwgYmUgZXJhc2VkLiBEbyB5b3Ugd2FudCB0byBjb250aW51ZT8iLAogICAgICAgICAgICAgICAgR0xCX1NWRSAgICAgICAgICAgICAgIDogIlNhdmUiLAogICAgICAgICAgICAgICAgR0xCX1NWRV9TRVRTICAgICAgICAgIDogIlNldHRpbmdzIHNhdmVkIiwKICAgICAgICAgICAgICAgIEdMQl9STUJMICAgICAgICAgICAgICA6ICJSZW1vdmUgZnJvbSBibGFja2xpc3QiLAogICAgICAgICAgICAgICAgRlRSX0RFU0MgICAgICAgICAgICAgIDogIkZpbmQgb3V0IHdoYXQgdGhpcyBkb2VzIiwKICAgICAgICAgICAgICAgIEdFTiAgICAgICAgICAgICAgICAgICA6ICJHZW5lcmFsIiwKICAgICAgICAgICAgICAgIFZJRCAgICAgICAgICAgICAgICAgICA6ICJWaWRlbyIsCiAgICAgICAgICAgICAgICBDSE4gICAgICAgICAgICAgICAgICAgOiAiQ2hhbm5lbHMiLAogICAgICAgICAgICAgICAgQkxLICAgICAgICAgICAgICAgICAgIDogIkJsYWNrbGlzdCIsCiAgICAgICAgICAgICAgICBBQlQgICAgICAgICAgICAgICAgICAgOiAiQWJvdXQiLAogICAgICAgICAgICAgICAgSExQICAgICAgICAgICAgICAgICAgIDogIkhlbHAiLAogICAgICAgICAgICAgICAgRE5UICAgICAgICAgICAgICAgICAgIDogIkRvbmF0ZSIsCiAgICAgICAgICAgICAgICBHRU5fVFRMICAgICAgICAgICAgICAgOiAiR2VuZXJhbCBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBHRU5fR0VOICAgICAgICAgICAgICAgOiAiR2VuZXJhbCIsCiAgICAgICAgICAgICAgICBHRU5fTFlUICAgICAgICAgICAgICAgOiAiTGF5b3V0IiwKICAgICAgICAgICAgICAgIEdFTl9MT0NMX0xBTkcgICAgICAgICA6ICJVc2UgbW9kaWZpZWQgWVQrIGxhbmd1YWdlIiwKICAgICAgICAgICAgICAgIEdFTl9QUE9UX09OICAgICAgICAgICA6ICJFbmFibGUgcG9wLW91dCBtb2RlIiwKICAgICAgICAgICAgICAgIEdFTl9EU0JMX0FEUyAgICAgICAgICA6ICJEaXNhYmxlIGFkdmVydGlzZW1lbnRzIG91dHNpZGUgdGhlIHZpZGVvIHBhZ2UiLAogICAgICAgICAgICAgICAgR0VOX0lORl9TQ1JMICAgICAgICAgIDogIkVuYWJsZSBpbmZpbml0ZSBzY3JvbGwgaW4gZmVlZHMiLAogICAgICAgICAgICAgICAgR0VOX1lUX0xPR09fTElOSyAgICAgIDogIllvdVR1YmUgbG9nbyByZWRpcmVjdHMgdG8gc3Vic2NyaXB0aW9ucyIsCiAgICAgICAgICAgICAgICBHRU5fU1VCX0xJU1QgICAgICAgICAgOiAiRW5hYmxlIHN1YnNjcmlwdGlvbiBwbGF5bGlzdCIsCiAgICAgICAgICAgICAgICBHRU5fUkVNX0FQVU4gICAgICAgICAgOiAiUmVtb3ZlIGF1dG9wbGF5IHVwIG5leHQiLAogICAgICAgICAgICAgICAgR0VOX1NQRl9PRkYgICAgICAgICAgIDogIkRpc2FibGUgU1BGIiwKICAgICAgICAgICAgICAgIEdFTl9ISURFX0ZUUiAgICAgICAgICA6ICJIaWRlIGZvb3RlciIsCiAgICAgICAgICAgICAgICBHRU5fQkxVRV9HTE9XICAgICAgICAgOiAiUmVtb3ZlIGJsdWUgZ2xvdyBhcm91bmQgY2xpY2tlZCBidXR0b25zIiwKICAgICAgICAgICAgICAgIEdFTl9IREVfUkVDTV9TREJSICAgICA6ICJIaWRlIHJlY29tbWVuZGVkIGNoYW5uZWxzIHNpZGViYXIiLAogICAgICAgICAgICAgICAgR0VOX0hERV9TUkNIX1NEQlIgICAgIDogIkhpZGUgc2VhcmNoIHJlc3VsdHMgc2lkZWJhciIsCiAgICAgICAgICAgICAgICBHRU5fSERFX0NITl9TREJSICAgICAgOiAiSGlkZSBjaGFubmVsIHNpZGViYXIiLAogICAgICAgICAgICAgICAgR0VOX0NNUFRfVFRMUyAgICAgICAgIDogIkNvbXBhY3QgdGl0bGVzIGluIGZlZWRzIiwKICAgICAgICAgICAgICAgIEdFTl9EU0JfSFZSQyAgICAgICAgICA6ICJEaXNhYmxlIGhvdmVyY2FyZHMiLAogICAgICAgICAgICAgICAgR0VOX0JUVFJfTlRGICAgICAgICAgIDogIkltcHJvdmVkIGJsdWUgbm90aWZpY2F0aW9uIGJveCIsCiAgICAgICAgICAgICAgICBHRU5fR1JJRF9TVUJTICAgICAgICAgOiAiR3JpZCBsYXlvdXQgaW4gc3Vic2NyaXB0aW9ucyIsCiAgICAgICAgICAgICAgICBHRU5fR1JJRF9TUkNIICAgICAgICAgOiAiR3JpZCBsYXlvdXQgaW4gc2VhcmNoIHJlc3VsdHMiLAogICAgICAgICAgICAgICAgVklEX1RUTCAgICAgICAgICAgICAgIDogIlZpZGVvIHNldHRpbmdzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFIgICAgICAgICAgICAgICA6ICJQbGF5ZXIgc2V0dGluZ3MiLAogICAgICAgICAgICAgICAgVklEX1BMUl9MWVQgICAgICAgICAgIDogIlBsYXllciBsYXlvdXQiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWSAgICAgICAgIDogIkRlZmF1bHQgdmlkZW8gcXVhbGl0eToiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9BVVRPICAgIDogIkF1dG8iLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9UTlkgICAgIDogIjE0NHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9TTUwgICAgIDogIjI0MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9NRE0gICAgIDogIjM2MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9MUkcgICAgIDogIjQ4MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV83MjAgICAgIDogIjcyMHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV8xMDgwICAgIDogIjEwODBwIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfMTQ0MCAgICA6ICIxNDQwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzIxNjAgICAgOiAiMjE2MHAgKDRrKSIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzI4ODAgICAgOiAiMjg4MHAgKDVrKSIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX09SSUcgICAgOiAiNDMyMHAgKDhrKSIsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMVklTICAgICAgICAgOiAiUGxheWVyIGFsd2F5cyB2aXNpYmxlIHdoZW4gcmVhZGluZyBjb21tZW50cyIsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMVklTX1dEVEggICAgOiAiRmxvYXRpbmcgcGxheWVyIHdpZHRoIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVNfTU9WRSAgICA6ICJNb3ZlIHBsYXllciIsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMVklTX1NDUkxfVE9QOiAiR28gdG8gdG9wIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQVRQTCAgICAgICAgICA6ICJBdXRvcGxheSB2aWRlb3MiLAogICAgICAgICAgICAgICAgVklEX0xBWVQgICAgICAgICAgICAgIDogIkxheW91dCIsCiAgICAgICAgICAgICAgICBWSURfVklEX0NOVCAgICAgICAgICAgOiAiU2hvdyBsaW5rIHdpdGggbnVtYmVyIG9mIHVwbG9hZGVkIHZpZGVvcyIsCiAgICAgICAgICAgICAgICBWSURfUE9TVF9USU1FICAgICAgICAgOiAiU2hvdyBob3cgbG9uZyB0aGUgdmlkZW8gaGFzIGJlZW4gcHVibGlzaGVkIiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0RFVExTICAgICAgICA6ICJIaWRlIHZpZGVvIGRldGFpbHMiLAogICAgICAgICAgICAgICAgVklEX0hJREVfQ09NUyAgICAgICAgIDogIkNvbW1lbnQgc2VjdGlvbiIsCiAgICAgICAgICAgICAgICBWSURfSElERV9DT01TX1NIT1cgICAgOiAiU2hvdyIsCiAgICAgICAgICAgICAgICBWSURfSElERV9DT01TX0hJREUgICAgOiAiSGlkZSIsCiAgICAgICAgICAgICAgICBWSURfSElERV9DT01TX1JFTSAgICAgOiAiUmVtb3ZlIiwKICAgICAgICAgICAgICAgIFZJRF9FTkRfU0hSRSAgICAgICAgICA6ICJEaXNhYmxlIHNoYXJlIHBhbmVsIHdoZW4gdmlkZW8gZW5kcyIsCiAgICAgICAgICAgICAgICBWSURfUExTVCAgICAgICAgICAgICAgOiAiUGxheWxpc3RzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFNUX0FUUEwgICAgICAgICA6ICJFbmFibGUgcGxheWxpc3QgYXV0b3BsYXkgY29udHJvbCIsCiAgICAgICAgICAgICAgICBWSURfUExTVF9SVlJTICAgICAgICAgOiAiRW5hYmxlIHJldmVyc2UgcGxheWxpc3QgY29udHJvbCIsCiAgICAgICAgICAgICAgICBWSURfUExSX1NJWkVfTUVNICAgICAgOiAiTWVtb3JpemUgcGxheWVyIG1vZGUiLAogICAgICAgICAgICAgICAgVklEX1ZPTF9XSEVFTCAgICAgICAgIDogIkNoYW5nZSB2b2x1bWUgd2l0aCBtb3VzZSB3aGVlbCIsCiAgICAgICAgICAgICAgICBWSURfUExSX1ZPTF9NRU0gICAgICAgOiAiTWVtb3JpemUgYXVkaW8gdm9sdW1lIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfVk9MX0xETiAgICAgICA6ICJEaXNhYmxlIFlvdVR1YmUgbG91ZG5lc3Mgbm9ybWFsaXNhdGlvbiIsCiAgICAgICAgICAgICAgICBWSURfUExSX0FEUyAgICAgICAgICAgOiAiRGlzYWJsZSBhZHZlcnRpc2VtZW50cyBpbiB0aGUgdmlkZW8gcGFnZSIsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMQUNUICAgICAgICAgOiAiUGxheWVyIHNob3J0Y3V0cyBhbHdheXMgYWN0aXZlIiwKICAgICAgICAgICAgICAgIFZJRF9TVUJfQURTICAgICAgICAgICA6ICJFbmFibGUgYWR2ZXJ0aXNlbWVudHMgb25seSBpbiB2aWRlb3MgZnJvbSBzdWJzY3JpYmVkIGNoYW5uZWxzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQU5UUyAgICAgICAgICA6ICJEaXNhYmxlIGFubm90YXRpb25zIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfSEZSICAgICAgICAgICA6ICJEaXNhYmxlIEhGUiAoNjBmcHMpIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfSFRNTDUgICAgICAgICA6ICJVc2UgdGhlIEhUTUw1IHBsYXllciB3aGVuIHBvc3NpYmxlIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQ0MgICAgICAgICAgICA6ICJEaXNhYmxlIHN1YnRpdGxlcyBhbmQgQ0MiLAogICAgICAgICAgICAgICAgVklEX1BMUl9JTkZPICAgICAgICAgIDogIkVuYWJsZSBpbmZvIGJhciB3aXRoIHdhdGNoIGxhdGVyIGJ1dHRvbiIsCiAgICAgICAgICAgICAgICBWSURfUExSX0ZJVCAgICAgICAgICAgOiAiRml0IHRvIHBhZ2UgaW4gdGhlYXRlciBtb2RlIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfRklUX1dEVEggICAgICA6ICJGaXQgdG8gcGFnZSBtYXggd2lkdGg6IiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfRFlOX1NJWkUgICAgICA6ICJEaXNhYmxlIGR5bmFtaWMgcGxheWVyIHNpemUgaW4gZGVmYXVsdCB2aWV3IiwKICAgICAgICAgICAgICAgIFZJRF9ERVNDX1NIUlQgICAgICAgICA6ICJTaG9ydCB2aWRlbyBkZXNjcmlwdGlvbiBidXR0b25zIiwKICAgICAgICAgICAgICAgIFZJRF9UVExfQ01QVCAgICAgICAgICA6ICJDb21wYWN0IHRpdGxlIGluIHZpZGVvIGRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgIFZJRF9QUE9UX1NaICAgICAgICAgICA6ICJQb3Atb3V0IHBsYXllciBzaXplIiwKICAgICAgICAgICAgICAgIFZJRF9MQVlUX0FVVE9fUE5MICAgICA6ICJBdXRvIGV4cGFuZCB2aWRlbyBkZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRSAgICAgOiAiRGVmYXVsdCBjaGFubmVsIHBhZ2U6IiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFX0RGTFQ6ICJEZWZhdWx0IiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFX1ZJRCA6ICJWaWRlb3MiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfUEwgIDogIlBsYXlsaXN0cyIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9DSE4gOiAiQ2hhbm5lbHMiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfRElTQzogIkRpc2N1c3Npb24iLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfQUJUIDogIkFib3V0IiwKICAgICAgICAgICAgICAgIEJMS19UVEwgICAgICAgICAgICAgICA6ICJCbGFja2xpc3Qgc2V0dGluZ3MiLAogICAgICAgICAgICAgICAgQkxLX0JMSyAgICAgICAgICAgICAgIDogIkJsYWNrbGlzdCIsCiAgICAgICAgICAgICAgICBCTEtfT04gICAgICAgICAgICAgICAgOiAiRW5hYmxlIGJsYWNrbGlzdCIsCiAgICAgICAgICAgICAgICBBQlRfVFRMICAgICAgICAgICAgICAgOiAiSW5mb3JtYXRpb24gYW5kIHVzZWZ1bCBsaW5rcyIsCiAgICAgICAgICAgICAgICBBQlRfVEhLUyAgICAgICAgICAgICAgOiAiVGhhbmtzIHRvOiIsCiAgICAgICAgICAgICAgICBBQlRfVEhLU19ZRVBQSEEgICAgICAgOiAiLCB3aG8ncyB3b3JrIGluc3BpcmVkIHRoZSBjcmVhdGlvbiBvZiB0aGlzIHByb2plY3QsIHdpdGhvdXQgd2hvbSBub25lIG9mIHRoaXMgd291bGQgZXhpc3QgdG9kYXkuIiwKICAgICAgICAgICAgICAgIEFCVF9USEtTX1VTRVJTQ1JJUFQgICA6ICIgZm9yIG1ha2luZyB0aGUgdGFzayBvZiBkZXZlbG9waW5nIGFuZCBzaGlwcGluZyB0aGlyZCBwYXJ0eSBzb2Z0d2FyZSBpbmNyZWRpYmx5IGVhc2llci4iLAogICAgICAgICAgICAgICAgQUJUX1RIS1NfU1RBQ0tPViAgICAgIDogIiBmb3IgYWxsIG9mIGl0cyBwcmljZWxlc3MgaW5mb3JtYXRpb24gd2hpY2ggZ3JlYXRseSBjb250cmlidXRlcyBmb3Igc29mdHdhcmUgZGV2ZWxvcG1lbnQuIiwKICAgICAgICAgICAgICAgIEFCVF9JTkZPICAgICAgICAgICAgICA6ICJPZmZpY2lhbCBwYWdlcyIsCiAgICAgICAgICAgICAgICBBQlRfTE5LX0dIQiAgICAgICAgICAgOiAiR2l0SHViIiwKICAgICAgICAgICAgICAgIEFCVF9MTktfR1JGSyAgICAgICAgICA6ICJHcmVhc3kgRm9yayIsCiAgICAgICAgICAgICAgICBBQlRfTE5LX09QTlUgICAgICAgICAgOiAiT3BlblVzZXJKUyIsCiAgICAgICAgICAgICAgICBXTENNICAgICAgICAgICAgICAgICAgOiAiVGhhbmsgeW91IGZvciBpbnN0YWxsaW5nIFlvdVR1YmUrIiwKICAgICAgICAgICAgICAgIFdMQ01TVFJUICAgICAgICAgICAgICA6ICJZb3UgY2FuIGN1c3RvbWl6ZSB5b3VyIHNldHRpbmdzIGJ5IGNsaWNraW5nIHRoZSBidXR0b24gYWJvdmUiLAogICAgICAgICAgICAgICAgV0xDTUZUUlMgICAgICAgICAgICAgIDogIkNsaWNrIGhlcmUgdG8gc2VlIGFsbCB0aGUgZmVhdHVyZXMiLAogICAgICAgICAgICAgICAgTE9DQUxFICAgICAgICAgICAgICAgIDogIkVuZ2xpc2ggKFVTKSIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzIHx8IE9iamVjdC5rZXlzKHVzZXJfc2V0dGluZ3MpLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MgPSBkZWZhdWx0X3NldHRpbmdzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2hlY2tOZXdGZWF0dXJlcygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh3aW5kb3cuY2hyb21lKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIHNjcmlwdEV4aXQsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJzY3JpcHRleGVjdXRlIiwgc2NyaXB0RXhpdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFpc191c2Vyc2NyaXB0ICYmICF3aW5kb3cuY2hyb21lICYmICF1c2VyX3NldHRpbmdzLm1pZ3JhdGlvbl9pbnN0cnVjdGlvbnMpIHsKICAgICAgICAgICAgICAgIG1pZ3JhdGlvbkluc3RydWN0aW9ucygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInNwZmRvbmUiLCBtYWluKTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic3BmcmVxdWVzdCIsIHJlcXVlc3QpOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJyZWFkeXN0YXRlY2hhbmdlIiwgbWFpbiwgdHJ1ZSk7CiAgICAgICAgICAgIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuID0gY2hlY2tYSFIoWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLm9wZW4pOwogICAgICAgICAgICB3aW5kb3cub25Zb3VUdWJlUGxheWVyUmVhZHkgPSBzaGFyZUFwaSh3aW5kb3cub25Zb3VUdWJlUGxheWVyUmVhZHkpOwogICAgICAgICAgICB3aW5kb3cubWF0Y2hNZWRpYSA9IG1vZE1hdGNoTWVkaWEod2luZG93Lm1hdGNoTWVkaWEpOwogICAgICAgICAgICBtYWluKCk7CiAgICAgICAgfSwKICAgICAgICBjb250ZW50U2NyaXB0TWVzc2FnZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIga2V5MSwga2V5MiwgZ2F0ZSwgc2V0cywgbG9jcywgb2JzZXJ2ZXI7CiAgICAgICAgICAgIGtleTEgPSAicGFyc2VuZCI7CiAgICAgICAgICAgIGtleTIgPSAiZ2V0bG9jYWxlIjsKICAgICAgICAgICAgZ2F0ZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgc2V0cyA9IEpTT04ucGFyc2UoZ2F0ZS5kYXRhc2V0W2tleTFdIHx8IG51bGwpOwogICAgICAgICAgICBsb2NzID0gZ2F0ZS5kYXRhc2V0W2tleTJdIHx8IG51bGw7CiAgICAgICAgICAgIGlmICghZ2F0ZS5jb250ZW50c2NyaXB0KSB7CiAgICAgICAgICAgICAgICBnYXRlLmNvbnRlbnRzY3JpcHQgPSB0cnVlOwogICAgICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihwYXJ0aWNsZS5jb250ZW50U2NyaXB0TWVzc2FnZXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLm9ic2VydmUoZ2F0ZSwgewogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtIiArIGtleTEsICJkYXRhLSIgKyBrZXkyXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNldHMpIHsKICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5pc191c2Vyc2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUuR01fc2V0VmFsdWUocGFydGljbGUuaWQsIEpTT04uc3RyaW5naWZ5KHNldHMpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KHtwYXJ0aWNsZVNldHRpbmdzOiBzZXRzfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCJkYXRhLXBhcnNlbmQiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChsb2NzKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC5zZXRsb2NhbGUgPSBjaHJvbWUuaTE4bi5nZXRNZXNzYWdlKGxvY3MpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBmaWx0ZXJDaHJvbWVLZXlzOiBmdW5jdGlvbihrZXlzKSB7CiAgICAgICAgICAgIGlmIChrZXlzW3BhcnRpY2xlLmlkXSAmJiBrZXlzW3BhcnRpY2xlLmlkXS5uZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnBhcnJlY2VpdmUgPSBKU09OLnN0cmluZ2lmeSgKICAgICAgICAgICAgICAgICAgICAoa2V5c1twYXJ0aWNsZS5pZF0ubmV3X3ZhbHVlICYmIGtleXNbcGFydGljbGUuaWRdLm5ld192YWx1ZVtwYXJ0aWNsZS5pZF0pIHx8IGtleXNbcGFydGljbGUuaWRdLm5ld192YWx1ZSB8fCB7fQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbWFpbjogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgdmFyIGhvbGRlcjsKICAgICAgICAgICAgaWYgKCFldmVudCAmJiBwYXJ0aWNsZS5pc191c2Vyc2NyaXB0KSB7CiAgICAgICAgICAgICAgICBldmVudCA9IEpTT04ucGFyc2UocGFydGljbGUuR01fZ2V0VmFsdWUocGFydGljbGUuaWQsICJ7fSIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGV2ZW50ID0gSlNPTi5zdHJpbmdpZnkoZXZlbnRbcGFydGljbGUuaWRdIHx8IGV2ZW50KTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnVzZXJfc2V0dGluZ3MgPSBldmVudDsKICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5pc191c2Vyc2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGluayIpOwogICAgICAgICAgICAgICAgICAgIGhvbGRlci5yZWwgPSAic3R5bGVzaGVldCI7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyLnR5cGUgPSAidGV4dC9jc3MiOwogICAgICAgICAgICAgICAgICAgIGhvbGRlci5ocmVmID0gImh0dHBzOi8vcGFydGljbGVjb3JlLmdpdGh1Yi5pby9QYXJ0aWNsZS9zdHlsZXNoZWV0cy9Zb3VUdWJlUGx1cy5jc3M/dj0xLjcuMiI7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICAgICAgICAgIGhvbGRlci50ZXh0Q29udGVudCA9ICIoIiArIHBhcnRpY2xlLmluamVjdCArICIoIiArIHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQgKyAiKSkiOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlcik7CiAgICAgICAgICAgICAgICBpZiAoIXBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5vbkNoYW5nZWQuYWRkTGlzdGVuZXIocGFydGljbGUuZmlsdGVyQ2hyb21lS2V5cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGluaTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHBhcnRpY2xlLmlkID0gInBhcnRpY2xlU2V0dGluZ3MiOwogICAgICAgICAgICBwYXJ0aWNsZS5pc191c2Vyc2NyaXB0ID0gdHlwZW9mIEdNX2luZm8gPT09ICJvYmplY3QiID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgICAgICBpZiAocGFydGljbGUuaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgcGFydGljbGUuR01fZ2V0VmFsdWUgPSBHTV9nZXRWYWx1ZTsKICAgICAgICAgICAgICAgIHBhcnRpY2xlLkdNX3NldFZhbHVlID0gR01fc2V0VmFsdWU7CiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5tYWluKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQocGFydGljbGUuaWQsIHBhcnRpY2xlLm1haW4pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhcnRpY2xlLmNvbnRlbnRTY3JpcHRNZXNzYWdlcygpOwogICAgICAgIH0KICAgIH07CiAgICBwYXJ0aWNsZS5pbmkoKTsKfSgpKTs="},{"name":"Kill Baidu AD","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http*://www.baidu.com/*","http*://m.baidu.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-body","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1480555659299,"data":{}},"enabled":true,"position":5,"file_url":"https://greasyfork.org/scripts/24192-kill-baidu-ad/code/Kill%20Baidu%20AD.user.js","uuid":"914a0f0b-d382-4e40-b236-a7bda484b3b3","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICAgICBLaWxsIEJhaWR1IEFECi8vIEBuYW1lOnpoLUNOICAgICAgICAg55m+5bqm5bm/5ZGKKOmmluWwvuaOqOW5v+WPiuWPs+S+p+W5v+WRiinmuIXnkIYKLy8gQG5hbWVzcGFjZSAgICAgICAgICBob290aGluCi8vIEB2ZXJzaW9uICAgICAgICAgICAgMC42Ci8vIEBkZXNjcmlwdGlvbiAgICAgICAgSnVzdCBLaWxsIEJhaWR1IEFECi8vIEBkZXNjcmlwdGlvbjp6aC1DTiAg5b275bqV5riF55CG55m+5bqm5pCc57SiKHd3dy5iYWlkdS5jb20p57uT5p6c6aaW5bC+55qE5o6o5bm/5bm/5ZGK44CB5LqM5qyh6aG95Zu65bm/5ZGK5LiO5Y+z5L6n5bm/5ZGK77yM5bm26Ziy5q2i5Y+N5aSNCi8vIEBhdXRob3IgICAgICAgICAgICAgaG9vdGhpbgovLyBAaW5jbHVkZSAgICAgICAgICAgIGh0dHAqOi8vd3d3LmJhaWR1LmNvbS8qCi8vIEBpbmNsdWRlICAgICAgICAgICAgaHR0cCo6Ly9tLmJhaWR1LmNvbS8qCi8vIEBncmFudCAgICAgICAgICAgICAgbm9uZQovLyBAcnVuLWF0ICAgICAgICAgICAgIGRvY3VtZW50LWJvZHkKLy8gQGxpY2Vuc2UgICAgICAgICAgICBNSVQgTGljZW5zZQovLyBAY29tcGF0aWJsZSAgICAgICAgIGNocm9tZSDmtYvor5XpgJrov4cKLy8gQGNvbXBhdGlibGUgICAgICAgICBmaXJlZm94IOa1i+ivlemAmui/hwovLyBAY29tcGF0aWJsZSAgICAgICAgIG9wZXJhIOacqua1i+ivlQovLyBAY29tcGF0aWJsZSAgICAgICAgIHNhZmFyaSDmnKrmtYvor5UKLy8gQGNvbnRyaWJ1dGlvblVSTCAgICBodHRwczovL3d3dy5wYXlwYWwuY29tL2NnaS1iaW4vd2Vic2NyP2NtZD1fZG9uYXRpb25zJmJ1c2luZXNzPXJpeGl4aUBzaW5hLmNvbSZpdGVtX25hbWU9R3JlYXN5K0ZvcmsrZG9uYXRpb24KLy8gQGNvbnRyaWJ1dGlvbkFtb3VudCAxCi8vID09L1VzZXJTY3JpcHQ9PQoKKGZ1bmN0aW9uKCkgewogICAgJ3VzZSBzdHJpY3QnOwogICAgdmFyIE11dGF0aW9uT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuTW96TXV0YXRpb25PYnNlcnZlcjsKICAgIHZhciBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKHJlY29yZHMpewogICAgICAgIGNsZWFyQUQoKTsKICAgIH0pOwogICAgdmFyIG9wdGlvbiA9IHsKICAgICAgICAnY2hpbGRMaXN0JzogdHJ1ZSwKICAgICAgICAnc3VidHJlZSc6IHRydWUKICAgIH07CiAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIG9wdGlvbik7CgogICAgZGVsTW9iaWxlQUQoKTsKCiAgICBmdW5jdGlvbiBkZWxNb2JpbGVBRCgpewogICAgICAgIHZhciBtQWRzPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5lY193aXNlX2FkLC5lY195b3V4dWFuX2NhcmQiKTsKICAgICAgICBmb3IodmFyIGk9MDtpPG1BZHMubGVuZ3RoO2krKyl7CiAgICAgICAgICAgIHZhciBtQWQ9bUFkc1tpXTsKICAgICAgICAgICAgbUFkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobUFkKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJBRCgpewogICAgICAgIGRlbE1vYmlsZUFEKCk7CiAgICAgICAgdmFyIGxpc3Q9ZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yQWxsKCIjY29udGVudF9sZWZ0PmRpdiwjY29udGVudF9sZWZ0PnRhYmxlIiksaTsKICAgICAgICBmb3IoaT0wO2k8bGlzdC5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgbGV0IGl0ZW0gPSBsaXN0W2ldOwogICAgICAgICAgICBsZXQgcyA9IGl0ZW0uZ2V0QXR0cmlidXRlKCJzdHlsZSIpOwogICAgICAgICAgICBpZiAocyAmJiAvZGlzcGxheToodGFibGV8YmxvY2spXHMhaW1wb3J0YW50Ly50ZXN0KHMpKSB7CiAgICAgICAgICAgICAgICBpdGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaXRlbSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgdmFyIHNwYW49aXRlbS5xdWVyeVNlbGVjdG9yKCJkaXY+c3BhbiIpOwogICAgICAgICAgICAgICAgaWYoc3BhbiAmJiBzcGFuLmlubmVySFRNTD09IuW5v+WRiiIpewogICAgICAgICAgICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGViID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI2NvbnRlbnRfcmlnaHQ+dGFibGU+dGJvZHk+dHI+dGQ+ZGl2Iik7CiAgICAgICAgZm9yKGk9MDtpPGViLmxlbmd0aDtpKyspewogICAgICAgICAgICBsZXQgZCA9IGViW2ldOwogICAgICAgICAgICBpZiAoZC5pZCE9ImNvbi1hciIpIHsKICAgICAgICAgICAgICAgIGQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfSkoKTs="},{"name":"Douban Movie Download Search Modify by Louis","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://movie.douban.com/subject/*","http://movie.douban.com/subject/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1480556011959,"data":{}},"enabled":true,"position":6,"file_url":"https://greasyfork.org/scripts/8261-douban-movie-download-search-modify-by-louis/code/Douban%20Movie%20Download%20Search%20Modify%20by%20Louis.user.js","uuid":"e220f0c4-7474-492e-b2dd-0a9799ce8e13","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgIERvdWJhbiBNb3ZpZSBEb3dubG9hZCBTZWFyY2ggTW9kaWZ5IGJ5IExvdWlzCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnL3poLUNOL3NjcmlwdHMvODI2MS1kb3ViYW4tbW92aWUtZG93bmxvYWQtc2VhcmNoLW1vZGlmeS1ieS1sb3VpcwovLyBAZGVzY3JpcHRpb24gICAg5Zyo6LGG55Oj55S15b2x6aG16Z2i5re75Yqg6LWE5rqQ5pCc57Si6ZO+5o6l44CCCi8vIEB2ZXJzaW9uICAgICAgICAwLjIwMTUwNTExCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovL21vdmllLmRvdWJhbi5jb20vc3ViamVjdC8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vbW92aWUuZG91YmFuLmNvbS9zdWJqZWN0LyoKLy8gQGdyYW50ICAgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09CgpmdW5jdGlvbiBhZGRKUXVlcnkoY2FsbGJhY2spIHsKICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoInNyYyIsICJhYm91dDpibGFuayIpOwogICAgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgIHNjcmlwdC50ZXh0Q29udGVudCA9ICIoIiArIGNhbGxiYWNrLnRvU3RyaW5nKCkgKyAiKSgpOyI7CiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgfSwgZmFsc2UpOwogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwp9CgpmdW5jdGlvbiBtYWluKCkgewogICAgdHJ5IHsKICAgIAl2YXIgbW92aWVUaXRsZSA9IGpRdWVyeSgnaDEgc3BhbjplcSgwKScpLnRleHQoKTsKCQl2YXIgdGl0bGUgPSAkKCdodG1sIGhlYWQgdGl0bGUnKS50ZXh0KCk7CgkgICAgdmFyIGtleXdvcmQxID0gdGl0bGUucmVwbGFjZSggJyjosYbnk6MpJywgJycgKS50cmltKCk7CgkgICAgdmFyIGtleXdvcmQyID0gZW5jb2RlVVJJQ29tcG9uZW50KCBrZXl3b3JkMSApOwoJCWpRdWVyeSgnI2luZm8nKS5hcHBlbmQoJzxkaXY+PHNwYW4gY2xhc3M9InBsIj7kuIvovb06PC9zcGFuPiA8YSBocmVmPSJodHRwOi8vd3d3LmJhaWR1LmNvbS9zP3dkPScgKyBtb3ZpZVRpdGxlICsgJytCRHJpcCIgdGFyZ2V0PSJfYmFsbmsiPuWcqEJhaWR15LiK5pCc57SiPC9hPiAvICA8YSBocmVmPSJodHRwczovL3d3dy5nb29nbGUuY29tL3NlYXJjaD9pZT1VVEYtOCZxPScgKyBtb3ZpZVRpdGxlICsgJyt0b3JyZW50IiB0YXJnZXQ9Il9iYWxuayI+5ZyoR29vZ2xl5LiK5pCc57SiPC9hPiAvIDxhIGhyZWY9Imh0dHA6Ly9zZWFyY2gubXRpbWUuY29tL3NlYXJjaC8/cT0nICsga2V5d29yZDIgKyAnIiB0YXJnZXQ9Il9iYWxuayI+5pe25YWJPC9hPiAvIDxhIGhyZWY9Imh0dHA6Ly93d3cuemltdXp1LnR2L3NlYXJjaC9pbmRleD9rZXl3b3JkPScgKyBrZXl3b3JkMiArICcmc2VhcmNoX3R5cGU9IiB0YXJnZXQ9Il9iYWxuayI+WmltdXp1PC9hPiAvIDxhIGhyZWY9Imh0dHA6Ly90b3JyZW50ei5ldS9zZWFyY2g/Zj0nICsgbW92aWVUaXRsZSArICciIHRhcmdldD0iX2JhbG5rIj5Ub3JyZW50ejwvYT4gLyA8YSBocmVmPSJodHRwOi8vc2ltcGxlY2QubWUvc2VhcmNoL2VudHJ5Lz9xdWVyeT0nICsga2V5d29yZDEgKyAnIiB0YXJnZXQ9Il9iYWxuayI+U2ltcGxlQ0Q8L2E+IC8gPGEgaHJlZj0iaHR0cDovL3RvcnJlbnRwcm9qZWN0LmNvbS8/dD0nICsgbW92aWVUaXRsZSArICciIHRhcmdldD0iX2JhbG5rIj5Ub3JyZW50UHJvamVjdDwvYT4gLyA8YSBocmVmPSJodHRwOi8vYnRkaWdnLm9yZy9zZWFyY2g/aW5mb19oYXNoPSZxPScgKyBtb3ZpZVRpdGxlICsgJyIgdGFyZ2V0PSJfYmFsbmsiPkJURGlnZzwvYT4gLyA8YSBocmVmPSJodHRwOi8vd3d3LnRvcnJlbnRraXR0eS5jb20vc2VhcmNoLycgKyBtb3ZpZVRpdGxlICsgJyIgdGFyZ2V0PSJfYmFsbmsiPlRvcnJlbnRLaXR0eTwvYT4gLyA8YSBocmVmPSJodHRwOi8vYmFueXVuZ29uZy5uZXQvc2VhcmNoLycgKyBrZXl3b3JkMiArICcrLmh0bWwiIHRhcmdldD0iX2JhbG5rIj7mkKzov5Dlt6U8L2E+PGJyPjxzcGFuIGNsYXNzPSJwbCI+5a2X5bmVOjwvc3Bhbj4gPGEgaHJlZj0iaHR0cDovL3N1YmhkLmNvbS9zZWFyY2gvJyArIG1vdmllVGl0bGUgKyAnIiB0YXJnZXQ9Il9iYWxuayI+U3ViIEhEPC9hPiAvIDxhIGhyZWY9Imh0dHA6Ly93d3cuemltdWt1Lm5ldC9zZWFyY2g/cT0nICsgbW92aWVUaXRsZSArICciIHRhcmdldD0iX2JhbG5rIj5aaW11a3U8L2E+IC8gPGEgaHJlZj0iaHR0cDovL3d3dy5zdWJvbS5uZXQvc2VhcmNoLycgKyBtb3ZpZVRpdGxlICsgJyIgdGFyZ2V0PSJfYmFsbmsiPlN1Ym9tPC9hPiAvIDxhIGhyZWY9Imh0dHA6Ly93d3cub3BlbnN1YnRpdGxlcy5vcmcvemgvc2VhcmNoMi9zdWJsYW5ndWFnZWlkLWNoaS9tb3ZpZW5hbWUtJyArIG1vdmllVGl0bGUgKyAnIiB0YXJnZXQ9Il9iYWxuayI+T3BlblN1YnM8L2E+IC8gPGEgaHJlZj0iaHR0cDovL3Nob290ZXIuY24vc2VhcmNoLycgKyBtb3ZpZVRpdGxlICsgJyIgdGFyZ2V0PSJfYmFsbmsiPlNob290ZXI8L2E+PGRpdj4nKTsKICAgIH0KICAgIGNhdGNoIChlKSB7IH0KfQphZGRKUXVlcnkobWFpbik7"},{"name":"网盘提取工具","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["*://*/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1480567516488,"data":{}},"enabled":true,"position":7,"file_url":"https://greasyfork.org/scripts/18733-%E7%BD%91%E7%9B%98%E6%8F%90%E5%8F%96%E5%B7%A5%E5%85%B7/code/%E7%BD%91%E7%9B%98%E6%8F%90%E5%8F%96%E5%B7%A5%E5%85%B7.user.js","uuid":"232e3252-cbb6-40c0-916a-c58aa0a26eae","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICDnvZHnm5jmj5Dlj5blt6XlhbcKLy8gQG5hbWVzcGFjZSAgICBodHRwOi8vd3d3LmZpc2hsZWUubmV0LwovLyBAdmVyc2lvbiAgICAgIDIuNAovLyBAZGVzY3JpcHRpb24gIOWwveWPr+iDveWcqOaUr+aMgeeahOe9keebmO+8iOaWsOa1quW+ruebmOOAgeeZvuW6pue9keebmOOAgTM2MOS6keebmOetie+8ieiHquWKqOi+k+WFpeaPkOWPluegge+8jOecgeWOu+S4i+i9veeahOeDpuaBvOOAggovLyBAYXV0aG9yICAgICAgIOacqOmxvChpRmlzaCkKLy8gQG1hdGNoICAgICAgICAqOi8vKi8qCi8vIEBncmFudCAgICAgICAgdW5zYWZlV2luZG93Ci8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24od2luZG93LCBzZWxmLCB1bnNhZmVXaW5kb3cpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIHZhciB0aW1lU3RhcnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIHZhciBsb2NhdGlvbiA9IHNlbGYubG9jYXRpb247CiAgICB2YXIgaG9zdCA9IGxvY2F0aW9uLmhvc3Q7CiAgICB2YXIgcGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lOwogICAgdmFyIGNvZGUsIGlucHV0OwogICAgdmFyIGdldENvZGUgPSBmdW5jdGlvbihydWxlKSB7CiAgICAgICAgY29kZSA9IGxvY2F0aW9uLmhhc2guc2xpY2UoMSwgNSk7CiAgICAgICAgaWYgKChydWxlIHx8IC8oW2EtelxkXXs0fSkvaS5leGVjKGNvZGUpKSkgewogICAgICAgICAgICBjb2RlID0gUmVnRXhwLiQxOwogICAgICAgIH0gZWxzZSBjb2RlID0gbnVsbDsKICAgICAgICByZXR1cm4gY29kZTsKICAgIH07CiAgICBpZiAoKGhvc3QgPT09ICdwYW4uYmFpZHUuY29tJyB8fCBob3N0ID09PSAneXVuLmJhaWR1LmNvbScpKSB7CiAgICAgICAgLy/nmb7luqbkupHnm5gKICAgICAgICBpZiAocGF0aC5pbmRleE9mKCIvc2hhcmUvIikgIT09IC0xICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhY2Nlc3NDb2RlIikgJiYgZ2V0Q29kZSgpKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhY2Nlc3NDb2RlIikudmFsdWUgPSBjb2RlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3VibWl0QnRuIikuY2xpY2soKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKC9eLipcLnl1bnBhblwuY24kL2kudGVzdChob3N0KSkgewogICAgICAgIC8vMzYw5LqR55uYCiAgICAgICAgaWYgKHNlbGYubG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZigiL2xrLyIpICE9PSAtMSkgewogICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImlucHV0LnB3ZC1pbnB1dCIpOwogICAgICAgICAgICBpZiAoZ2V0Q29kZSgpICYmIGlucHV0KSB7CiAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGNvZGU7CiAgICAgICAgICAgICAgICBpbnB1dC5uZXh0RWxlbWVudFNpYmxpbmcuY2xpY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy/lhbblroPnvZHnq5nvvIzmo4DmtYvpk77mjqUKICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJhW2hyZWYqPSdwYW4uYmFpZHUuY29tJ10sIGFbaHJlZio9J3l1bnBhbi5jbiddLCBhW2hyZWYqPSd2ZGlzay53ZWliby5jb20nXSIpKS5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICAgICAgdmFyIHR4dCA9IGxpbmsubmV4dFNpYmxpbmcgJiYgbGluay5uZXh0U2libGluZy5ub2RlVmFsdWU7CiAgICAgICAgICAgIHZhciBsaW5rY29kZSA9IC/noIEuKj8oW2EtelxkXXs0fSkvaS5leGVjKHR4dCkgJiYgUmVnRXhwLiQxOwogICAgICAgICAgICBpZiAoIWxpbmtjb2RlKSB7CiAgICAgICAgICAgICAgICB0eHQgPSBsaW5rLnBhcmVudE5vZGUuaW5uZXJUZXh0OwogICAgICAgICAgICAgICAgbGlua2NvZGUgPSAv56CBLio/KFthLXpcZF17NH0pL2kuZXhlYyh0eHQpICYmIFJlZ0V4cC4kMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGlua2NvZGUpIHsKICAgICAgICAgICAgICAgIHZhciBocmVmID0gbGluay5nZXRBdHRyaWJ1dGUoImhyZWYiKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJocmVmIiwgaHJlZiArICIjIiArIGxpbmtjb2RlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgdmFyIHRpbWVFbmQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIGNvbnNvbGUubG9nKCJb572R55uY5o+Q5Y+W5bel5YW3XSDpk77mjqXlpITnkIblrozmiJDvvIzogJfml7bvvJoiICsgKHRpbWVFbmQgLSB0aW1lU3RhcnQpICsgIuavq+enki4g5aSE55CG5qih5byP77yaRE9N5aSE55CGIik7Cn0pKHdpbmRvdywgd2luZG93LnNlbGYsIHVuc2FmZVdpbmRvdyk7CihmdW5jdGlvbigpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIC8vY29uc3RzLi4uCiAgICB2YXIgQ09ERV9SVUxFX0JBSURVID0gL14oW2EtelxkXXs0fSkkL2k7CiAgICB2YXIgQ09ERV9SVUxFX1lVTlBBTiA9IC9eKFthLXpcZF17NH0pJC9pOwogICAgdmFyIE1BWF9TRUFSQ0hfQ09ERV9SQU5HRSA9IDU7CiAgICAvL2Z1bmN0aW9ucy4uLgogICAgdmFyIHRleHROb2Rlc1VuZGVyID0gZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgbiwgYSA9IFtdLAogICAgICAgICAgICB3YWxrID0gZG9jdW1lbnQuY3JlYXRlVHJlZVdhbGtlcihlbCwgTm9kZUZpbHRlci5TSE9XX1RFWFQsIG51bGwsIGZhbHNlKTsKICAgICAgICB3aGlsZSAoKG4gPSB3YWxrLm5leHROb2RlKCkpKSBhLnB1c2gobik7CiAgICAgICAgcmV0dXJuIGE7CiAgICB9OwogICAgdmFyIGdlbmVyYWxMaW5raWZ5VGV4dCA9IGZ1bmN0aW9uKHRleHQsIGVsZXMsIGluZGV4LCB0ZXN0UmVnLCB2YWxpZGF0ZVJ1bGUpIHsKICAgICAgICB2YXIgbG9vcENvdW50ID0gMCwKICAgICAgICAgICAgb3JpZ2luYWxUZXh0LCBjb2RlLCBtYXRjaCwgdXJsLAogICAgICAgICAgICBsaW5raWZpZWRUZXh0ID0gdGV4dDsKICAgICAgICB3aGlsZSAoKG1hdGNoID0gdGVzdFJlZy5leGVjKHRleHQpKSkgewogICAgICAgICAgICBsb29wQ291bnQrKzsKICAgICAgICAgICAgdXJsID0gKG1hdGNoWzFdIHx8ICJodHRwOi8vIikgKyBtYXRjaFsyXTsKICAgICAgICAgICAgb3JpZ2luYWxUZXh0ID0gbWF0Y2hbMV0gKyBtYXRjaFsyXTsKICAgICAgICAgICAgY29kZSA9IG1hdGNoWzNdIHx8IGZpbmRDb2RlRnJvbUVsZW1lbnRzKGVsZXMsIGluZGV4LCB2YWxpZGF0ZVJ1bGUpIHx8ICIiOwogICAgICAgICAgICBjb25zb2xlLmxvZygiW+e9keebmOaPkOWPluW3peWFt10g5bey5aSE55CG572R55uY5Zyw5Z2A77yMVVJMPSIgKyB1cmwgKyAi77yM5o+Q5Y+W56CBPSIgKyBjb2RlICsgIuaooeW8j++8mlRFWFROT0RFIik7CiAgICAgICAgICAgIGxpbmtpZmllZFRleHQgPSBsaW5raWZpZWRUZXh0LnJlcGxhY2Uob3JpZ2luYWxUZXh0LCAiPGEgaHJlZj0nIiArIHVybCArICIjIiArIGNvZGUgKyAiJyB0YXJnZXQ9J19ibGFuayc+IiArIHVybCArICc8L2E+Jyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbbG9vcENvdW50LCBsaW5raWZpZWRUZXh0XTsKICAgIH07CiAgICB2YXIgbGlua2lmeVRleHRCbG9ja0JhaWR1ID0gZnVuY3Rpb24odGV4dCwgZWxlcywgaW5kZXgpIHsKICAgICAgICByZXR1cm4gZ2VuZXJhbExpbmtpZnlUZXh0KHRleHQsIGVsZXMsIGluZGV4LCAvKGh0dHA6XC9cLyk/KCg/OnBhbnx5dW4pXC5iYWlkdVwuY29tXC9zXC8oPzpbYS16XGRdKykpKD86Lio/56CBLio/KFthLXpcZF0rKSk/L2dpLCBDT0RFX1JVTEVfQkFJRFUpOwogICAgfTsKICAgIHZhciBsaW5raWZ5VGV4dEJsb2NrWXVucGFuID0gZnVuY3Rpb24odGV4dCwgZWxlcywgaW5kZXgpIHsKICAgICAgICByZXR1cm4gZ2VuZXJhbExpbmtpZnlUZXh0KHRleHQsIGVsZXMsIGluZGV4LCAvKGh0dHA6XC9cLyk/KHl1bnBhblwuY25cLyg/OlthLXpcZF0rKSkoPzouKj/noIEuKj8oW2EtelxkXSspKT8vZ2ksIENPREVfUlVMRV9ZVU5QQU4pOwogICAgfTsKICAgIHZhciBmaW5kQ29kZUZyb21FbGVtZW50cyA9IGZ1bmN0aW9uKGVsZXMsIGluZGV4LCBydWxlKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBNQVhfU0VBUkNIX0NPREVfUkFOR0UgJiYgaSA8IGVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIHR4dCA9IGVsZXNbaSArIGluZGV4XS50ZXh0Q29udGVudDsKICAgICAgICAgICAgdmFyIGNvZGVSZWcgPSAv56CBLio/KFthLXpcZF0rKS9naTsKICAgICAgICAgICAgdmFyIGNvZGVNYXRjaCA9IGNvZGVSZWcuZXhlYyh0ZXh0KSAmJiBSZWdFeHAuJDE7CiAgICAgICAgICAgIGlmICghY29kZU1hdGNoKSBjb250aW51ZTsKICAgICAgICAgICAgdmFyIGxpbmtUZXN0UmVnID0gLyhodHRwcz86fFwuKG5ldHxjbnxjb218Z292fGNjfG1lKSkvZ2k7CiAgICAgICAgICAgIGlmIChsaW5rVGVzdFJlZy5leGVjKHR4dCkgJiYgbGlua1Rlc3RSZWcubGFzdEluZGV4IDw9IGNvZGVSZWcubGFzdEluZGV4KSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocnVsZS50ZXN0KGNvZGVNYXRjaCkpIHJldHVybiBjb2RlTWF0Y2g7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIHZhciBsaW5raWZ5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGVsZXMgPSB0ZXh0Tm9kZXNVbmRlcihkb2N1bWVudC5ib2R5KTsKICAgICAgICB2YXIgZWxlLCB0eHQsIGxvb3BDb3VudDsKICAgICAgICB2YXIgcHJvY2Vzc29yID0gWwogICAgICAgICAgICBsaW5raWZ5VGV4dEJsb2NrQmFpZHUKICAgICAgICBdOwogICAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uKGZ1bikgewogICAgICAgICAgICB2YXIgZGF0YSA9IGZ1bih0eHQsIGVsZXMsIGkgKyAxKTsKICAgICAgICAgICAgbG9vcENvdW50ICs9IGRhdGFbMF07CiAgICAgICAgICAgIHR4dCA9IGRhdGFbMV07CiAgICAgICAgfTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZWxlID0gZWxlc1tpXTsKICAgICAgICAgICAgaWYgKGVsZS5wYXJlbnROb2RlLnRhZ05hbWUgPT0gJ2EnKSBjb250aW51ZTsKICAgICAgICAgICAgdHh0ID0gZWxlLnRleHRDb250ZW50OwogICAgICAgICAgICBsb29wQ291bnQgPSAwOwogICAgICAgICAgICBwcm9jZXNzb3IuZm9yRWFjaChjYWxsYmFjayk7CiAgICAgICAgICAgIGlmIChsb29wQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgICAgICAgICAgIHNwYW4uaW5uZXJIVE1MID0gdHh0OwogICAgICAgICAgICAgICAgZWxlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHNwYW4sIGVsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHRpbWVTdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgbGlua2lmeSgpOwogICAgdmFyIHRpbWVFbmQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIGNvbnNvbGUubG9nKCJb572R55uY5o+Q5Y+W5bel5YW3XSDpk77mjqXlpITnkIblrozmiJDvvIzogJfml7bvvJoiICsgKHRpbWVFbmQgLSB0aW1lU3RhcnQpICsgIuavq+enki4g5aSE55CG5qih5byP77yaVEVYVE5PREXlpITnkIYiKTsKfSkoKTs="},{"name":"Easy offline","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":["http*://www.baidu.*","http*://www.google.*","http*://www.bing.*"],"orig_includes":["http*://*/*","http*://pan.baidu.com/*","http*://115.com/*","https://www.furk.net/*","https://www.seedr.cc/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1480567553156,"data":{}},"enabled":false,"position":8,"file_url":"https://greasyfork.org/scripts/22590-%E4%B8%80%E9%94%AE%E7%A6%BB%E7%BA%BF%E4%B8%8B%E8%BD%BD/code/%E4%B8%80%E9%94%AE%E7%A6%BB%E7%BA%BF%E4%B8%8B%E8%BD%BD.user.js","uuid":"8ec03493-e608-464e-b8c9-497c429e31fb","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBFYXN5IG9mZmxpbmUKLy8gQG5hbWU6emgtQ04gICDkuIDplK7nprvnur/kuIvovb0KLy8gQG5hbWU6emgtVFcgICDkuIDpjbXpm6LntqvkuIvovIkKLy8gQGRlc2NyaXB0aW9uICBCZSBlYXN5IHRvIGZpbmQgb3V0IGFsbCBtYWduZXQgbGlua3MgYW5kIHRvcnJlbnRzIGFuZCB2aWRlbyBsaW5rcyBpbiBjdXJyZW50IHBhZ2UsIGFuZCBzdHJlYW0gdGhlbSBmcm9tIGNsb3VkIHN0b3JhZ2UgYXV0b21hdGljYWxseS4KLy8gQGRlc2NyaXB0aW9uOnpoLUNOIOS4gOmUruiHquWKqOWwhuejgemTvuOAgWJ056eN5a2Q5oiW5YW25LuW5LiL6L296LWE5rqQ56a757q/5LiL6L296Iez572R55uYCi8vIEBkZXNjcmlwdGlvbjp6aC1UVyDkuIDpjbXoh6rli5XlsIfno4Hpj4jjgIFidOeoruWtkOaIluWFtuS7luS4i+i8ieizh+a6kOmboue2q+S4i+i8ieiHs+e2suangwovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAcmVxdWlyZSAgICAgIGh0dHA6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzEuNy4yL2pxdWVyeS5taW4uanMKLy8gQHZlcnNpb24gICAgICAxLjAuNDIKLy8gQGF1dGhvciAgICAgICBIb290aGluCi8vIEBtYWlsICAgICAgICAgcml4aXhpQGdtYWlsLmNvbQovLyBAaW5jbHVkZSAgICAgIGh0dHAqOi8vKi8qCi8vIEBleGNsdWRlICAgICAgaHR0cCo6Ly93d3cuYmFpZHUuKgovLyBAZXhjbHVkZSAgICAgIGh0dHAqOi8vd3d3Lmdvb2dsZS4qCi8vIEBleGNsdWRlICAgICAgaHR0cCo6Ly93d3cuYmluZy4qCi8vIEBpbmNsdWRlICAgICAgaHR0cCo6Ly9wYW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgICBodHRwKjovLzExNS5jb20vKgovLyBAaW5jbHVkZSAgICAgIGh0dHBzOi8vd3d3LmZ1cmsubmV0LyoKLy8gQGluY2x1ZGUgICAgICBodHRwczovL3d3dy5zZWVkci5jYy8qCi8vIEBncmFudCAgICAgICAgR01fc2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQKLy8gQGdyYW50ICAgICAgICBHTV9kZWxldGVWYWx1ZQovLyBAZ3JhbnQgICAgICAgIHVuc2FmZVdpbmRvdwovLyBAc3VwcG9ydFVSTCAgIGh0dHA6Ly93d3cuaG9vdGhpbi5jb20KLy8gQGxpY2Vuc2UgICAgICBNSVQgTGljZW5zZQovLyBAY29tcGF0aWJsZSAgICAgICAgY2hyb21lCi8vIEBjb21wYXRpYmxlICAgICAgICBmaXJlZm94Ci8vIEBjb250cmlidXRpb25VUkwgaHR0cHM6Ly93d3cucGF5cGFsLmNvbS9jZ2ktYmluL3dlYnNjcj9jbWQ9X2RvbmF0aW9ucyZidXNpbmVzcz1yaXhpeGlAc2luYS5jb20maXRlbV9uYW1lPUdyZWFzeStGb3JrK2RvbmF0aW9uCi8vIEBjb250cmlidXRpb25BbW91bnQgMQovLyA9PS9Vc2VyU2NyaXB0PT0KKGZ1bmN0aW9uKCkgewogICAgJ3VzZSBzdHJpY3QnOwogICAgdmFyIHNpdGVzPXsKICAgICAgICAwOnsKICAgICAgICAgICAgbmFtZToiYmFpZHUiLAogICAgICAgICAgICB1cmw6Imh0dHBzOi8vcGFuLmJhaWR1LmNvbS9kaXNrL2hvbWUiLAogICAgICAgICAgICBiZ0NvbG9yOiJmZmZmZmYiLAogICAgICAgICAgICBiZ0ltZzoiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FNQUFBQkVwSXJHQUFBQmpGQk1WRVgvLy8vNysvdisvdi84L1B3eWYvd3pjL3cwYnZ6YTVmNHhmZno1Ky8vMCtQOHliUHo4L2Y0eWV2dzBjUHd6YS96MzkvY3dlL1V4ZGZ6U1B5cjQrdi8yK2YvbTcvNTNudjB2Zi93dmNlOXBvZjF0bFB3eGYvZ3pmUFl3ZVBQcDhmN1o1LzdTNHY3UDRQN0wzZjdJMmYyR3RmMlJyLzFoa1AweWQvMUZpUHd5Z2Z4QWRQeHNwZnRZa3ZVdGMvRGc2ZjdDMmY3RjFmNTRvUDFmbGYwL2hmd3NidTdpN2YvdzlmN2I1djdYNWY3VjR2Nm55djZveHY2andQNk5zLzJMc2YxL3J2MStvdjF6b2YxeG9mMTBuZjFqbS8xZGpQMHhlLzJOdWZ4YWx2eEhqL3hQaHZ4S2dQeEhmZncrZWZ3MGVQeVh1L21xeFBnNWhmaVR0dmR5by9kZ21mZE9qL2RCaGZWZmxmUXZlZlQrOWZPSXF2TXllZk5NaHZGSWdPOU1lZVB5eWNWalpiektiM0RhWlZhL1EwRHg5ZitCcC8xb2x2MWdrUHcwZHZ6ZzZQdTJ6UGswZ2ZsTmpQY3RjL2M5Z2ZYODgvSkpmTzNuMytuaTJ1bkh4dVNHa3ROcGR0QkpZOHBhYXNoUlc3MW5YcXA3WXB5RFlKS3BhSUtQVTMzQVZGWEFSa1RWVFR2RlFqclVQeXBLd0hxMUFBQUNBa2xFUVZRNHk0V1RCM09xUUJTRkYzQnBBaytLSUJpeEoycnMwZlRlZTY4dnZiemVlKzkvL08xQ2lvNDZucG1GUGZkOGQyY1k5Z0lBU01KSFVFU0RLRlFtQVpKQVVLQ0ZLRUxBL1dTcjNBM2QvdFpuQUY5OUM4ZlZIWWhpb3NieHhmbHNkcjdJMTVTSVdpQ2UzZXhBMnN6R213T0pYVGtVa3ZIYVRUUUQ5TnlCTE8vdDdPeko4a0ZPYndLczIvYlJkclN2TDdwOVpOdnJqUUMvbjgvbnduZ1h6dVh6KzN3REVENDJ6UzEzdTJXYXgrRUdRRCtwbWh2dWRzT3NudWoxZ0JBWlNwNSsvWFJJWWtNZVZ1MVh5YUdJY0Fmb3ljVk00UG4zcXg5dmNXM2dSVWNtRThnc0p2VWJvTmZ5ZUR5QndMZC82c1g3d3RObkM0NURENnZYQmJSeDFzT21yUSsvVkZYOWVmb21oRnpGc3RMb05hNDVRS3pDaWpNeC92WFpwYXIrL2ZLU1plY1dpandmbXhIWlNnekZGQmdXeFhRVUlKMzlVWDkvbmhQRm5nSHNvbWxSSEVZeFJZNm1sQ2tPbCs1ZlhwMnZyYVY2SWdDTG0xSlNveVFHeGhSbFVuQ0FpL1BVRXdYbldNS2tvb3hoQUl4QXVOU1BTKzgrUWdpN0dPQjN6dXRmZ25BRXhRU0lyMEpvTUp3MkdKU2doUExTbzRlREdzY1lFSzdHbmEvZ3k3UWtMUnZUSzVKRVAyYkFneTR2dlRKdExDTlg1aDBBTUxOZW12YmloZnFCdjN6alpwSERBQ0tNN250STNSTUZnRlNZY0ozQjNQMHNmNmt6R094TStBRndYQUs3a3VOdXJ6MnBjV1R0N2RldW5hL3Q0TFFkdmJiRDIzYjgvd1BZMFVUTzk5ZEQ1Z0FBQUFCSlJVNUVya0pnZ2c9PSIKICAgICAgICB9LAogICAgICAgIDE6ewogICAgICAgICAgICBuYW1lOiJwY2xvdWQiLAogICAgICAgICAgICB1cmw6Imh0dHBzOi8vbXkucGNsb3VkLmNvbS8iLAogICAgICAgICAgICBiZ0NvbG9yOiJmMWYxZjEiLAogICAgICAgICAgICBub01hZzp0cnVlLAogICAgICAgICAgICBub0VkMms6dHJ1ZSwKICAgICAgICAgICAgbm9GdHA6dHJ1ZSwKICAgICAgICAgICAgYmdJbWc6ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBTUFBQUFvTFE5VEFBQUFYVkJNVkVYLy8vLy8vLzhieXRULy8vOGZ5OVVieXRRYnl0UWZ5OVVmeTlVbXpOWWJ5dFFneTlVaXpOVWJ5dFQvLy84Ynl0UWV5OVVmeTlVZ3k5VkcxTnhCMDlzYnl0UmcydUZTMTk0Ynl0VC8vLzlHMU56eC9QemkrUHBUMTkrYzZPeFo3cnFYQUFBQUdIUlNUbE1CRy9BSHhZQWg0OU8zb1dKQk1SVVI0Yk9MWVY5UlF6OWZXNXpiQUFBQWJVbEVRVlFZMDQzTVJ4TENNQkJFMFdZa09RY3lYeWJjLzVoSWhVdXd3Mi8zdTJwR0cxV2RZVjFWdWpjeUc5Y2VXZG1jTThqREs4YkhFMExxQ3pNUUY1WTdOT25OZ2VFN01BVEJNUStmRS9xOXdDd05rRFVldFVBWlBMVnV4cSt6M0xXbHFFOU9jdE91bUZMLzlRWUNsd3Z0M05rRGtnQUFBQUJKUlU1RXJrSmdnZz09IgogICAgICAgIH0sCiAgICAgICAgMjp7CiAgICAgICAgICAgIG5hbWU6Inl5dyIsCiAgICAgICAgICAgIHVybDoiaHR0cDovLzExNS5jb20vP3RhYj1vZmZsaW5lJm1vZGU9d2FuZ3BhbiIsCiAgICAgICAgICAgIGJnQ29sb3I6IjIxNDU4YSIsCiAgICAgICAgICAgIGJnSW1nOiJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJBQUFBQVFDQU1BQUFBb0xROVRBQUFBU0ZCTVZFVWhSWXIvLy8rWHFjalYzT21Kbk1GVGI2UW9TNDVQYktMdThmYlo0T3ZCeTk1eGlMUmlmS3hiZHFsWGNxWXhVNVAzK1ByaDV1L08xdVhIMGVLNnhkdWtzODkvbEx0R1pKNHlzTWZoQUFBQVZVbEVRVlFZMDRXUFNRNkFNQXdENnlTa2RLSHM4UCtmY2t5RGhQQnRSb29qaHlHNEdQNkZFalB2eGhHWmlLS0pQTTd1b0FIWVNpZjBMZ2R3K3RwcFFmT0dJRjRJTHNlYTNDZXR2TWErVWFScStNaDcvZ1BreEFIRmg5V0RVUUFBQUFCSlJVNUVya0pnZ2c9PSIKICAgICAgICB9LAogICAgICAgIDM6ewogICAgICAgICAgICBuYW1lOiJmdXJrIiwKICAgICAgICAgICAgdXJsOiJodHRwczovL3d3dy5mdXJrLm5ldC91c2Vycy9maWxlcy9hZGQiLAogICAgICAgICAgICBiZ0NvbG9yOiJmMWYxZjEiLAogICAgICAgICAgICBoaWRlOmZhbHNlLAogICAgICAgICAgICBiZ0ltZzoiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDNEFBQUF1Q0FNQUFBQmdaOXNGQUFBQWZsQk1WRVgvLy8rQ3V1YUd2K3JqWEtuaVRhaUR1K2QzdHVmaVhxL25VcXhBbjkrdDF2R2l6L0ZPbnQvc2o4bm9sOGJoY0xKUm85N2I3dnA1dU9wQ29lR1F3K20zMS9YVzYvZXIwKytJd2UzMzB1WlVwdUhzc05qbmk4VHFmNy9vOVBuNjhQU1V4KzczMmV1Y3l1dnp6dUpqcStIMHY5N3NtOHExMnZEdG84L3Jjcmp0ODMxVUFBQUJtVWxFUVZSSXgrMlQ2VzZETUJDRThkcjRhRWd3MEtTNWt6WkgyL2Qvd2U3YWxpSmxONktSK3JOamdZd1lmeHJ3dVByWFh3a2VhQzdiYTFucVU3WXJXZlY4M042cm05NUc3WkNXbE5uTDZLZmEyMHpCQTd0TkVsN0tTc2psNUluL3JzQk9ucUFydGZ4MUdHWFZHSDExMld3dXEyS25NTURwMm5uVXRhcXVPc3R0Y2hpazE1eWVMR1o2OHRwcDc0MDNlbFhvNHBabjVMZDN6cGcwM1ZXRmprT21lNTFrY0dqL251MXA3d0Y2UVBVMGNqS0RWSXlCUnJmYnRkcHRNNFhZcVlJb1NLUCtLSFEwNFgxN3dLZkRGOEpKWUpVdDljcXJWSDJzVU9nMGhKNEp1NXJOUlNXTUliOXI3MHVBNGEybFJSU3J4OXN0REY2bmU3dENyejEyWGJkZkxQYmRBaWNWQ2RGRXI1Z2RRR3EzMDZRdDZ3ejVnUjgxK3QydG1YSTZTYkxUNXN4NGdhMVlNZE5pZE0vc0FNUVhPbU9vQlZQeGVNaWRhYVV3RnNTamJWQmErTlMwUmR5ZXF1Z1lYUzBwamhTbWxlZ1djS3hmUmJybWRGQndqcEhiTWJsRVYrY1F3aURTblVCZkQ4UFFOTUR0VkJwT0gySVloalZJblpIb3NZa3hCaDdHR1pFZUdwUmcxNjFJYjBJVFFoVENNUHJ6K2dHMXNoRjRrb0hFVEFBQUFBQkpSVTVFcmtKZ2dnPT0iCiAgICAgICAgfSwKICAgICAgICA0OnsKICAgICAgICAgICAgbmFtZToic2VlZHIiLAogICAgICAgICAgICB1cmw6Imh0dHBzOi8vd3d3LnNlZWRyLmNjL2ZpbGVzIiwKICAgICAgICAgICAgYmdDb2xvcjoiY2EyYTE1IiwKICAgICAgICAgICAgaGlkZTpmYWxzZSwKICAgICAgICAgICAgYmdJbWc6ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBTUFBQUFvTFE5VEFBQUFsbEJNVkVYR0tCUEdLQlBHS0JQR0tCUE9SRExKTWgzdXY3blFURHZJTFJqcHJLUG1vWmpiZG1uTE95aktOU0h0dkxicnRLM29wcDNsbTVIaGo0VGFjMlhaYjJIWGFsdlVYRXpMT2liR0tCUEdLQlBHS0JQcXNhcmpsb3ZlaEhqWGFGblRXa3JNUUMzR0tCUEdLQlBHS0JQLy8vLzQ0K0g3N3UzMjNOajAxZEh4eWNQODh2SDY2K24yM2RyMDE5VHl6OHJ4ek1mdnc3M3Z3cnhZVmo5QkFBQUFKSFJTVGxQN3liK2orL3Y5Ky92OS9mMzcrLzM5L2YzOS9mMzkrL3V4bVNqOS9mMzcrL3VYTlIyR2Q5RTZBQUFBbVVsRVFWUVkwMDNOVnhLRE1BeEZVUVZzYkhxdjZZa01JVDM3MzF3RVpvRDdvWmwzZmdRWFk3UEthS0FDS245M0J4aXJ3YUFyV3NRWEg4RWNZWWVVdTRCbkRSQXNVS2dCV2paRGVxZmR1WEtHbUhiUFQzWWlKOWdpUHRqK3FVSldhdmdoeG9VU0hGeExBejNKSWdjQXlwc0dCekYzYkFKdkF2SEI1UGlWbm04SEdvQlpJZmZUVnZXTW9JSWhYNEtJTWc1d2hzYmNyS3F2ZjI5dURCY3UyK1NBQUFBQUFFbEZUa1N1UW1DQyIKICAgICAgICB9LAogICAgICAgIDU6ewogICAgICAgICAgICBuYW1lOiJ4dW5sZWkiLAogICAgICAgICAgICB1cmw6Imh0dHA6Ly9saXhpYW4udmlwLnh1bmxlaS5jb20vbGl4aWFuX2xvZ2luLmh0bWw/ZnVybD0iLAogICAgICAgICAgICBiZ0NvbG9yOiIyZTcxZjEiLAogICAgICAgICAgICBiZ0ltZzoiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCa0FBQUFaQ0FNQUFBRHpOM1ZSQUFBQkMxQk1WRVVBQUFBcmNQVXNjUFFrYXZKU2Q3OVVkcmhUZHJsZWQ2a2phZTh1Y2ZBcWJPd29hKzBwYSt4VGQ3MVdkck5hZDYxZGVhNHBiTzR2Y3ZFc2IvQXFiZThzYnU4dWNmQXJidTh1Y2ZFcGJlMG9hKzR2Y1BILy8vNFpZZTdqOGZuZTdma25iUEFrYU80MWRmRGE2dmdjWSsvbzgvclY2UGNoWis0YlpPNzkvLzN1K2ZrbGF2SWlhTzhWWHUzeDkvM3Q5ZnZlN3ZlTHNmWXFjZlpOaHZFNWQvQWZaTzM2L2Z6MCsvcnkrdnJiNlByRzJ2blI1ZmJMNGZhWHVmYkczZldxeVBXancvV0VyUFdpeFBSNHBQUjBvdk9Jc2ZKc25QSllqKzlCZmUvMSt2M2w3ZjNwOFB6ZzdmcSswL21sdy9mWTYvYVF0UGFIcmZabmwvUzQxZk9SdC9LQXF2S1p2dkZKaE84ZVplNFJWQ3pGQUFBQUVYUlNUbE1BK1A3NGducHpXUDMyOU9yb2hYSmdYT1FWYUVjQUFBRk9TVVJCVkNqUFpjem5lb0l3R0liaHFOWHVFUU9SWUdJQlFYRHZ2YmZkZTV6L2tmU1RpMUt4OTc5OHovVUdJWFFRVXVKQlNpaUd3RG1FUFVrbEZJVkZEY0kvNGRvVnFpbFVDU0lGQXJkamxBeFFGRTFJcjQxRU1obEdsRktpRWVyUmhQRnkyOU8zYnlpeVVUY2N4OUhpVkJieFlZbTNqQUwxaWx5dlBsZXJobDF3Rm5lYzgzbVJ1b1VRU2dyMmxQUDdCbjNnMmRKTnRtNlRMU2dnVVh6TVpydGRYaTZYK2RDUi9RTEV0R1YxU3BabHRYdmZHdGt0NXFTZGNuWG1wbWxpdDhndWM1Szc5dlRISzBPQ2sxZWFxMXg2cTJMbFV1bkJVc1pRRWk1c2ozTVpNSnA5YkxDdXluQ0NqVXZYM3l1VnpLQlJGTHFLNFROdkErUWo4VFY3U2kxRTRoZVNmS1pZai9wVWx6eFFmRmpRdDJYUkwvaVBKRFhWejQzdHZSQm1PNlNtc2RhWlMwTjV6SFpuT3BNd1lOb0ppdVUxcHU1aitmd2hRdEdJeW5BUVV5TVhDRnllcW50RlBZUEZEMDk1UXg4eCtuN0NBQUFBQUVsRlRrU3VRbUNDIgogICAgICAgIH0sCiAgICB9OwogICAgdmFyIGVuYWJsZVVybCA9ICdhW2hyZWZePSJtYWduZXQiXSxbaHJlZl49ImVkMms6Ly98ZmlsZSJdLFtocmVmJD0iLnRvcnJlbnQiXSxbaHJlZiQ9Ii5tcDQiXSxbaHJlZiQ9Ii5yYXIiXSxbaHJlZiQ9Ii43eiJdLFtocmVmJD0iLnppcCJdLFtocmVmJD0iLnJtdmIiXSxbaHJlZiQ9Ii5ta3YiXSxbaHJlZiQ9Ii5hdmkiXSxbaHJlZiQ9Ii5pc28iXSc7CiAgICB2YXIgZGlzYWJsZVVybD1bIi50b3JyZW50a2l0dHkuIiwiYnQuYm94Lm4wODA4LmNvbSJdOwogICAgdmFyIGxhbmcgPSBuYXZpZ2F0b3IuYXBwTmFtZT09Ik5ldHNjYXBlIj9uYXZpZ2F0b3IubGFuZ3VhZ2U6bmF2aWdhdG9yLnVzZXJMYW5ndWFnZTsKICAgIHZhciBpMThuPXt9OwogICAgdmFyIHNob3dUeXBlPSEhR01fZ2V0VmFsdWUoInNob3dUeXBlIik7CiAgICAkPWpRdWVyeTsKICAgIHN3aXRjaCAobGFuZyl7CiAgICAgICAgY2FzZSAiemgtQ04iOgogICAgICAgICAgICBpMThuPXsKICAgICAgICAgICAgICAgIHRvZ2dsZToi5pi+56S65oiW6ZqQ6JeP5LiA6ZSu56a757q/5oyJ6ZKuIiwKICAgICAgICAgICAgICAgIHl5dzoiMTE1572R55uYIiwKICAgICAgICAgICAgICAgIGJhaWR1OiLnmb7luqbnvZHnm5giLAogICAgICAgICAgICAgICAgZnVyazoiRnVya+e9keebmCIsCiAgICAgICAgICAgICAgICBzZWVkcjoiU2VlZHLnvZHnm5giLAogICAgICAgICAgICAgICAgcGNsb3VkOiJQY2xvdWTnvZHnm5giLAogICAgICAgICAgICAgICAgeHVubGVpOiLov4Xpm7fnprvnur8iCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGkxOG49ewogICAgICAgICAgICAgICAgdG9nZ2xlOiJUb2dnbGUgdmlzaWJpbGl0eSBvZiBFYXN5T2ZmbGluZSIsCiAgICAgICAgICAgICAgICB5eXc6IjExNSIsCiAgICAgICAgICAgICAgICBiYWlkdToiQmFpZHVQYW4iLAogICAgICAgICAgICAgICAgZnVyazoiRnVyayIsCiAgICAgICAgICAgICAgICBzZWVkcjoiU2VlZHIiLAogICAgICAgICAgICAgICAgcGNsb3VkOiJQY2xvdWQiLAogICAgICAgICAgICAgICAgeHVubGVpOiJYdW5sZWkiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJyZWFrOwogICAgfQoKICAgIGZ1bmN0aW9uIGluY2x1ZGUodGhpbmdzLG9iaikgewogICAgICAgIGZvciAodmFyIGkgPSB0aGluZ3MubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgaWYgKCQodGhpbmdzW2ldKS5hdHRyKCdocmVmJyk9PT0kKG9iaikuYXR0cignaHJlZicpKXsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldENzcygpewogICAgICAgICQoJ2hlYWQnKS5hcHBlbmQoYAogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgYS53aHgtYXsKICAgICAgICAgICAgICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOwogICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6NXB4OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1zaXplOjIwcHg7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOjUwJTsKICAgICAgICAgICAgICAgIGJvcmRlcjowcHg7CiAgICAgICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOm1hcmdpbi10b3AgMC4yNXMgZWFzZTsKICAgICAgICAgICAgICAgIG91dGxpbmU6bm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBwYWRkaW5nOjBweCFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBoZWlnaHQ6MjVweCFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB3aWR0aDoyNXB4IWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGxlZnQ6MHB4IWltcG9ydGFudDsKICAgICAgICAgICAgICAgIHRvcDowcHghaW1wb3J0YW50OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXIhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0IWltcG9ydGFudDsKICAgICAgICAgICAgfQogICAgICAgIDwvc3R5bGU+YCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWxsRW5hYmxlVXJsKCkgewogICAgICAgIGlmKEdNX2dldFZhbHVlKCdlb0Rpc2FibGVfJytkb2N1bWVudC5kb21haW4pKXJldHVybjsKICAgICAgICB2YXIgcGFyZW50RGl2PSQoIjxkaXYgc3R5bGU9J2Rpc3BsYXk6bm9uZTtwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4Ojk5OTk5O292ZXJmbG93OnZpc2libGU7dGV4dC1hbGlnbjpsZWZ0Oyc+PC9kaXY+Iik7CiAgICAgICAgdmFyIHJhd25vZGVzID0gJChlbmFibGVVcmwpLmdldCgpLGN1c3RvbW5vZGVzPVtdOwogICAgICAgIHZhciBub2RlcyA9IFtdOwogICAgICAgIHZhciBpLHg7CiAgICAgICAgdmFyIGN1ck5vZGU7CiAgICAgICAgdmFyIG9mZlVybDsKICAgICAgICB2YXIgb2ZmTm9kZXM9W107CiAgICAgICAgdmFyIHJlZ3M9R01fZ2V0VmFsdWUoImVvUmVnIik7CiAgICAgICAgaWYocmVncyl7CiAgICAgICAgICAgIHZhciBhVGFncyA9ICQoImEiKS5nZXQoKTsKICAgICAgICAgICAgZm9yKHZhciBhVGFnIG9mIGFUYWdzKXsKICAgICAgICAgICAgICAgIGZvcih2YXIgcmVnIG9mIHJlZ3MpewogICAgICAgICAgICAgICAgICAgIHZhciBwYXR0PW5ldyBSZWdFeHAocmVnKTsKICAgICAgICAgICAgICAgICAgICBpZihwYXR0LnRlc3QoYVRhZy5ocmVmKSAmJiAkLmluQXJyYXkoYVRhZywgcmF3bm9kZXMpPT0tMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbW5vZGVzLnB1c2goYVRhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoaWRlSWNvbnMoKXsKICAgICAgICAgICAgcGFyZW50RGl2LmNzcygiZGlzcGxheSIsIm5vbmUiKTsKICAgICAgICAgICAgZm9yKHZhciBub2RlIG9mIG9mZk5vZGVzKXsKICAgICAgICAgICAgICAgIG5vZGUuY3NzKCJtYXJnaW4tdG9wIiwiMHB4Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yKHggPSAwOyB4IDwgT2JqZWN0LmtleXMoc2l0ZXMpLmxlbmd0aDsgeCsrKXsKICAgICAgICAgICAgbGV0IG9mZk5vZGU9JCgiPGE+PC9hPiIpOwogICAgICAgICAgICBvZmZOb2RlLmFkZENsYXNzKCd3aHgtYScpLmNzcygicG9zaXRpb24iLCJhYnNvbHV0ZSIpLmNzcygibWFyZ2luLXRvcCIsIjBweCIpLmNzcygibWFyZ2luLWxlZnQiLCIwcHgiKS5hdHRyKCJ0YXJnZXQiLCJfYmxhbmsiKTsKICAgICAgICAgICAgbGV0IHNpdGVDb25maWc9c2l0ZXNbeF07CiAgICAgICAgICAgIG9mZk5vZGUuY3NzKCJiYWNrZ3JvdW5kLWNvbG9yIiwiIyIrc2l0ZUNvbmZpZy5iZ0NvbG9yKS5hdHRyKCJ0aXRsZSIsaTE4bltzaXRlQ29uZmlnLm5hbWVdICkuYXR0cigiaHJlZiIsIHNpdGVDb25maWcudXJsKTsKICAgICAgICAgICAgb2ZmTm9kZS5jbGljayhmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIGlmKHNpdGVDb25maWcubmFtZSE9Inh1bmxlaSIpR01fc2V0VmFsdWUoImVvVXJsIixnZXRSaWdodE1hZ25ldFVybChvZmZVcmwpKTsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZihzaXRlQ29uZmlnLmJnSW1nKW9mZk5vZGUuY3NzKCJiYWNrZ3JvdW5kLWltYWdlIiwidXJsKFwiIitzaXRlQ29uZmlnLmJnSW1nKyJcIikiKTsKICAgICAgICAgICAgLypzd2l0Y2goeCl7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG9mZk5vZGUuY3NzKCJiYWNrZ3JvdW5kLWNvbG9yIiwiI2UxZTFlMSIpLmF0dHIoInRpdGxlIixpMThuLmJhaWR1ICkuYXR0cigiaHJlZiIsICJodHRwOi8vcGFuLmJhaWR1LmNvbS9kaXNrL2hvbWUiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBvZmZOb2RlLmNzcygiYmFja2dyb3VuZC1jb2xvciIsIiNGNDQzMzYiKS5hdHRyKCJ0aXRsZSIsaTE4bi5zZWVkciApLmF0dHIoImhyZWYiLCAiaHR0cHM6Ly93d3cuc2VlZHIuY2MvZmlsZXMiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBvZmZOb2RlLmNzcygiYmFja2dyb3VuZC1jb2xvciIsIiMzQkVCRkYiKS5hdHRyKCJ0aXRsZSIsaTE4bi5mdXJrICkuYXR0cigiaHJlZiIsICJodHRwczovL3d3dy5mdXJrLm5ldC91c2Vycy9maWxlcy9hZGQiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBvZmZOb2RlLmNzcygiYmFja2dyb3VuZC1jb2xvciIsIiM1ZTVlZmYiKS5hdHRyKCJ0aXRsZSIsaTE4bi55eXcgKS5hdHRyKCJocmVmIiwgImh0dHA6Ly8xMTUuY29tLz90YWI9b2ZmbGluZSZtb2RlPXdhbmdwYW4iKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9Ki8KICAgICAgICAgICAgb2ZmTm9kZXMucHVzaChvZmZOb2RlKTsKICAgICAgICAgICAgaWYoc2l0ZUNvbmZpZy5oaWRlKWNvbnRpbnVlOwogICAgICAgICAgICBwYXJlbnREaXYucHJlcGVuZChvZmZOb2RlKTsKICAgICAgICB9CiAgICAgICAgcGFyZW50RGl2Lm1vdXNlb3ZlcihmdW5jdGlvbihlKXsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCBmdW5jdGlvbihlKXsKICAgICAgICAgICAgaGlkZUljb25zKCk7CiAgICAgICAgfSk7CgogICAgICAgIGlmKHJhd25vZGVzLmxlbmd0aCA+IDApewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmF3bm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBkaXNhYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBjdXJOb2RlID0gcmF3bm9kZXNbaV07CiAgICAgICAgICAgICAgICBpZighL15tYWduZXR8XmVkMms6XC9cLy8udGVzdChjdXJOb2RlLmhyZWYpKXsKICAgICAgICAgICAgICAgICAgICBpZigvWyNcP118XC9cLlteXC5dKyQvLnRlc3QoY3VyTm9kZS5ocmVmKSljb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgZGlzYWJsZVVybC5sZW5ndGg7IGorKyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gZGlzYWJsZVVybFtqXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY3VyTm9kZS5ocmVmLmluZGV4T2YodGVtcCkhPS0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoZGlzYWJsZSljb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCFpbmNsdWRlKG5vZGVzLGN1ck5vZGUpKXsKICAgICAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKGN1ck5vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKGN1c3RvbW5vZGVzLmxlbmd0aCA+IDApewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY3VzdG9tbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGN1ck5vZGUgPSBjdXN0b21ub2Rlc1tpXTsKICAgICAgICAgICAgICAgIGlmKCFpbmNsdWRlKG5vZGVzLGN1ck5vZGUpKXsKICAgICAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKGN1ck5vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZihub2Rlcy5sZW5ndGggPiAwKXsKICAgICAgICAgICAgJCgiYm9keSIpLmFwcGVuZChwYXJlbnREaXYpOwogICAgICAgICAgICB2YXIgY29kZUxpc3QgPSBbXTsKICAgICAgICAgICAgdmFyIGxpc3RMZW4gPSAwOwogICAgICAgICAgICBsaXN0TGVuID0gbm9kZXMubGVuZ3RoOwogICAgICAgICAgICBzZXRDc3MoKTsKICAgICAgICAgICAgaWYgKGxpc3RMZW4gIT09IDApIHsKICAgICAgICAgICAgICAgIHZhciBwcmVOb2RlOwogICAgICAgICAgICAgICAgaWYoc2hvd1R5cGUpewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYocHJlTm9kZSlwcmVOb2RlLmhpZGUoMzAwKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0TGVuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjdXJOb2RlID0gbm9kZXNbaV07CiAgICAgICAgICAgICAgICAgICAgbGV0IGNsb25lPSQoIjxhPjwvYT4iKS5hdHRyKCJzdHlsZSIsY3VyTm9kZS5nZXRBdHRyaWJ1dGUoInN0eWxlIikpLmF0dHIoImhyZWYiLGN1ck5vZGUuZ2V0QXR0cmlidXRlKCJocmVmIikpLmFkZENsYXNzKCd3aHgtYScpLmNzcygiYmFja2dyb3VuZC1jb2xvciIsIiNlMWUxZTEiKS5jc3MoImJhY2tncm91bmQtaW1hZ2UiLCd1cmwoImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQmtBQUFBWkNBTUFBQUR6TjNWUkFBQUFSVkJNVkVVQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQURjNnVyM0FBQUFGblJTVGxNQVlNNXZNT0EvRU5HZWdLMm9sSTZHMWI5N1owc1hFTkErakFBQUFLRkpSRUZVS00rRmtsa1N4Q0FJUkhGZnNzM0svWTg2aVFTRFZxenBIN0ZmZ1FwQ1ZmQW1HeCtnbDlKSTBxcnhyY05Mem9vRWJLVUc0RUtXZGtDaURSVjBOMFJUclo1d3ZkZ1RUZ3A0U3pDQUh4QVBaa0FNNUdPSld1dVQ3RkU1T1ZQT0JGTFRZYjNPYzJZQjV1SjgrRzZwZ2tUR3Q3NG50Y0NKSGl3RkxIdzEwVGRjOTNqbEdYR3ZTUnRzSE5wdVBzKy9vMU9EZnhBdFNMMGY3SFBDK0wvOUFGNjBHM1F4TzFVYUFBQUFBRWxGVGtTdVFtQ0MiKScpOwogICAgICAgICAgICAgICAgICAgIGNsb25lLm1vdXNlb3ZlcihmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgICAgICAgICAgb2ZmVXJsPWNsb25lLmF0dHIoImhyZWYiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50RGl2LmNzcygiZGlzcGxheSIsImJsb2NrIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYXNlUG9zPWNsb25lLm9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnREaXYub2Zmc2V0KHt0b3A6YmFzZVBvcy50b3AsbGVmdDpiYXNlUG9zLmxlZnR9KTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGo9MDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciB4PTA7eDxvZmZOb2Rlcy5sZW5ndGg7eCsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBub2RlPW9mZk5vZGVzW3hdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoL15tYWduZXQvaS50ZXN0KG9mZlVybCkgJiYgc2l0ZXNbeF0ubm9NYWcpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoL15mdHAvaS50ZXN0KG9mZlVybCkgJiYgc2l0ZXNbeF0ubm9GdHApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoL15lZDJrOlwvXC8vaS50ZXN0KG9mZlVybCkgJiYgc2l0ZXNbeF0ubm9FZDJrKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuY3NzKCJtYXJnaW4tdG9wIiwtaioyNSsicHgiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2l0ZXNbeF0ubmFtZT09Inh1bmxlaSIpbm9kZS5hdHRyKCdocmVmJywgc2l0ZXNbeF0udXJsK29mZlVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkKGN1ck5vZGUpLmFmdGVyKGNsb25lKTsKICAgICAgICAgICAgICAgICAgICBpZihzaG93VHlwZSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsb25lLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJChjdXJOb2RlKS5tb3VzZW92ZXIoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNsb25lLmlzKCc6aGlkZGVuJykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHByZU5vZGUpcHJlTm9kZS5oaWRlKDMwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmUuc2hvdyg1MDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZU5vZGU9Y2xvbmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSaWdodE1hZ25ldFVybCh1cmwpewogICAgICAgIHZhciBuZXdVcmwgPSB1cmw7CiAgICAgICAgaWYoL15tYWduZXQvLnRlc3QodXJsKSl7CiAgICAgICAgICAgIG5ld1VybD1uZXdVcmwuc3BsaXQoIiYiKVswXS5zdWJzdHJpbmcoMjApOwogICAgICAgICAgICBpZihuZXdVcmwubGVuZ3RoPT0zMil7CiAgICAgICAgICAgICAgICBuZXdVcmw9Im1hZ25ldDo/eHQ9dXJuOmJ0aWg6IiArIGJhc2UzMlRvSGV4KG5ld1VybCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgbmV3VXJsPXVybDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3VXJsOwogICAgfQoKICAgIHZhciBiMzIgPSB7J2EnOicwMDAwMCcsJ2InOicwMDAwMScsJ2MnOicwMDAxMCcsJ2QnOicwMDAxMScsJ2UnOicwMDEwMCcsJ2YnOicwMDEwMScsJ2cnOicwMDExMCcsJ2gnOicwMDExMScsJ2knOicwMTAwMCcsJ2onOicwMTAwMScsJ2snOicwMTAxMCcsJ2wnOicwMTAxMScsJ20nOicwMTEwMCcsJ24nOicwMTEwMScsJ28nOicwMTExMCcsJ3AnOicwMTExMScsJ3EnOicxMDAwMCcsJ3InOicxMDAwMScsJ3MnOicxMDAxMCcsJ3QnOicxMDAxMScsJ3UnOicxMDEwMCcsJ3YnOicxMDEwMScsJ3cnOicxMDExMCcsJ3gnOicxMDExMScsJ3knOicxMTAwMCcsJ3onOicxMTAwMScsJzInOicxMTAxMCcsJzMnOicxMTAxMScsJzQnOicxMTEwMCcsJzUnOicxMTEwMScsJzYnOicxMTExMCcsJzcnOicxMTExMSd9OwogICAgdmFyIGIxNiA9IHsnMDAwMCc6JzAnLCcwMDAxJzonMScsJzAwMTAnOicyJywnMDAxMSc6JzMnLCcwMTAwJzonNCcsJzAxMDEnOic1JywnMDExMCc6JzYnLCcwMTExJzonNycsJzEwMDAnOic4JywnMTAwMSc6JzknLCcxMDEwJzonYScsJzEwMTEnOidiJywnMTEwMCc6J2MnLCcxMTAxJzonZCcsJzExMTAnOidlJywnMTExMSc6J2YnfTsKICAgIGZ1bmN0aW9uIGJhc2UzMlRvSGV4KHN0cil7CiAgICAgICAgaWYoc3RyLmxlbmd0aCAlIDggIT09IDAgfHwgL1swMTg5XS50ZXN0KHN0cikvKXsKICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICB9CiAgICAgICAgc3RyID0gc3RyLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdmFyIGJpbiA9ICAiIiwgcmV0dXJuU3RyID0gIiIsIGk7CiAgICAgICAgZm9yKGkgPSAwO2kgPCBzdHIubGVuZ3RoO2krKyl7CiAgICAgICAgICAgIGJpbiArPSBiMzJbc3RyLnN1YnN0cmluZyhpLGkrMSldOwogICAgICAgIH0KICAgICAgICBmb3IoaSA9IDA7aSA8IGJpbi5sZW5ndGg7aSs9NCl7CiAgICAgICAgICAgIHJldHVyblN0ciArPSBiMTZbYmluLnN1YnN0cmluZyhpLGkrNCldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0dXJuU3RyOwogICAgfQoKICAgIHZhciBpPTA7CiAgICB2YXIgdD13aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGN1cmxpbms7CiAgICAgICAgaWYgKGxvY2F0aW9uLmhyZWYuaW5kZXhPZigiZ2l0aHViLmNvbS9ob290aGluL1VzZXJTY3JpcHRzL3RyZWUvbWFzdGVyL0Vhc3klMjBvZmZsaW5lIikgIT0gLTEpewogICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0KTsKICAgICAgICAgICAgJCgnaGVhZCcpLmFwcGVuZChgCiAgICAgICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgICAgIC53aHgtYnRuewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IzM4OTJlZDsKICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgMC4yNXMgZWFzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC53aHgtYnRuOmhvdmVyewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IzgzYzFmZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgPC9zdHlsZT5gKTsKICAgICAgICAgICAgdmFyIGNvbmZpZ0NvbnRlbnQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29uZmlnQ29udGVudCk7CiAgICAgICAgICAgIGNvbmZpZ0NvbnRlbnQub3V0ZXJIVE1MPWAKICAgICAgICAgICAgPGRpdiBpZD0iY29uZmlnQ29udGVudCIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOjMwMHB4O2hlaWdodDozMDBweDtwb3NpdGlvbjpmaXhlZDtsZWZ0OjUwJTt0b3A6NTAlO21hcmdpbi10b3A6LTE1MHB4O21hcmdpbi1sZWZ0Oi0xNTBweDt6LWluZGV4OjEwMDAwMDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmZmZmY7Ym9yZGVyOjFweCBzb2xpZCAjYWZiM2I2O2JvcmRlci1yYWRpdXM6MTBweDtvcGFjaXR5OjAuOTU7ZmlsdGVyOmFscGhhKG9wYWNpdHk9OTUpO2JveC1zaGFkb3c6NXB4IDVweCAyMHB4IDBweCAjMDAwOyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Zm9udC1zaXplOiAxMnB4O21hcmdpbi10b3A6IDI4cHg7Ij7oh6rlrprkuYnpnIDopoHlkK/nlKjkuIDplK7kuIvovb3nmoTpk77mjqXmraPliJnvvIzkuIDooYzkuIDmnaE8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9ImNvbmZpZ0lucHV0IiBwbGFjZWhvbGRlcj0i5L6L77yaaHR0cDouKlxcLnBocFxcP2dldFJlcz1cXGQrIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7bGVmdDoyMHB4O3RvcDo1MHB4O3dpZHRoOjI2MHB4O2hlaWdodDoxNzBweCI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2xlZnQ6NjBweDt0b3A6MjI1cHg7Ij48aW5wdXQgaWQ9InNob3dUeXBlIiB0eXBlPSJjaGVja2JveCIvPuS7heW9k+m8oOagh+e7j+i/h+aXtuaYvuekuuWbvuaghzwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY29uZmlnU2F2ZSIgY2xhc3M9IndoeC1idG4iIHR5cGU9ImJ1dHRvbiIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2xlZnQ6MTEwcHg7dG9wOjI2MHB4O3dpZHRoOjgwcHg7aGVpZ2h0OjMwcHg7Y29sb3I6d2hpdGU7Ym9yZGVyLXJhZGl1czo1cHg7Ym9yZGVyOjBweDtvdXRsaW5lOm5vbmU7Ij7orr7nva48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjb25maWdRdWl0IiBjbGFzcz0id2h4LWJ0biIgc3R5bGU9IndpZHRoOjI4cHg7aGVpZ2h0OjI4cHg7Ym9yZGVyLXJhZGl1czoxNHB4O3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjJweDt0b3A6MnB4O2N1cnNvcjpwb2ludGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJoZWlnaHQ6MjhweDtsaW5lLWhlaWdodDoyOHB4O2Rpc3BsYXk6YmxvY2s7Y29sb3I6I0ZGRjt0ZXh0LWFsaWduOmNlbnRlcjtmb250LXNpemU6MjBweDsiPuKVszwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICB2YXIgY29uZmlnSW5wdXQ9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NvbmZpZ0lucHV0Iik7CiAgICAgICAgICAgIHZhciBjb25maWdRdWl0PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjb25maWdRdWl0Iik7CiAgICAgICAgICAgIHZhciBjb25maWdTYXZlPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjb25maWdTYXZlIik7CiAgICAgICAgICAgIHZhciBzaG93VHlwZUNoZWNrPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzaG93VHlwZSIpOwogICAgICAgICAgICBjb25maWdDb250ZW50PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjb25maWdDb250ZW50Iik7CiAgICAgICAgICAgIGNvbmZpZ0NvbnRlbnQuc3R5bGUuZGlzcGxheT0iYmxvY2siOwogICAgICAgICAgICBpZihHTV9nZXRWYWx1ZSgiZW9SZWciKSkkKGNvbmZpZ0lucHV0KS52YWwoR01fZ2V0VmFsdWUoImVvUmVnIikuam9pbigiXG4iKSk7CiAgICAgICAgICAgIGlmKEdNX2dldFZhbHVlKCJzaG93VHlwZSIpKXNob3dUeXBlQ2hlY2suY2hlY2tlZD10cnVlOwogICAgICAgICAgICAkKGNvbmZpZ1F1aXQpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge2NvbmZpZ0NvbnRlbnQuc3R5bGUuZGlzcGxheT0ibm9uZSI7fSk7CiAgICAgICAgICAgICQoY29uZmlnU2F2ZSkuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcmVnU3RyPSQoY29uZmlnSW5wdXQpLnZhbCgpOwogICAgICAgICAgICAgICAgdmFyIHJlZ1N0cnM9cmVnU3RyLnNwbGl0KCJcbiIpOwogICAgICAgICAgICAgICAgZm9yKHZhciByZWcgb2YgcmVnU3Rycyl7CiAgICAgICAgICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmVnRXhwKHJlZyk7CiAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGUpewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgi5ZCr5pyJ5peg5pWI5q2j5YiZ77yM6K+36YeN5paw6L6T5YWlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBHTV9zZXRWYWx1ZSgiZW9SZWciLHJlZ1N0cnMpOwogICAgICAgICAgICAgICAgR01fc2V0VmFsdWUoInNob3dUeXBlIiwgc2hvd1R5cGVDaGVjay5jaGVja2VkKTsKICAgICAgICAgICAgICAgIGFsZXJ0KCLorr7nva7miJDlip8iKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfWVsc2UgaWYgKGxvY2F0aW9uLmhyZWYuaW5kZXhPZigiZnVyay5uZXQvdXNlcnMvZmlsZXMvYWRkIikgIT0gLTEpewogICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0KTsKICAgICAgICAgICAgY3VybGluayA9IEdNX2dldFZhbHVlKCdlb1VybCcpOwogICAgICAgICAgICBpZihjdXJsaW5rKXsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnI3VybCcpLnZhbChjdXJsaW5rKTsKICAgICAgICAgICAgICAgICAgICBHTV9kZWxldGVWYWx1ZSgnZW9VcmwnKTsKICAgICAgICAgICAgICAgICAgICAkKCI6c3VibWl0W3ZhbHVlPSdBZGQgZG93bmxvYWQnXSIpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9CiAgICAgICAgfWVsc2UgaWYobG9jYXRpb24uaHJlZi5pbmRleE9mKCJzZWVkci5jYy9maWxlcyIpICE9IC0xKXsKICAgICAgICAgICAgaWYoJCgnI3VwbG9hZC1idXR0b24nKS5jc3MoImRpc3BsYXkiKSAhPSAibm9uZSIpewogICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodCk7CiAgICAgICAgICAgICAgICBjdXJsaW5rID0gR01fZ2V0VmFsdWUoJ2VvVXJsJyk7CiAgICAgICAgICAgICAgICBpZihjdXJsaW5rKXsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKCc6dGV4dFtuYW1lPSJ0b3JyZW50Il0nKS52YWwoY3VybGluayk7CiAgICAgICAgICAgICAgICAgICAgICAgIEdNX2RlbGV0ZVZhbHVlKCdlb1VybCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjdXBsb2FkLWJ1dHRvbicpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH1lbHNlIGlmKGxvY2F0aW9uLmhyZWYuaW5kZXhPZigicGFuLmJhaWR1LmNvbS9kaXNrL2hvbWUiKSAhPSAtMSl7CiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHQpOwogICAgICAgICAgICBjdXJsaW5rID0gR01fZ2V0VmFsdWUoJ2VvVXJsJyk7CiAgICAgICAgICAgIGlmKGN1cmxpbmspewogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmctYnV0dG9uW2RhdGEtYnV0dG9uLWlkPWIxM10nKS5jbGljaygpOwogICAgICAgICAgICAgICAgdmFyIGJzaSA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBuZXdUYXNrQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI19kaXNrX2lkXzInKTsKICAgICAgICAgICAgICAgICAgICBpZihuZXdUYXNrQnRuKXsKICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChic2kpOwogICAgICAgICAgICAgICAgICAgICAgICBuZXdUYXNrQnRuLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBic2wgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvZmZMaW5rPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaGFyZS1vZmZsaW5lLWxpbmsnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9mZkxpbmspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYnNsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZMaW5rLnZhbHVlID0gY3VybGluazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjbmV3b2ZmbGluZS1kaWFsb2c+LmRpYWxvZy1mb290ZXI+LmctYnV0dG9uJylbMV0uY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigvXm1hZ25ldHx0b3JyZW50JC8udGVzdChjdXJsaW5rKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGk9MCwgYnNiID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidExpc3Q9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI29mZmxpbmVidGxpc3QtZGlhbG9nJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigrK2k+NTAgfHwgKGJ0TGlzdCAmJiBidExpc3Quc3R5bGUuZGlzcGxheSE9Im5vbmUiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChic2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ0TGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuZGlhbG9nLWZvb3Rlcj4uZy1idXR0b24nKVsxXS5jbGljaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgICAgICBHTV9kZWxldGVWYWx1ZSgnZW9VcmwnKTsKICAgICAgICAgICAgfQogICAgICAgIH1lbHNlIGlmKGxvY2F0aW9uLmhyZWYuaW5kZXhPZigiMTE1LmNvbS8/dGFiPW9mZmxpbmUmbW9kZT13YW5ncGFuIikgIT0gLTEpewogICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0KTsKICAgICAgICAgICAgY3VybGluayA9IEdNX2dldFZhbHVlKCdlb1VybCcpOwogICAgICAgICAgICBpZihjdXJsaW5rKXsKICAgICAgICAgICAgICAgIHZhciByc2MgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PSAnY29tcGxldGUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocnNjKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcmVbJ09GRkw1UGx1ZyddLk9wZW5MaW5rKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNqc19vZmZsaW5lX25ld19hZGQnKS52YWwoY3VybGluayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAzMDApOwogICAgICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCA0MDApOwogICAgICAgICAgICAgICAgR01fZGVsZXRlVmFsdWUoJ2VvVXJsJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZSBpZihsb2NhdGlvbi5ocmVmLmluZGV4T2YoIm15LnBjbG91ZC5jb20iKSAhPSAtMSl7CiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHQpOwogICAgICAgICAgICBjdXJsaW5rID0gR01fZ2V0VmFsdWUoJ2VvVXJsJyk7CiAgICAgICAgICAgIGlmKGN1cmxpbmspewogICAgICAgICAgICAgICAgdmFyIHBzYyA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB1cEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi51cGxvYWRfYnV0dG9uJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVwQnRuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHNjKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBCdG4uY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3Bhbi5yZW1vdGV1cGxvYWQtY3RybCcpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZW1vdGVhcmVhPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RleHRhcmVhLnJlbW90ZWFyZWEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlYXJlYS52YWx1ZT1jdXJsaW5rOwogICAgICAgICAgICAgICAgICAgICAgICByZW1vdGVhcmVhLm5leHRTaWJsaW5nLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgICAgIEdNX2RlbGV0ZVZhbHVlKCdlb1VybCcpOwogICAgICAgICAgICB9CiAgICAgICAgfWVsc2UgaWYoaSA+IDIgfHwgKChpKyspID09PSAwICYmICQoZW5hYmxlVXJsKS5sZW5ndGggPiAwKSl7CiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHQpOwogICAgICAgICAgICBnZXRBbGxFbmFibGVVcmwoKTsKICAgICAgICB9CiAgICB9LCA1MDApOwogICAgaWYoL3BhblwuYmFpZHVcLmNvbVwvd2FwXC9ob21lLy50ZXN0KGxvY2F0aW9uLmhyZWYpICYmIEdNX2dldFZhbHVlKCdlb1VybCcpKXsKICAgICAgICBsb2NhdGlvbi5ocmVmPSJodHRwczovL3Bhbi5iYWlkdS5jb20vZGlzay9ob21lIjsKICAgIH0KICAgIGZ1bmN0aW9uIHRvZ2dsZUljb24oKXsKICAgICAgICAkKCcud2h4LWEnKS50b2dnbGUoNTAwKTsKICAgICAgICBpZihHTV9nZXRWYWx1ZSgnZW9EaXNhYmxlXycrZG9jdW1lbnQuZG9tYWluKSl7CiAgICAgICAgICAgIEdNX2RlbGV0ZVZhbHVlKCdlb0Rpc2FibGVfJytkb2N1bWVudC5kb21haW4pOwogICAgICAgICAgICBpZigkKCcud2h4LWEnKS5sZW5ndGg8MSlnZXRBbGxFbmFibGVVcmwoKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgR01fc2V0VmFsdWUoJ2VvRGlzYWJsZV8nK2RvY3VtZW50LmRvbWFpbix0cnVlKTsKICAgICAgICB9CiAgICB9CiAgICBHTV9yZWdpc3Rlck1lbnVDb21tYW5kKGkxOG4udG9nZ2xlLCB0b2dnbGVJY29uKTsKfSkoKTs="}]}